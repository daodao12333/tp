import{e as us,f as pp,r as hs,h as X,i as At,w as ai,V as g0,M as y0,N as V,k as v0,j as eu,m as m0,K as w0,A as b0,q as Dl,x as _0,H as E0,F as I0,o as Ll,$ as P0,t as x0,p as S0,J as A0,u as os,s as Bl,X as F0,v as O0,_ as dp,y as hr,I as R0,z as ql,B as dn,C as Ge,U as ut,D as oi,E as St,G as C0,L as gn,O as gp,P as $0,Q as T0,R as N0,S as yp,T as D0,W as vp,Y as mp,Z as vn,a0 as tu,a1 as Lo,a2 as wn,a3 as L0,a4 as Bo,a5 as B0,a6 as q0,a7 as j0,a8 as z0,a9 as So,aa as M0,ab as U0,ac as Rc,ad as jl,ae as H0,af as k0,ag as V0,ah as zl,ai as K0,aj as G0,ak as W0,al as J0,am as Q0,an as Y0,ao as Z0,ap as rs,aq as wp,ar as Cc,as as X0,at as eb,au as tb}from"./index-6d74a1b2.js";function rb(n,e){for(var r=0;r<e.length;r++){const s=e[r];if(typeof s!="string"&&!Array.isArray(s)){for(const o in s)if(o!=="default"&&!(o in n)){const c=Object.getOwnPropertyDescriptor(s,o);c&&Object.defineProperty(n,o,c.get?c:{enumerable:!0,get:()=>s[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var yu={exports:{}},mn=typeof Reflect=="object"?Reflect:null,Ml=mn&&typeof mn.apply=="function"?mn.apply:function(e,r,s){return Function.prototype.apply.call(e,r,s)},qo;mn&&typeof mn.ownKeys=="function"?qo=mn.ownKeys:Object.getOwnPropertySymbols?qo=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:qo=function(e){return Object.getOwnPropertyNames(e)};function ib(n){console&&console.warn&&console.warn(n)}var bp=Number.isNaN||function(e){return e!==e};function Se(){Se.init.call(this)}yu.exports=Se;yu.exports.once=ab;Se.EventEmitter=Se;Se.prototype._events=void 0;Se.prototype._eventsCount=0;Se.prototype._maxListeners=void 0;var Ul=10;function Vo(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Se,"defaultMaxListeners",{enumerable:!0,get:function(){return Ul},set:function(n){if(typeof n!="number"||n<0||bp(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Ul=n}});Se.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Se.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||bp(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _p(n){return n._maxListeners===void 0?Se.defaultMaxListeners:n._maxListeners}Se.prototype.getMaxListeners=function(){return _p(this)};Se.prototype.emit=function(e){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var o=e==="error",c=this._events;if(c!==void 0)o=o&&c.error===void 0;else if(!o)return!1;if(o){var h;if(r.length>0&&(h=r[0]),h instanceof Error)throw h;var p=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw p.context=h,p}var f=c[e];if(f===void 0)return!1;if(typeof f=="function")Ml(f,this,r);else for(var y=f.length,v=Sp(f,y),s=0;s<y;++s)Ml(v[s],this,r);return!0};function Ep(n,e,r,s){var o,c,h;if(Vo(r),c=n._events,c===void 0?(c=n._events=Object.create(null),n._eventsCount=0):(c.newListener!==void 0&&(n.emit("newListener",e,r.listener?r.listener:r),c=n._events),h=c[e]),h===void 0)h=c[e]=r,++n._eventsCount;else if(typeof h=="function"?h=c[e]=s?[r,h]:[h,r]:s?h.unshift(r):h.push(r),o=_p(n),o>0&&h.length>o&&!h.warned){h.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=n,p.type=e,p.count=h.length,ib(p)}return n}Se.prototype.addListener=function(e,r){return Ep(this,e,r,!1)};Se.prototype.on=Se.prototype.addListener;Se.prototype.prependListener=function(e,r){return Ep(this,e,r,!0)};function nb(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ip(n,e,r){var s={fired:!1,wrapFn:void 0,target:n,type:e,listener:r},o=nb.bind(s);return o.listener=r,s.wrapFn=o,o}Se.prototype.once=function(e,r){return Vo(r),this.on(e,Ip(this,e,r)),this};Se.prototype.prependOnceListener=function(e,r){return Vo(r),this.prependListener(e,Ip(this,e,r)),this};Se.prototype.removeListener=function(e,r){var s,o,c,h,p;if(Vo(r),o=this._events,o===void 0)return this;if(s=o[e],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,s.listener||r));else if(typeof s!="function"){for(c=-1,h=s.length-1;h>=0;h--)if(s[h]===r||s[h].listener===r){p=s[h].listener,c=h;break}if(c<0)return this;c===0?s.shift():sb(s,c),s.length===1&&(o[e]=s[0]),o.removeListener!==void 0&&this.emit("removeListener",e,p||r)}return this};Se.prototype.off=Se.prototype.removeListener;Se.prototype.removeAllListeners=function(e){var r,s,o;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var c=Object.keys(s),h;for(o=0;o<c.length;++o)h=c[o],h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(o=r.length-1;o>=0;o--)this.removeListener(e,r[o]);return this};function Pp(n,e,r){var s=n._events;if(s===void 0)return[];var o=s[e];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?ob(o):Sp(o,o.length)}Se.prototype.listeners=function(e){return Pp(this,e,!0)};Se.prototype.rawListeners=function(e){return Pp(this,e,!1)};Se.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):xp.call(n,e)};Se.prototype.listenerCount=xp;function xp(n){var e=this._events;if(e!==void 0){var r=e[n];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Se.prototype.eventNames=function(){return this._eventsCount>0?qo(this._events):[]};function Sp(n,e){for(var r=new Array(e),s=0;s<e;++s)r[s]=n[s];return r}function sb(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function ob(n){for(var e=new Array(n.length),r=0;r<e.length;++r)e[r]=n[r].listener||n[r];return e}function ab(n,e){return new Promise(function(r,s){function o(h){n.removeListener(e,c),s(h)}function c(){typeof n.removeListener=="function"&&n.removeListener("error",o),r([].slice.call(arguments))}Ap(n,e,c,{once:!0}),e!=="error"&&cb(n,o,{once:!0})})}function cb(n,e,r){typeof n.on=="function"&&Ap(n,"error",e,r)}function Ap(n,e,r,s){if(typeof n.on=="function")s.once?n.once(e,r):n.on(e,r);else if(typeof n.addEventListener=="function")n.addEventListener(e,function o(c){s.once&&n.removeEventListener(e,o),r(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Ft=yu.exports;const vu=us(Ft),ub=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,hb=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,lb=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function fb(n,e){if(n==="__proto__"||n==="constructor"&&e&&typeof e=="object"&&"prototype"in e){pb(n);return}return e}function pb(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}function Ao(n,e={}){if(typeof n!="string")return n;if(n[0]==='"'&&n[n.length-1]==='"'&&n.indexOf("\\")===-1)return n.slice(1,-1);const r=n.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!lb.test(n)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(ub.test(n)||hb.test(n)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,fb)}return JSON.parse(n)}catch(s){if(e.strict)throw s;return n}}function db(n){return!n||typeof n.then!="function"?Promise.resolve(n):n}function Xe(n,...e){try{return db(n(...e))}catch(r){return Promise.reject(r)}}function gb(n){const e=typeof n;return n===null||e!=="object"&&e!=="function"}function yb(n){const e=Object.getPrototypeOf(n);return!e||e.isPrototypeOf(Object)}function jo(n){if(gb(n))return String(n);if(yb(n)||Array.isArray(n))return JSON.stringify(n);if(typeof n.toJSON=="function")return jo(n.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const ru="base64:";function vb(n){return typeof n=="string"?n:ru+bb(n)}function mb(n){return typeof n!="string"||!n.startsWith(ru)?n:wb(n.slice(ru.length))}function wb(n){return globalThis.Buffer?Buffer.from(n,"base64"):Uint8Array.from(globalThis.atob(n),e=>e.codePointAt(0))}function bb(n){return globalThis.Buffer?Buffer.from(n).toString("base64"):globalThis.btoa(String.fromCodePoint(...n))}function xt(n){var e;return n&&((e=n.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function _b(...n){return xt(n.join(":"))}function Fo(n){return n=xt(n),n?n+":":""}function Eb(n,e){if(e===void 0)return!0;let r=0,s=n.indexOf(":");for(;s>-1;)r++,s=n.indexOf(":",s+1);return r<=e}function Ib(n,e){return e?n.startsWith(e)&&n[n.length-1]!=="$":n[n.length-1]!=="$"}const Pb="memory",xb=()=>{const n=new Map;return{name:Pb,getInstance:()=>n,hasItem(e){return n.has(e)},getItem(e){return n.get(e)??null},getItemRaw(e){return n.get(e)??null},setItem(e,r){n.set(e,r)},setItemRaw(e,r){n.set(e,r)},removeItem(e){n.delete(e)},getKeys(){return[...n.keys()]},clear(){n.clear()},dispose(){n.clear()}}};function Sb(n={}){const e={mounts:{"":n.driver||xb()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=y=>{for(const v of e.mountpoints)if(y.startsWith(v))return{base:v,relativeKey:y.slice(v.length),driver:e.mounts[v]};return{base:"",relativeKey:y,driver:e.mounts[""]}},s=(y,v)=>e.mountpoints.filter(b=>b.startsWith(y)||v&&y.startsWith(b)).map(b=>({relativeBase:y.length>b.length?y.slice(b.length):void 0,mountpoint:b,driver:e.mounts[b]})),o=(y,v)=>{if(e.watching){v=xt(v);for(const b of e.watchListeners)b(y,v)}},c=async()=>{if(!e.watching){e.watching=!0;for(const y in e.mounts)e.unwatch[y]=await Hl(e.mounts[y],o,y)}},h=async()=>{if(e.watching){for(const y in e.unwatch)await e.unwatch[y]();e.unwatch={},e.watching=!1}},p=(y,v,b)=>{const S=new Map,O=F=>{let N=S.get(F.base);return N||(N={driver:F.driver,base:F.base,items:[]},S.set(F.base,N)),N};for(const F of y){const N=typeof F=="string",G=xt(N?F:F.key),H=N?void 0:F.value,Z=N||!F.options?v:{...v,...F.options},L=r(G);O(L).items.push({key:G,value:H,relativeKey:L.relativeKey,options:Z})}return Promise.all([...S.values()].map(F=>b(F))).then(F=>F.flat())},f={hasItem(y,v={}){y=xt(y);const{relativeKey:b,driver:S}=r(y);return Xe(S.hasItem,b,v)},getItem(y,v={}){y=xt(y);const{relativeKey:b,driver:S}=r(y);return Xe(S.getItem,b,v).then(O=>Ao(O))},getItems(y,v={}){return p(y,v,b=>b.driver.getItems?Xe(b.driver.getItems,b.items.map(S=>({key:S.relativeKey,options:S.options})),v).then(S=>S.map(O=>({key:_b(b.base,O.key),value:Ao(O.value)}))):Promise.all(b.items.map(S=>Xe(b.driver.getItem,S.relativeKey,S.options).then(O=>({key:S.key,value:Ao(O)})))))},getItemRaw(y,v={}){y=xt(y);const{relativeKey:b,driver:S}=r(y);return S.getItemRaw?Xe(S.getItemRaw,b,v):Xe(S.getItem,b,v).then(O=>mb(O))},async setItem(y,v,b={}){if(v===void 0)return f.removeItem(y);y=xt(y);const{relativeKey:S,driver:O}=r(y);O.setItem&&(await Xe(O.setItem,S,jo(v),b),O.watch||o("update",y))},async setItems(y,v){await p(y,v,async b=>{if(b.driver.setItems)return Xe(b.driver.setItems,b.items.map(S=>({key:S.relativeKey,value:jo(S.value),options:S.options})),v);b.driver.setItem&&await Promise.all(b.items.map(S=>Xe(b.driver.setItem,S.relativeKey,jo(S.value),S.options)))})},async setItemRaw(y,v,b={}){if(v===void 0)return f.removeItem(y,b);y=xt(y);const{relativeKey:S,driver:O}=r(y);if(O.setItemRaw)await Xe(O.setItemRaw,S,v,b);else if(O.setItem)await Xe(O.setItem,S,vb(v),b);else return;O.watch||o("update",y)},async removeItem(y,v={}){typeof v=="boolean"&&(v={removeMeta:v}),y=xt(y);const{relativeKey:b,driver:S}=r(y);S.removeItem&&(await Xe(S.removeItem,b,v),(v.removeMeta||v.removeMata)&&await Xe(S.removeItem,b+"$",v),S.watch||o("remove",y))},async getMeta(y,v={}){typeof v=="boolean"&&(v={nativeOnly:v}),y=xt(y);const{relativeKey:b,driver:S}=r(y),O=Object.create(null);if(S.getMeta&&Object.assign(O,await Xe(S.getMeta,b,v)),!v.nativeOnly){const F=await Xe(S.getItem,b+"$",v).then(N=>Ao(N));F&&typeof F=="object"&&(typeof F.atime=="string"&&(F.atime=new Date(F.atime)),typeof F.mtime=="string"&&(F.mtime=new Date(F.mtime)),Object.assign(O,F))}return O},setMeta(y,v,b={}){return this.setItem(y+"$",v,b)},removeMeta(y,v={}){return this.removeItem(y+"$",v)},async getKeys(y,v={}){var G;y=Fo(y);const b=s(y,!0);let S=[];const O=[];let F=!0;for(const H of b){(G=H.driver.flags)!=null&&G.maxDepth||(F=!1);const Z=await Xe(H.driver.getKeys,H.relativeBase,v);for(const L of Z){const M=H.mountpoint+xt(L);S.some(Y=>M.startsWith(Y))||O.push(M)}S=[H.mountpoint,...S.filter(L=>!L.startsWith(H.mountpoint))]}const N=v.maxDepth!==void 0&&!F;return O.filter(H=>(!N||Eb(H,v.maxDepth))&&Ib(H,y))},async clear(y,v={}){y=Fo(y),await Promise.all(s(y,!1).map(async b=>{if(b.driver.clear)return Xe(b.driver.clear,b.relativeBase,v);if(b.driver.removeItem){const S=await b.driver.getKeys(b.relativeBase||"",v);return Promise.all(S.map(O=>b.driver.removeItem(O,v)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(y=>kl(y)))},async watch(y){return await c(),e.watchListeners.push(y),async()=>{e.watchListeners=e.watchListeners.filter(v=>v!==y),e.watchListeners.length===0&&await h()}},async unwatch(){e.watchListeners=[],await h()},mount(y,v){if(y=Fo(y),y&&e.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(e.mountpoints.push(y),e.mountpoints.sort((b,S)=>S.length-b.length)),e.mounts[y]=v,e.watching&&Promise.resolve(Hl(v,o,y)).then(b=>{e.unwatch[y]=b}).catch(console.error),f},async unmount(y,v=!0){var b,S;y=Fo(y),!(!y||!e.mounts[y])&&(e.watching&&y in e.unwatch&&((S=(b=e.unwatch)[y])==null||S.call(b),delete e.unwatch[y]),v&&await kl(e.mounts[y]),e.mountpoints=e.mountpoints.filter(O=>O!==y),delete e.mounts[y])},getMount(y=""){y=xt(y)+":";const v=r(y);return{driver:v.driver,base:v.base}},getMounts(y="",v={}){return y=xt(y),s(y,v.parents).map(S=>({driver:S.driver,base:S.mountpoint}))},keys:(y,v={})=>f.getKeys(y,v),get:(y,v={})=>f.getItem(y,v),set:(y,v,b={})=>f.setItem(y,v,b),has:(y,v={})=>f.hasItem(y,v),del:(y,v={})=>f.removeItem(y,v),remove:(y,v={})=>f.removeItem(y,v)};return f}function Hl(n,e,r){return n.watch?n.watch((s,o)=>e(s,r+o)):()=>{}}async function kl(n){typeof n.dispose=="function"&&await Xe(n.dispose)}function Ci(n){return new Promise((e,r)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>r(n.error)})}function Fp(n,e){let r;const s=()=>{if(r)return r;const o=indexedDB.open(n);return o.onupgradeneeded=()=>o.result.createObjectStore(e),r=Ci(o),r.then(c=>{c.onclose=()=>r=void 0},()=>{}),r};return(o,c)=>s().then(h=>c(h.transaction(e,o).objectStore(e)))}let $c;function ls(){return $c||($c=Fp("keyval-store","keyval")),$c}function Vl(n,e=ls()){return e("readonly",r=>Ci(r.get(n)))}function Ab(n,e,r=ls()){return r("readwrite",s=>(s.put(e,n),Ci(s.transaction)))}function Fb(n,e=ls()){return e("readwrite",r=>(r.delete(n),Ci(r.transaction)))}function Ob(n=ls()){return n("readwrite",e=>(e.clear(),Ci(e.transaction)))}function Rb(n,e){return n.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Ci(n.transaction)}function Cb(n=ls()){return n("readonly",e=>{if(e.getAllKeys)return Ci(e.getAllKeys());const r=[];return Rb(e,s=>r.push(s.key)).then(()=>r)})}const $b=n=>JSON.stringify(n,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Tb=n=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=n.replace(e,'$1"$2n"$3');return JSON.parse(r,(s,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function fs(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return Tb(n)}catch{return n}}function Ri(n){return typeof n=="string"?n:$b(n)||""}const Nb="idb-keyval";var Db=(n={})=>{const e=n.base&&n.base.length>0?`${n.base}:`:"",r=o=>e+o;let s;return n.dbName&&n.storeName&&(s=Fp(n.dbName,n.storeName)),{name:Nb,options:n,async hasItem(o){return!(typeof await Vl(r(o),s)>"u")},async getItem(o){return await Vl(r(o),s)??null},setItem(o,c){return Ab(r(o),c,s)},removeItem(o){return Fb(r(o),s)},getKeys(){return Cb(s)},clear(){return Ob(s)}}};const Lb="WALLET_CONNECT_V2_INDEXED_DB",Bb="keyvaluestorage";let qb=class{constructor(){this.indexedDb=Sb({driver:Db({dbName:Lb,storeName:Bb})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Ri(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Tc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},zo={exports:{}};(function(){let n;function e(){}n=e,n.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},n.prototype.setItem=function(r,s){this[r]=String(s)},n.prototype.removeItem=function(r){delete this[r]},n.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},n.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Tc<"u"&&Tc.localStorage?zo.exports=Tc.localStorage:typeof window<"u"&&window.localStorage?zo.exports=window.localStorage:zo.exports=new e})();function jb(n){var e;return[n[0],fs((e=n[1])!=null?e:"")]}let zb=class{constructor(){this.localStorage=zo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(jb)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return fs(r)}async setItem(e,r){this.localStorage.setItem(e,Ri(r))}async removeItem(e){this.localStorage.removeItem(e)}};const Mb="wc_storage_version",Kl=1,Ub=async(n,e,r)=>{const s=Mb,o=await e.getItem(s);if(o&&o>=Kl){r(e);return}const c=await n.getKeys();if(!c.length){r(e);return}const h=[];for(;c.length;){const p=c.shift();if(!p)continue;const f=p.toLowerCase();if(f.includes("wc@")||f.includes("walletconnect")||f.includes("wc_")||f.includes("wallet_connect")){const y=await n.getItem(p);await e.setItem(p,y),h.push(p)}}await e.setItem(s,Kl),r(e),Hb(n,h)},Hb=async(n,e)=>{e.length&&e.forEach(async r=>{await n.removeItem(r)})};let kb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new zb;this.storage=e;try{const r=new qb;Ub(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var bn={},Wn={},Nc={},Jn={};class $i{}const Vb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:$i},Symbol.toStringTag,{value:"Module"})),Kb=pp(Vb);var Gl;function Gb(){if(Gl)return Jn;Gl=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.IHeartBeat=void 0;const n=Kb;class e extends n.IEvents{constructor(s){super()}}return Jn.IHeartBeat=e,Jn}var Wl;function Op(){return Wl||(Wl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),hs.__exportStar(Gb(),n)}(Nc)),Nc}var Dc={},Ai={},Jl;function Wb(){if(Jl)return Ai;Jl=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.HEARTBEAT_EVENTS=Ai.HEARTBEAT_INTERVAL=void 0;const n=X;return Ai.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,Ai.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ai}var Ql;function Rp(){return Ql||(Ql=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),hs.__exportStar(Wb(),n)}(Dc)),Dc}var Yl;function Jb(){if(Yl)return Wn;Yl=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.HeartBeat=void 0;const n=hs,e=Ft,r=X,s=Op(),o=Rp();class c extends s.IHeartBeat{constructor(p){super(p),this.events=new e.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(p==null?void 0:p.interval)||o.HEARTBEAT_INTERVAL}static init(p){return n.__awaiter(this,void 0,void 0,function*(){const f=new c(p);return yield f.init(),f})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(p,f){this.events.on(p,f)}once(p,f){this.events.once(p,f)}off(p,f){this.events.off(p,f)}removeListener(p,f){this.events.removeListener(p,f)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Wn.HeartBeat=c,Wn}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const e=hs;e.__exportStar(Jb(),n),e.__exportStar(Op(),n),e.__exportStar(Rp(),n)})(bn);function Qb(n){try{return JSON.stringify(n)}catch{return'"[Circular]"'}}var Yb=Zb;function Zb(n,e,r){var s=r&&r.stringify||Qb,o=1;if(typeof n=="object"&&n!==null){var c=e.length+o;if(c===1)return n;var h=new Array(c);h[0]=s(n);for(var p=1;p<c;p++)h[p]=s(e[p]);return h.join(" ")}if(typeof n!="string")return n;var f=e.length;if(f===0)return n;for(var y="",v=1-o,b=-1,S=n&&n.length||0,O=0;O<S;){if(n.charCodeAt(O)===37&&O+1<S){switch(b=b>-1?b:0,n.charCodeAt(O+1)){case 100:case 102:if(v>=f||e[v]==null)break;b<O&&(y+=n.slice(b,O)),y+=Number(e[v]),b=O+2,O++;break;case 105:if(v>=f||e[v]==null)break;b<O&&(y+=n.slice(b,O)),y+=Math.floor(Number(e[v])),b=O+2,O++;break;case 79:case 111:case 106:if(v>=f||e[v]===void 0)break;b<O&&(y+=n.slice(b,O));var F=typeof e[v];if(F==="string"){y+="'"+e[v]+"'",b=O+2,O++;break}if(F==="function"){y+=e[v].name||"<anonymous>",b=O+2,O++;break}y+=s(e[v]),b=O+2,O++;break;case 115:if(v>=f)break;b<O&&(y+=n.slice(b,O)),y+=String(e[v]),b=O+2,O++;break;case 37:b<O&&(y+=n.slice(b,O)),y+="%",b=O+2,O++,v--;break}++v}++O}return b===-1?n:(b<S&&(y+=n.slice(b)),y)}const Zl=Yb;var Cp=_r;const as=c_().console||{},Xb={mapHttpRequest:Oo,mapHttpResponse:Oo,wrapRequestSerializer:Lc,wrapResponseSerializer:Lc,wrapErrorSerializer:Lc,req:Oo,res:Oo,err:n_};function e_(n,e){return Array.isArray(n)?n.filter(function(s){return s!=="!stdSerializers.err"}):n===!0?Object.keys(e):!1}function _r(n){n=n||{},n.browser=n.browser||{};const e=n.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=n.browser.write||as;n.browser.write&&(n.browser.asObject=!0);const s=n.serializers||{},o=e_(n.browser.serialize,s);let c=n.browser.serialize;Array.isArray(n.browser.serialize)&&n.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const h=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),n.enabled===!1&&(n.level="silent");const p=n.level||"info",f=Object.create(r);f.log||(f.log=cs),Object.defineProperty(f,"levelVal",{get:v}),Object.defineProperty(f,"level",{get:b,set:S});const y={transmit:e,serialize:o,asObject:n.browser.asObject,levels:h,timestamp:s_(n)};f.levels=_r.levels,f.level=p,f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=cs,f.serializers=s,f._serialize=o,f._stdErrSerialize=c,f.child=O,e&&(f._logEvent=iu());function v(){return this.level==="silent"?1/0:this.levels.values[this.level]}function b(){return this._level}function S(F){if(F!=="silent"&&!this.levels.values[F])throw Error("unknown level "+F);this._level=F,ln(y,f,"error","log"),ln(y,f,"fatal","error"),ln(y,f,"warn","error"),ln(y,f,"info","log"),ln(y,f,"debug","log"),ln(y,f,"trace","log")}function O(F,N){if(!F)throw new Error("missing bindings for child Pino");N=N||{},o&&F.serializers&&(N.serializers=F.serializers);const G=N.serializers;if(o&&G){var H=Object.assign({},s,G),Z=n.browser.serialize===!0?Object.keys(H):o;delete F.serializers,Ko([F],Z,H,this._stdErrSerialize)}function L(M){this._childLevel=(M._childLevel|0)+1,this.error=fn(M,F,"error"),this.fatal=fn(M,F,"fatal"),this.warn=fn(M,F,"warn"),this.info=fn(M,F,"info"),this.debug=fn(M,F,"debug"),this.trace=fn(M,F,"trace"),H&&(this.serializers=H,this._serialize=Z),e&&(this._logEvent=iu([].concat(M._logEvent.bindings,F)))}return L.prototype=this,new L(this)}return f}_r.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};_r.stdSerializers=Xb;_r.stdTimeFunctions=Object.assign({},{nullTime:$p,epochTime:Tp,unixTime:o_,isoTime:a_});function ln(n,e,r,s){const o=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?cs:o[r]?o[r]:as[r]||as[s]||cs,t_(n,e,r)}function t_(n,e,r){!n.transmit&&e[r]===cs||(e[r]=function(s){return function(){const c=n.timestamp(),h=new Array(arguments.length),p=Object.getPrototypeOf&&Object.getPrototypeOf(this)===as?as:this;for(var f=0;f<h.length;f++)h[f]=arguments[f];if(n.serialize&&!n.asObject&&Ko(h,this._serialize,this.serializers,this._stdErrSerialize),n.asObject?s.call(p,r_(this,r,h,c)):s.apply(p,h),n.transmit){const y=n.transmit.level||e.level,v=_r.levels.values[y],b=_r.levels.values[r];if(b<v)return;i_(this,{ts:c,methodLevel:r,methodValue:b,transmitLevel:y,transmitValue:_r.levels.values[n.transmit.level||e.level],send:n.transmit.send,val:e.levelVal},h)}}}(e[r]))}function r_(n,e,r,s){n._serialize&&Ko(r,n._serialize,n.serializers,n._stdErrSerialize);const o=r.slice();let c=o[0];const h={};s&&(h.time=s),h.level=_r.levels.values[e];let p=(n._childLevel|0)+1;if(p<1&&(p=1),c!==null&&typeof c=="object"){for(;p--&&typeof o[0]=="object";)Object.assign(h,o.shift());c=o.length?Zl(o.shift(),o):void 0}else typeof c=="string"&&(c=Zl(o.shift(),o));return c!==void 0&&(h.msg=c),h}function Ko(n,e,r,s){for(const o in n)if(s&&n[o]instanceof Error)n[o]=_r.stdSerializers.err(n[o]);else if(typeof n[o]=="object"&&!Array.isArray(n[o]))for(const c in n[o])e&&e.indexOf(c)>-1&&c in r&&(n[o][c]=r[c](n[o][c]))}function fn(n,e,r){return function(){const s=new Array(1+arguments.length);s[0]=e;for(var o=1;o<s.length;o++)s[o]=arguments[o-1];return n[r].apply(this,s)}}function i_(n,e,r){const s=e.send,o=e.ts,c=e.methodLevel,h=e.methodValue,p=e.val,f=n._logEvent.bindings;Ko(r,n._serialize||Object.keys(n.serializers),n.serializers,n._stdErrSerialize===void 0?!0:n._stdErrSerialize),n._logEvent.ts=o,n._logEvent.messages=r.filter(function(y){return f.indexOf(y)===-1}),n._logEvent.level.label=c,n._logEvent.level.value=h,s(c,n._logEvent,p),n._logEvent=iu(f)}function iu(n){return{ts:0,messages:[],bindings:n||[],level:{label:"",value:0}}}function n_(n){const e={type:n.constructor.name,msg:n.message,stack:n.stack};for(const r in n)e[r]===void 0&&(e[r]=n[r]);return e}function s_(n){return typeof n.timestamp=="function"?n.timestamp:n.timestamp===!1?$p:Tp}function Oo(){return{}}function Lc(n){return n}function cs(){}function $p(){return!1}function Tp(){return Date.now()}function o_(){return Math.round(Date.now()/1e3)}function a_(){return new Date(Date.now()).toISOString()}function c_(){function n(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return n(self)||n(window)||n(this)||{}}}const Np=us(Cp),u_=rb({__proto__:null,default:Np},[Cp]),h_={level:"info"},ps="custom_context";var l_=Object.defineProperty,f_=Object.defineProperties,p_=Object.getOwnPropertyDescriptors,Xl=Object.getOwnPropertySymbols,d_=Object.prototype.hasOwnProperty,g_=Object.prototype.propertyIsEnumerable,ef=(n,e,r)=>e in n?l_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,y_=(n,e)=>{for(var r in e||(e={}))d_.call(e,r)&&ef(n,r,e[r]);if(Xl)for(var r of Xl(e))g_.call(e,r)&&ef(n,r,e[r]);return n},v_=(n,e)=>f_(n,p_(e));function Go(n){return v_(y_({},n),{level:(n==null?void 0:n.level)||h_.level})}function m_(n,e=ps){return n[e]||""}function w_(n,e,r=ps){return n[r]=e,n}function Ot(n,e=ps){let r="";return typeof n.bindings>"u"?r=m_(n,e):r=n.bindings().context||"",r}function b_(n,e,r=ps){const s=Ot(n,r);return s.trim()?`${s}/${e}`:e}function Rt(n,e,r=ps){const s=b_(n,e,r),o=n.child({context:s});return w_(o,s,r)}var tf;const Wo=(tf=Np)!=null?tf:u_;let __=class extends $i{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}},E_=class extends $i{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},I_=class{constructor(e,r){this.logger=e,this.core=r}},P_=class extends $i{constructor(e,r){super(),this.relayer=e,this.logger=r}},x_=class extends $i{constructor(e){super()}},S_=class{constructor(e,r,s,o){this.core=e,this.logger=r,this.name=s}},A_=class extends $i{constructor(e,r){super(),this.relayer=e,this.logger=r}},F_=class extends $i{constructor(e,r){super(),this.core=e,this.logger=r}},O_=class{constructor(e,r){this.projectId=e,this.logger=r}},R_=class{constructor(e,r){this.projectId=e,this.logger=r}},C_=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},$_=class{constructor(e){this.client=e}};function T_(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Dp(n,...e){if(!T_(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function rf(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function N_(n,e){Dp(n);const r=e.outputLen;if(n.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const pn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Bc=n=>new DataView(n.buffer,n.byteOffset,n.byteLength);function D_(n){if(typeof n!="string")throw new Error("utf8ToBytes expected string, got "+typeof n);return new Uint8Array(new TextEncoder().encode(n))}function Lp(n){return typeof n=="string"&&(n=D_(n)),Dp(n),n}class L_{clone(){return this._cloneInto()}}function B_(n){const e=s=>n().update(Lp(s)).digest(),r=n();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>n(),e}function Bp(n=32){if(pn&&typeof pn.getRandomValues=="function")return pn.getRandomValues(new Uint8Array(n));if(pn&&typeof pn.randomBytes=="function")return pn.randomBytes(n);throw new Error("crypto.getRandomValues must be defined")}function q_(n,e,r,s){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,r,s);const o=BigInt(32),c=BigInt(4294967295),h=Number(r>>o&c),p=Number(r&c),f=s?4:0,y=s?0:4;n.setUint32(e+f,h,s),n.setUint32(e+y,p,s)}class j_ extends L_{constructor(e,r,s,o){super(),this.blockLen=e,this.outputLen=r,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Bc(this.buffer)}update(e){rf(this);const{view:r,buffer:s,blockLen:o}=this;e=Lp(e);const c=e.length;for(let h=0;h<c;){const p=Math.min(o-this.pos,c-h);if(p===o){const f=Bc(e);for(;o<=c-h;h+=o)this.process(f,h);continue}s.set(e.subarray(h,h+p),this.pos),this.pos+=p,h+=p,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){rf(this),N_(e,this),this.finished=!0;const{buffer:r,view:s,blockLen:o,isLE:c}=this;let{pos:h}=this;r[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>o-h&&(this.process(s,0),h=0);for(let b=h;b<o;b++)r[b]=0;q_(s,o-8,BigInt(this.length*8),c),this.process(s,0);const p=Bc(e),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const y=f/4,v=this.get();if(y>v.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<y;b++)p.setUint32(4*b,v[b],c)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:s,length:o,finished:c,destroyed:h,pos:p}=this;return e.length=o,e.pos=p,e.finished=c,e.destroyed=h,o%r&&e.buffer.set(s),e}}const Ro=BigInt(2**32-1),nu=BigInt(32);function qp(n,e=!1){return e?{h:Number(n&Ro),l:Number(n>>nu&Ro)}:{h:Number(n>>nu&Ro)|0,l:Number(n&Ro)|0}}function z_(n,e=!1){let r=new Uint32Array(n.length),s=new Uint32Array(n.length);for(let o=0;o<n.length;o++){const{h:c,l:h}=qp(n[o],e);[r[o],s[o]]=[c,h]}return[r,s]}const M_=(n,e)=>BigInt(n>>>0)<<nu|BigInt(e>>>0),U_=(n,e,r)=>n>>>r,H_=(n,e,r)=>n<<32-r|e>>>r,k_=(n,e,r)=>n>>>r|e<<32-r,V_=(n,e,r)=>n<<32-r|e>>>r,K_=(n,e,r)=>n<<64-r|e>>>r-32,G_=(n,e,r)=>n>>>r-32|e<<64-r,W_=(n,e)=>e,J_=(n,e)=>n,Q_=(n,e,r)=>n<<r|e>>>32-r,Y_=(n,e,r)=>e<<r|n>>>32-r,Z_=(n,e,r)=>e<<r-32|n>>>64-r,X_=(n,e,r)=>n<<r-32|e>>>64-r;function eE(n,e,r,s){const o=(e>>>0)+(s>>>0);return{h:n+r+(o/2**32|0)|0,l:o|0}}const tE=(n,e,r)=>(n>>>0)+(e>>>0)+(r>>>0),rE=(n,e,r,s)=>e+r+s+(n/2**32|0)|0,iE=(n,e,r,s)=>(n>>>0)+(e>>>0)+(r>>>0)+(s>>>0),nE=(n,e,r,s,o)=>e+r+s+o+(n/2**32|0)|0,sE=(n,e,r,s,o)=>(n>>>0)+(e>>>0)+(r>>>0)+(s>>>0)+(o>>>0),oE=(n,e,r,s,o,c)=>e+r+s+o+c+(n/2**32|0)|0,pe={fromBig:qp,split:z_,toBig:M_,shrSH:U_,shrSL:H_,rotrSH:k_,rotrSL:V_,rotrBH:K_,rotrBL:G_,rotr32H:W_,rotr32L:J_,rotlSH:Q_,rotlSL:Y_,rotlBH:Z_,rotlBL:X_,add:eE,add3L:tE,add3H:rE,add4L:iE,add4H:nE,add5H:oE,add5L:sE},[aE,cE]=(()=>pe.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))))(),ni=new Uint32Array(80),si=new Uint32Array(80);class uE extends j_{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:s,Bl:o,Ch:c,Cl:h,Dh:p,Dl:f,Eh:y,El:v,Fh:b,Fl:S,Gh:O,Gl:F,Hh:N,Hl:G}=this;return[e,r,s,o,c,h,p,f,y,v,b,S,O,F,N,G]}set(e,r,s,o,c,h,p,f,y,v,b,S,O,F,N,G){this.Ah=e|0,this.Al=r|0,this.Bh=s|0,this.Bl=o|0,this.Ch=c|0,this.Cl=h|0,this.Dh=p|0,this.Dl=f|0,this.Eh=y|0,this.El=v|0,this.Fh=b|0,this.Fl=S|0,this.Gh=O|0,this.Gl=F|0,this.Hh=N|0,this.Hl=G|0}process(e,r){for(let L=0;L<16;L++,r+=4)ni[L]=e.getUint32(r),si[L]=e.getUint32(r+=4);for(let L=16;L<80;L++){const M=ni[L-15]|0,Y=si[L-15]|0,he=pe.rotrSH(M,Y,1)^pe.rotrSH(M,Y,8)^pe.shrSH(M,Y,7),ie=pe.rotrSL(M,Y,1)^pe.rotrSL(M,Y,8)^pe.shrSL(M,Y,7),ue=ni[L-2]|0,de=si[L-2]|0,yt=pe.rotrSH(ue,de,19)^pe.rotrBH(ue,de,61)^pe.shrSH(ue,de,6),vt=pe.rotrSL(ue,de,19)^pe.rotrBL(ue,de,61)^pe.shrSL(ue,de,6),Ce=pe.add4L(ie,vt,si[L-7],si[L-16]),tr=pe.add4H(Ce,he,yt,ni[L-7],ni[L-16]);ni[L]=tr|0,si[L]=Ce|0}let{Ah:s,Al:o,Bh:c,Bl:h,Ch:p,Cl:f,Dh:y,Dl:v,Eh:b,El:S,Fh:O,Fl:F,Gh:N,Gl:G,Hh:H,Hl:Z}=this;for(let L=0;L<80;L++){const M=pe.rotrSH(b,S,14)^pe.rotrSH(b,S,18)^pe.rotrBH(b,S,41),Y=pe.rotrSL(b,S,14)^pe.rotrSL(b,S,18)^pe.rotrBL(b,S,41),he=b&O^~b&N,ie=S&F^~S&G,ue=pe.add5L(Z,Y,ie,cE[L],si[L]),de=pe.add5H(ue,H,M,he,aE[L],ni[L]),yt=ue|0,vt=pe.rotrSH(s,o,28)^pe.rotrBH(s,o,34)^pe.rotrBH(s,o,39),Ce=pe.rotrSL(s,o,28)^pe.rotrBL(s,o,34)^pe.rotrBL(s,o,39),tr=s&c^s&p^c&p,Mt=o&h^o&f^h&f;H=N|0,Z=G|0,N=O|0,G=F|0,O=b|0,F=S|0,{h:b,l:S}=pe.add(y|0,v|0,de|0,yt|0),y=p|0,v=f|0,p=c|0,f=h|0,c=s|0,h=o|0;const E=pe.add3L(yt,Ce,Mt);s=pe.add3H(E,de,vt,tr),o=E|0}({h:s,l:o}=pe.add(this.Ah|0,this.Al|0,s|0,o|0)),{h:c,l:h}=pe.add(this.Bh|0,this.Bl|0,c|0,h|0),{h:p,l:f}=pe.add(this.Ch|0,this.Cl|0,p|0,f|0),{h:y,l:v}=pe.add(this.Dh|0,this.Dl|0,y|0,v|0),{h:b,l:S}=pe.add(this.Eh|0,this.El|0,b|0,S|0),{h:O,l:F}=pe.add(this.Fh|0,this.Fl|0,O|0,F|0),{h:N,l:G}=pe.add(this.Gh|0,this.Gl|0,N|0,G|0),{h:H,l:Z}=pe.add(this.Hh|0,this.Hl|0,H|0,Z|0),this.set(s,o,c,h,p,f,y,v,b,S,O,F,N,G,H,Z)}roundClean(){ni.fill(0),si.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const hE=B_(()=>new uE);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const mu=BigInt(0),jp=BigInt(1),lE=BigInt(2);function wu(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function bu(n){if(!wu(n))throw new Error("Uint8Array expected")}function qc(n,e){if(typeof e!="boolean")throw new Error(n+" boolean expected, got "+e)}const fE=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function _u(n){bu(n);let e="";for(let r=0;r<n.length;r++)e+=fE[n[r]];return e}function zp(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?mu:BigInt("0x"+n)}const Br={_0:48,_9:57,A:65,F:70,a:97,f:102};function nf(n){if(n>=Br._0&&n<=Br._9)return n-Br._0;if(n>=Br.A&&n<=Br.F)return n-(Br.A-10);if(n>=Br.a&&n<=Br.f)return n-(Br.a-10)}function Mp(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(r);for(let o=0,c=0;o<r;o++,c+=2){const h=nf(n.charCodeAt(c)),p=nf(n.charCodeAt(c+1));if(h===void 0||p===void 0){const f=n[c]+n[c+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+c)}s[o]=h*16+p}return s}function pE(n){return zp(_u(n))}function Mo(n){return bu(n),zp(_u(Uint8Array.from(n).reverse()))}function Up(n,e){return Mp(n.toString(16).padStart(e*2,"0"))}function su(n,e){return Up(n,e).reverse()}function qr(n,e,r){let s;if(typeof e=="string")try{s=Mp(e)}catch(c){throw new Error(n+" must be hex string or Uint8Array, cause: "+c)}else if(wu(e))s=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const o=s.length;if(typeof r=="number"&&o!==r)throw new Error(n+" of length "+r+" expected, got "+o);return s}function sf(...n){let e=0;for(let s=0;s<n.length;s++){const o=n[s];bu(o),e+=o.length}const r=new Uint8Array(e);for(let s=0,o=0;s<n.length;s++){const c=n[s];r.set(c,o),o+=c.length}return r}const jc=n=>typeof n=="bigint"&&mu<=n;function dE(n,e,r){return jc(n)&&jc(e)&&jc(r)&&e<=n&&n<r}function Qn(n,e,r,s){if(!dE(e,r,s))throw new Error("expected valid "+n+": "+r+" <= n < "+s+", got "+e)}function gE(n){let e;for(e=0;n>mu;n>>=jp,e+=1);return e}const yE=n=>(lE<<BigInt(n-1))-jp,vE={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||wu(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function Eu(n,e,r={}){const s=(o,c,h)=>{const p=vE[c];if(typeof p!="function")throw new Error("invalid validator function");const f=n[o];if(!(h&&f===void 0)&&!p(f,n))throw new Error("param "+String(o)+" is invalid. Expected "+c+", got "+f)};for(const[o,c]of Object.entries(e))s(o,c,!1);for(const[o,c]of Object.entries(r))s(o,c,!0);return n}function of(n){const e=new WeakMap;return(r,...s)=>{const o=e.get(r);if(o!==void 0)return o;const c=n(r,...s);return e.set(r,c),c}}const et=BigInt(0),ke=BigInt(1),Fi=BigInt(2),mE=BigInt(3),ou=BigInt(4),af=BigInt(5),cf=BigInt(8);function Qe(n,e){const r=n%e;return r>=et?r:e+r}function wE(n,e,r){if(e<et)throw new Error("invalid exponent, negatives unsupported");if(r<=et)throw new Error("invalid modulus");if(r===ke)return et;let s=ke;for(;e>et;)e&ke&&(s=s*n%r),n=n*n%r,e>>=ke;return s}function wr(n,e,r){let s=n;for(;e-- >et;)s*=s,s%=r;return s}function uf(n,e){if(n===et)throw new Error("invert: expected non-zero number");if(e<=et)throw new Error("invert: expected positive modulus, got "+e);let r=Qe(n,e),s=e,o=et,c=ke;for(;r!==et;){const h=s/r,p=s%r,f=o-c*h;s=r,r=p,o=c,c=f}if(s!==ke)throw new Error("invert: does not exist");return Qe(o,e)}function bE(n){const e=(n-ke)/Fi;let r,s,o;for(r=n-ke,s=0;r%Fi===et;r/=Fi,s++);for(o=Fi;o<n&&wE(o,e,n)!==n-ke;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(s===1){const h=(n+ke)/ou;return function(p,f){const y=p.pow(f,h);if(!p.eql(p.sqr(y),f))throw new Error("Cannot find square root");return y}}const c=(r+ke)/Fi;return function(h,p){if(h.pow(p,e)===h.neg(h.ONE))throw new Error("Cannot find square root");let f=s,y=h.pow(h.mul(h.ONE,o),r),v=h.pow(p,c),b=h.pow(p,r);for(;!h.eql(b,h.ONE);){if(h.eql(b,h.ZERO))return h.ZERO;let S=1;for(let F=h.sqr(b);S<f&&!h.eql(F,h.ONE);S++)F=h.sqr(F);const O=h.pow(y,ke<<BigInt(f-S-1));y=h.sqr(O),v=h.mul(v,O),b=h.mul(b,y),f=S}return v}}function _E(n){if(n%ou===mE){const e=(n+ke)/ou;return function(r,s){const o=r.pow(s,e);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(n%cf===af){const e=(n-af)/cf;return function(r,s){const o=r.mul(s,Fi),c=r.pow(o,e),h=r.mul(s,c),p=r.mul(r.mul(h,Fi),c),f=r.mul(h,r.sub(p,r.ONE));if(!r.eql(r.sqr(f),s))throw new Error("Cannot find square root");return f}}return bE(n)}const EE=(n,e)=>(Qe(n,e)&ke)===ke,IE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function PE(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=IE.reduce((s,o)=>(s[o]="function",s),e);return Eu(n,r)}function xE(n,e,r){if(r<et)throw new Error("invalid exponent, negatives unsupported");if(r===et)return n.ONE;if(r===ke)return e;let s=n.ONE,o=e;for(;r>et;)r&ke&&(s=n.mul(s,o)),o=n.sqr(o),r>>=ke;return s}function SE(n,e){const r=new Array(e.length),s=e.reduce((c,h,p)=>n.is0(h)?c:(r[p]=c,n.mul(c,h)),n.ONE),o=n.inv(s);return e.reduceRight((c,h,p)=>n.is0(h)?c:(r[p]=n.mul(c,r[p]),n.mul(c,h)),o),r}function Hp(n,e){const r=e!==void 0?e:n.toString(2).length,s=Math.ceil(r/8);return{nBitLength:r,nByteLength:s}}function kp(n,e,r=!1,s={}){if(n<=et)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:o,nByteLength:c}=Hp(n,e);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const p=Object.freeze({ORDER:n,isLE:r,BITS:o,BYTES:c,MASK:yE(o),ZERO:et,ONE:ke,create:f=>Qe(f,n),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return et<=f&&f<n},is0:f=>f===et,isOdd:f=>(f&ke)===ke,neg:f=>Qe(-f,n),eql:(f,y)=>f===y,sqr:f=>Qe(f*f,n),add:(f,y)=>Qe(f+y,n),sub:(f,y)=>Qe(f-y,n),mul:(f,y)=>Qe(f*y,n),pow:(f,y)=>xE(p,f,y),div:(f,y)=>Qe(f*uf(y,n),n),sqrN:f=>f*f,addN:(f,y)=>f+y,subN:(f,y)=>f-y,mulN:(f,y)=>f*y,inv:f=>uf(f,n),sqrt:s.sqrt||(f=>(h||(h=_E(n)),h(p,f))),invertBatch:f=>SE(p,f),cmov:(f,y,v)=>v?y:f,toBytes:f=>r?su(f,c):Up(f,c),fromBytes:f=>{if(f.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);return r?Mo(f):pE(f)}});return Object.freeze(p)}const hf=BigInt(0),Co=BigInt(1);function zc(n,e){const r=e.negate();return n?r:e}function Vp(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function Mc(n,e){Vp(n,e);const r=Math.ceil(e/n)+1,s=2**(n-1);return{windows:r,windowSize:s}}function AE(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((r,s)=>{if(!(r instanceof e))throw new Error("invalid point at index "+s)})}function FE(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((r,s)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+s)})}const Uc=new WeakMap,Kp=new WeakMap;function Hc(n){return Kp.get(n)||1}function OE(n,e){return{constTimeNegate:zc,hasPrecomputes(r){return Hc(r)!==1},unsafeLadder(r,s,o=n.ZERO){let c=r;for(;s>hf;)s&Co&&(o=o.add(c)),c=c.double(),s>>=Co;return o},precomputeWindow(r,s){const{windows:o,windowSize:c}=Mc(s,e),h=[];let p=r,f=p;for(let y=0;y<o;y++){f=p,h.push(f);for(let v=1;v<c;v++)f=f.add(p),h.push(f);p=f.double()}return h},wNAF(r,s,o){const{windows:c,windowSize:h}=Mc(r,e);let p=n.ZERO,f=n.BASE;const y=BigInt(2**r-1),v=2**r,b=BigInt(r);for(let S=0;S<c;S++){const O=S*h;let F=Number(o&y);o>>=b,F>h&&(F-=v,o+=Co);const N=O,G=O+Math.abs(F)-1,H=S%2!==0,Z=F<0;F===0?f=f.add(zc(H,s[N])):p=p.add(zc(Z,s[G]))}return{p,f}},wNAFUnsafe(r,s,o,c=n.ZERO){const{windows:h,windowSize:p}=Mc(r,e),f=BigInt(2**r-1),y=2**r,v=BigInt(r);for(let b=0;b<h;b++){const S=b*p;if(o===hf)break;let O=Number(o&f);if(o>>=v,O>p&&(O-=y,o+=Co),O===0)continue;let F=s[S+Math.abs(O)-1];O<0&&(F=F.negate()),c=c.add(F)}return c},getPrecomputes(r,s,o){let c=Uc.get(s);return c||(c=this.precomputeWindow(s,r),r!==1&&Uc.set(s,o(c))),c},wNAFCached(r,s,o){const c=Hc(r);return this.wNAF(c,this.getPrecomputes(c,r,o),s)},wNAFCachedUnsafe(r,s,o,c){const h=Hc(r);return h===1?this.unsafeLadder(r,s,c):this.wNAFUnsafe(h,this.getPrecomputes(h,r,o),s,c)},setWindowSize(r,s){Vp(s,e),Kp.set(r,s),Uc.delete(r)}}}function RE(n,e,r,s){if(AE(r,n),FE(s,e),r.length!==s.length)throw new Error("arrays of points and scalars must have equal length");const o=n.ZERO,c=gE(BigInt(r.length)),h=c>12?c-3:c>4?c-2:c?2:1,p=(1<<h)-1,f=new Array(p+1).fill(o),y=Math.floor((e.BITS-1)/h)*h;let v=o;for(let b=y;b>=0;b-=h){f.fill(o);for(let O=0;O<s.length;O++){const F=s[O],N=Number(F>>BigInt(b)&BigInt(p));f[N]=f[N].add(r[O])}let S=o;for(let O=f.length-1,F=o;O>0;O--)F=F.add(f[O]),S=S.add(F);if(v=v.add(S),b!==0)for(let O=0;O<h;O++)v=v.double()}return v}function CE(n){return PE(n.Fp),Eu(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Hp(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}const cr=BigInt(0),It=BigInt(1),$o=BigInt(2),$E=BigInt(8),TE={zip215:!0};function NE(n){const e=CE(n);return Eu(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function DE(n){const e=NE(n),{Fp:r,n:s,prehash:o,hash:c,randomBytes:h,nByteLength:p,h:f}=e,y=$o<<BigInt(p*8)-It,v=r.create,b=kp(e.n,e.nBitLength),S=e.uvRatio||((E,A)=>{try{return{isValid:!0,value:r.sqrt(E*r.inv(A))}}catch{return{isValid:!1,value:cr}}}),O=e.adjustScalarBytes||(E=>E),F=e.domain||((E,A,q)=>{if(qc("phflag",q),A.length||q)throw new Error("Contexts/pre-hash are not supported");return E});function N(E,A){Qn("coordinate "+E,A,cr,y)}function G(E){if(!(E instanceof L))throw new Error("ExtendedPoint expected")}const H=of((E,A)=>{const{ex:q,ey:j,ez:W}=E,U=E.is0();A==null&&(A=U?$E:r.inv(W));const ne=v(q*A),Ee=v(j*A),be=v(W*A);if(U)return{x:cr,y:It};if(be!==It)throw new Error("invZ was invalid");return{x:ne,y:Ee}}),Z=of(E=>{const{a:A,d:q}=e;if(E.is0())throw new Error("bad point: ZERO");const{ex:j,ey:W,ez:U,et:ne}=E,Ee=v(j*j),be=v(W*W),se=v(U*U),Q=v(se*se),qe=v(Ee*A),Ct=v(se*v(qe+be)),$e=v(Q+v(q*v(Ee*be)));if(Ct!==$e)throw new Error("bad point: equation left != right (1)");const ze=v(j*W),$t=v(U*ne);if(ze!==$t)throw new Error("bad point: equation left != right (2)");return!0});class L{constructor(A,q,j,W){this.ex=A,this.ey=q,this.ez=j,this.et=W,N("x",A),N("y",q),N("z",j),N("t",W),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(A){if(A instanceof L)throw new Error("extended point not allowed");const{x:q,y:j}=A||{};return N("x",q),N("y",j),new L(q,j,It,v(q*j))}static normalizeZ(A){const q=r.invertBatch(A.map(j=>j.ez));return A.map((j,W)=>j.toAffine(q[W])).map(L.fromAffine)}static msm(A,q){return RE(L,b,A,q)}_setWindowSize(A){he.setWindowSize(this,A)}assertValidity(){Z(this)}equals(A){G(A);const{ex:q,ey:j,ez:W}=this,{ex:U,ey:ne,ez:Ee}=A,be=v(q*Ee),se=v(U*W),Q=v(j*Ee),qe=v(ne*W);return be===se&&Q===qe}is0(){return this.equals(L.ZERO)}negate(){return new L(v(-this.ex),this.ey,this.ez,v(-this.et))}double(){const{a:A}=e,{ex:q,ey:j,ez:W}=this,U=v(q*q),ne=v(j*j),Ee=v($o*v(W*W)),be=v(A*U),se=q+j,Q=v(v(se*se)-U-ne),qe=be+ne,Ct=qe-Ee,$e=be-ne,ze=v(Q*Ct),$t=v(qe*$e),lt=v(Q*$e),Tt=v(Ct*qe);return new L(ze,$t,Tt,lt)}add(A){G(A);const{a:q,d:j}=e,{ex:W,ey:U,ez:ne,et:Ee}=this,{ex:be,ey:se,ez:Q,et:qe}=A;if(q===BigInt(-1)){const Di=v((U-W)*(se+be)),lr=v((U+W)*(se-be)),rt=v(lr-Di);if(rt===cr)return this.double();const fr=v(ne*$o*qe),Ir=v(Ee*$o*Q),Li=Ir+fr,pr=lr+Di,Bi=Ir-fr,Ut=v(Li*rt),Ht=v(pr*Bi),Kr=v(Li*Bi),ot=v(rt*pr);return new L(Ut,Ht,ot,Kr)}const Ct=v(W*be),$e=v(U*se),ze=v(Ee*j*qe),$t=v(ne*Q),lt=v((W+U)*(be+se)-Ct-$e),Tt=$t-ze,Vr=$t+ze,tt=v($e-q*Ct),Er=v(lt*Tt),_n=v(Vr*tt),Nt=v(lt*tt),Ni=v(Tt*Vr);return new L(Er,_n,Ni,Nt)}subtract(A){return this.add(A.negate())}wNAF(A){return he.wNAFCached(this,A,L.normalizeZ)}multiply(A){const q=A;Qn("scalar",q,It,s);const{p:j,f:W}=this.wNAF(q);return L.normalizeZ([j,W])[0]}multiplyUnsafe(A,q=L.ZERO){const j=A;return Qn("scalar",j,cr,s),j===cr?Y:this.is0()||j===It?this:he.wNAFCachedUnsafe(this,j,L.normalizeZ,q)}isSmallOrder(){return this.multiplyUnsafe(f).is0()}isTorsionFree(){return he.unsafeLadder(this,s).is0()}toAffine(A){return H(this,A)}clearCofactor(){const{h:A}=e;return A===It?this:this.multiplyUnsafe(A)}static fromHex(A,q=!1){const{d:j,a:W}=e,U=r.BYTES;A=qr("pointHex",A,U),qc("zip215",q);const ne=A.slice(),Ee=A[U-1];ne[U-1]=Ee&-129;const be=Mo(ne),se=q?y:r.ORDER;Qn("pointHex.y",be,cr,se);const Q=v(be*be),qe=v(Q-It),Ct=v(j*Q-W);let{isValid:$e,value:ze}=S(qe,Ct);if(!$e)throw new Error("Point.fromHex: invalid y coordinate");const $t=(ze&It)===It,lt=(Ee&128)!==0;if(!q&&ze===cr&&lt)throw new Error("Point.fromHex: x=0 and x_0=1");return lt!==$t&&(ze=v(-ze)),L.fromAffine({x:ze,y:be})}static fromPrivateKey(A){return de(A).point}toRawBytes(){const{x:A,y:q}=this.toAffine(),j=su(q,r.BYTES);return j[j.length-1]|=A&It?128:0,j}toHex(){return _u(this.toRawBytes())}}L.BASE=new L(e.Gx,e.Gy,It,v(e.Gx*e.Gy)),L.ZERO=new L(cr,It,It,cr);const{BASE:M,ZERO:Y}=L,he=OE(L,p*8);function ie(E){return Qe(E,s)}function ue(E){return ie(Mo(E))}function de(E){const A=r.BYTES;E=qr("private key",E,A);const q=qr("hashed private key",c(E),2*A),j=O(q.slice(0,A)),W=q.slice(A,2*A),U=ue(j),ne=M.multiply(U),Ee=ne.toRawBytes();return{head:j,prefix:W,scalar:U,point:ne,pointBytes:Ee}}function yt(E){return de(E).pointBytes}function vt(E=new Uint8Array,...A){const q=sf(...A);return ue(c(F(q,qr("context",E),!!o)))}function Ce(E,A,q={}){E=qr("message",E),o&&(E=o(E));const{prefix:j,scalar:W,pointBytes:U}=de(A),ne=vt(q.context,j,E),Ee=M.multiply(ne).toRawBytes(),be=vt(q.context,Ee,U,E),se=ie(ne+be*W);Qn("signature.s",se,cr,s);const Q=sf(Ee,su(se,r.BYTES));return qr("result",Q,r.BYTES*2)}const tr=TE;function Mt(E,A,q,j=tr){const{context:W,zip215:U}=j,ne=r.BYTES;E=qr("signature",E,2*ne),A=qr("message",A),q=qr("publicKey",q,ne),U!==void 0&&qc("zip215",U),o&&(A=o(A));const Ee=Mo(E.slice(ne,2*ne));let be,se,Q;try{be=L.fromHex(q,U),se=L.fromHex(E.slice(0,ne),U),Q=M.multiplyUnsafe(Ee)}catch{return!1}if(!U&&be.isSmallOrder())return!1;const qe=vt(W,se.toRawBytes(),be.toRawBytes(),A);return se.add(be.multiplyUnsafe(qe)).subtract(Q).clearCofactor().equals(L.ZERO)}return M._setWindowSize(8),{CURVE:e,getPublicKey:yt,sign:Ce,verify:Mt,ExtendedPoint:L,utils:{getExtendedPublicKey:de,randomPrivateKey:()=>h(r.BYTES),precompute(E=8,A=L.BASE){return A._setWindowSize(E),A.multiply(BigInt(3)),A}}}}BigInt(0),BigInt(1);const Iu=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),lf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const LE=BigInt(1),ff=BigInt(2);BigInt(3);const BE=BigInt(5),qE=BigInt(8);function jE(n){const e=BigInt(10),r=BigInt(20),s=BigInt(40),o=BigInt(80),c=Iu,h=n*n%c*n%c,p=wr(h,ff,c)*h%c,f=wr(p,LE,c)*n%c,y=wr(f,BE,c)*f%c,v=wr(y,e,c)*y%c,b=wr(v,r,c)*v%c,S=wr(b,s,c)*b%c,O=wr(S,o,c)*S%c,F=wr(O,o,c)*S%c,N=wr(F,e,c)*y%c;return{pow_p_5_8:wr(N,ff,c)*n%c,b2:h}}function zE(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function ME(n,e){const r=Iu,s=Qe(e*e*e,r),o=Qe(s*s*e,r),c=jE(n*o).pow_p_5_8;let h=Qe(n*s*c,r);const p=Qe(e*h*h,r),f=h,y=Qe(h*lf,r),v=p===n,b=p===Qe(-n,r),S=p===Qe(-n*lf,r);return v&&(h=f),(b||S)&&(h=y),EE(h,r)&&(h=Qe(-h,r)),{isValid:v||b,value:h}}const UE=(()=>kp(Iu,void 0,!0))(),HE=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:UE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:qE,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:hE,randomBytes:Bp,adjustScalarBytes:zE,uvRatio:ME}))(),Gp=(()=>DE(HE))(),kE="EdDSA",VE="JWT",Wp=".",Jp="base64url",KE="utf8",GE="utf8",WE=":",JE="did",QE="key",pf="base58btc",YE="z",ZE="K36",XE=32;function Pu(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function Qp(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Pu(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Yp(n,e){e||(e=n.reduce((o,c)=>o+c.length,0));const r=Qp(e);let s=0;for(const o of n)r.set(o,s),s+=o.length;return Pu(r)}function eI(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var o=0;o<n.length;o++){var c=n.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=n.length,f=n.charAt(0),y=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(F){if(F instanceof Uint8Array||(ArrayBuffer.isView(F)?F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength):Array.isArray(F)&&(F=Uint8Array.from(F))),!(F instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(F.length===0)return"";for(var N=0,G=0,H=0,Z=F.length;H!==Z&&F[H]===0;)H++,N++;for(var L=(Z-H)*v+1>>>0,M=new Uint8Array(L);H!==Z;){for(var Y=F[H],he=0,ie=L-1;(Y!==0||he<G)&&ie!==-1;ie--,he++)Y+=256*M[ie]>>>0,M[ie]=Y%p>>>0,Y=Y/p>>>0;if(Y!==0)throw new Error("Non-zero carry");G=he,H++}for(var ue=L-G;ue!==L&&M[ue]===0;)ue++;for(var de=f.repeat(N);ue<L;++ue)de+=n.charAt(M[ue]);return de}function S(F){if(typeof F!="string")throw new TypeError("Expected String");if(F.length===0)return new Uint8Array;var N=0;if(F[N]!==" "){for(var G=0,H=0;F[N]===f;)G++,N++;for(var Z=(F.length-N)*y+1>>>0,L=new Uint8Array(Z);F[N];){var M=r[F.charCodeAt(N)];if(M===255)return;for(var Y=0,he=Z-1;(M!==0||Y<H)&&he!==-1;he--,Y++)M+=p*L[he]>>>0,L[he]=M%256>>>0,M=M/256>>>0;if(M!==0)throw new Error("Non-zero carry");H=Y,N++}if(F[N]!==" "){for(var ie=Z-H;ie!==Z&&L[ie]===0;)ie++;for(var ue=new Uint8Array(G+(Z-ie)),de=G;ie!==Z;)ue[de++]=L[ie++];return ue}}}function O(F){var N=S(F);if(N)return N;throw new Error(`Non-${e} character`)}return{encode:b,decodeUnsafe:S,decode:O}}var tI=eI,rI=tI;const Zp=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},iI=n=>new TextEncoder().encode(n),nI=n=>new TextDecoder().decode(n);let sI=class{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},oI=class{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Xp(this,e)}};class aI{constructor(e){this.decoders=e}or(e){return Xp(this,e)}decode(e){const r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Xp=(n,e)=>new aI({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});let cI=class{constructor(e,r,s,o){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=o,this.encoder=new sI(e,r,s),this.decoder=new oI(e,r,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Jo=({name:n,prefix:e,encode:r,decode:s})=>new cI(n,e,r,s),ds=({prefix:n,name:e,alphabet:r})=>{const{encode:s,decode:o}=rI(r,e);return Jo({prefix:n,name:e,encode:s,decode:c=>Zp(o(c))})},uI=(n,e,r,s)=>{const o={};for(let v=0;v<e.length;++v)o[e[v]]=v;let c=n.length;for(;n[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,y=0;for(let v=0;v<c;++v){const b=o[n[v]];if(b===void 0)throw new SyntaxError(`Non-${s} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[y++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},hI=(n,e,r)=>{const s=e[e.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<n.length;++f)for(p=p<<8|n[f],h+=8;h>r;)h-=r,c+=e[o&p>>h];if(h&&(c+=e[o&p<<r-h]),s)for(;c.length*r&7;)c+="=";return c},nt=({name:n,prefix:e,bitsPerChar:r,alphabet:s})=>Jo({prefix:e,name:n,encode(o){return hI(o,s,r)},decode(o){return uI(o,s,r,n)}}),lI=Jo({prefix:"\0",name:"identity",encode:n=>nI(n),decode:n=>iI(n)});var fI=Object.freeze({__proto__:null,identity:lI});const pI=nt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var dI=Object.freeze({__proto__:null,base2:pI});const gI=nt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var yI=Object.freeze({__proto__:null,base8:gI});const vI=ds({prefix:"9",name:"base10",alphabet:"0123456789"});var mI=Object.freeze({__proto__:null,base10:vI});const wI=nt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bI=nt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var _I=Object.freeze({__proto__:null,base16:wI,base16upper:bI});const EI=nt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),II=nt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),PI=nt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xI=nt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),SI=nt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),AI=nt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),FI=nt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),OI=nt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),RI=nt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var CI=Object.freeze({__proto__:null,base32:EI,base32upper:II,base32pad:PI,base32padupper:xI,base32hex:SI,base32hexupper:AI,base32hexpad:FI,base32hexpadupper:OI,base32z:RI});const $I=ds({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),TI=ds({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var NI=Object.freeze({__proto__:null,base36:$I,base36upper:TI});const DI=ds({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),LI=ds({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var BI=Object.freeze({__proto__:null,base58btc:DI,base58flickr:LI});const qI=nt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),jI=nt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zI=nt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),MI=nt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var UI=Object.freeze({__proto__:null,base64:qI,base64pad:jI,base64url:zI,base64urlpad:MI});const ed=Array.from(""),HI=ed.reduce((n,e,r)=>(n[r]=e,n),[]),kI=ed.reduce((n,e,r)=>(n[e.codePointAt(0)]=r,n),[]);function VI(n){return n.reduce((e,r)=>(e+=HI[r],e),"")}function KI(n){const e=[];for(const r of n){const s=kI[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}const GI=Jo({prefix:"",name:"base256emoji",encode:VI,decode:KI});var WI=Object.freeze({__proto__:null,base256emoji:GI}),JI=td,df=128,QI=127,YI=~QI,ZI=Math.pow(2,31);function td(n,e,r){e=e||[],r=r||0;for(var s=r;n>=ZI;)e[r++]=n&255|df,n/=128;for(;n&YI;)e[r++]=n&255|df,n>>>=7;return e[r]=n|0,td.bytes=r-s+1,e}var XI=au,e2=128,gf=127;function au(n,s){var r=0,s=s||0,o=0,c=s,h,p=n.length;do{if(c>=p)throw au.bytes=0,new RangeError("Could not decode varint");h=n[c++],r+=o<28?(h&gf)<<o:(h&gf)*Math.pow(2,o),o+=7}while(h>=e2);return au.bytes=c-s,r}var t2=Math.pow(2,7),r2=Math.pow(2,14),i2=Math.pow(2,21),n2=Math.pow(2,28),s2=Math.pow(2,35),o2=Math.pow(2,42),a2=Math.pow(2,49),c2=Math.pow(2,56),u2=Math.pow(2,63),h2=function(n){return n<t2?1:n<r2?2:n<i2?3:n<n2?4:n<s2?5:n<o2?6:n<a2?7:n<c2?8:n<u2?9:10},l2={encode:JI,decode:XI,encodingLength:h2},rd=l2;const yf=(n,e,r=0)=>(rd.encode(n,e,r),e),vf=n=>rd.encodingLength(n),cu=(n,e)=>{const r=e.byteLength,s=vf(n),o=s+vf(r),c=new Uint8Array(o+r);return yf(n,c,0),yf(r,c,s),c.set(e,o),new f2(n,r,e,c)};class f2{constructor(e,r,s,o){this.code=e,this.size=r,this.digest=s,this.bytes=o}}const id=({name:n,code:e,encode:r})=>new p2(n,e,r);class p2{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?cu(this.code,r):r.then(s=>cu(this.code,s))}else throw Error("Unknown type, must be binary type")}}const nd=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),d2=id({name:"sha2-256",code:18,encode:nd("SHA-256")}),g2=id({name:"sha2-512",code:19,encode:nd("SHA-512")});var y2=Object.freeze({__proto__:null,sha256:d2,sha512:g2});const sd=0,v2="identity",od=Zp,m2=n=>cu(sd,od(n)),w2={code:sd,name:v2,encode:od,digest:m2};var b2=Object.freeze({__proto__:null,identity:w2});new TextEncoder,new TextDecoder;const mf={...fI,...dI,...yI,...mI,..._I,...CI,...NI,...BI,...UI,...WI};({...y2,...b2});function ad(n,e,r,s){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:r},decoder:{decode:s}}}const wf=ad("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),kc=ad("ascii","a",n=>{let e="a";for(let r=0;r<n.length;r++)e+=String.fromCharCode(n[r]);return e},n=>{n=n.substring(1);const e=Qp(n.length);for(let r=0;r<n.length;r++)e[r]=n.charCodeAt(r);return e}),cd={utf8:wf,"utf-8":wf,hex:mf.base16,latin1:kc,ascii:kc,binary:kc,...mf};function xu(n,e="utf8"){const r=cd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):r.encoder.encode(n).substring(1)}function Su(n,e="utf8"){const r=cd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Pu(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}function Uo(n){return xu(Su(Ri(n),KE),Jp)}function ud(n){const e=Su(ZE,pf),r=YE+xu(Yp([e,n]),pf);return[JE,QE,r].join(WE)}function _2(n){return xu(n,Jp)}function E2(n){return Su([Uo(n.header),Uo(n.payload)].join(Wp),GE)}function I2(n){return[Uo(n.header),Uo(n.payload),_2(n.signature)].join(Wp)}function bf(n=Bp(XE)){const e=Gp.getPublicKey(n);return{secretKey:Yp([n,e]),publicKey:e}}async function P2(n,e,r,s,o=X.fromMiliseconds(Date.now())){const c={alg:kE,typ:VE},h=ud(s.publicKey),p=o+r,f={iss:h,sub:n,aud:e,iat:o,exp:p},y=E2({header:c,payload:f}),v=Gp.sign(y,s.secretKey.slice(0,32));return I2({header:c,payload:f,signature:v})}const x2="PARSE_ERROR",S2="INVALID_REQUEST",A2="METHOD_NOT_FOUND",F2="INVALID_PARAMS",hd="INTERNAL_ERROR",Au="SERVER_ERROR",O2=[-32700,-32600,-32601,-32602,-32603],ss={[x2]:{code:-32700,message:"Parse error"},[S2]:{code:-32600,message:"Invalid Request"},[A2]:{code:-32601,message:"Method not found"},[F2]:{code:-32602,message:"Invalid params"},[hd]:{code:-32603,message:"Internal error"},[Au]:{code:-32e3,message:"Server error"}},ld=Au;function R2(n){return O2.includes(n)}function _f(n){return Object.keys(ss).includes(n)?ss[n]:ss[ld]}function C2(n){const e=Object.values(ss).find(r=>r.code===n);return e||ss[ld]}function fd(n,e,r){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):n}var pd={},jr={},Ef;function $2(){if(Ef)return jr;Ef=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.isBrowserCryptoAvailable=jr.getSubtleCrypto=jr.getBrowerCrypto=void 0;function n(){return(At===null||At===void 0?void 0:At.crypto)||(At===null||At===void 0?void 0:At.msCrypto)||{}}jr.getBrowerCrypto=n;function e(){const s=n();return s.subtle||s.webkitSubtle}jr.getSubtleCrypto=e;function r(){return!!n()&&!!e()}return jr.isBrowserCryptoAvailable=r,jr}var zr={},If;function T2(){if(If)return zr;If=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.isBrowser=zr.isNode=zr.isReactNative=void 0;function n(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}zr.isReactNative=n;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}zr.isNode=e;function r(){return!n()&&!e()}return zr.isBrowser=r,zr}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const e=hs;e.__exportStar($2(),n),e.__exportStar(T2(),n)})(pd);function Fu(n=3){const e=Date.now()*Math.pow(10,n),r=Math.floor(Math.random()*Math.pow(10,n));return e+r}function Ou(n=6){return BigInt(Fu(n))}function Oi(n,e,r){return{id:r||Fu(),jsonrpc:"2.0",method:n,params:e}}function Qo(n,e){return{id:n,jsonrpc:"2.0",result:e}}function Yo(n,e,r){return{id:n,jsonrpc:"2.0",error:N2(e,r)}}function N2(n,e){return typeof n>"u"?_f(hd):(typeof n=="string"&&(n=Object.assign(Object.assign({},_f(Au)),{message:n})),typeof e<"u"&&(n.data=e),R2(n.code)&&(n=C2(n.code)),n)}class D2{}class L2 extends D2{constructor(){super()}}class dd extends L2{constructor(e){super()}}const B2="^https?:",q2="^wss?:";function j2(n){const e=n.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function gd(n,e){const r=j2(n);return typeof r>"u"?!1:new RegExp(e).test(r)}function Pf(n){return gd(n,B2)}function xf(n){return gd(n,q2)}function z2(n){return new RegExp("wss?://localhost(:d{2,5})?").test(n)}function yd(n){return typeof n=="object"&&"id"in n&&"jsonrpc"in n&&n.jsonrpc==="2.0"}function Ru(n){return yd(n)&&"method"in n}function gs(n){return yd(n)&&(Hr(n)||er(n))}function Hr(n){return"result"in n}function er(n){return"error"in n}let M2=class extends dd{constructor(e){super(e),this.events=new Ft.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Oi(e.method,e.params||[],e.id||Ou().toString()),r)}async requestStrict(e,r){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${e.id}`,c=>{er(c)?o(c.error):s(c.result)});try{await this.connection.send(e,r)}catch(c){o(c)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),gs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const U2=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),H2=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Sf=n=>n.split("?")[0],Af=10,k2=U2();let V2=class{constructor(e){if(this.url=e,this.events=new Ft.EventEmitter,this.registering=!1,!xf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ri(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!xf(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,s)=>{const o=new URLSearchParams(e).get("origin"),c=pd.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!z2(e)},h=new k2(e,[],c);H2()?h.onerror=p=>{const f=p;s(this.emitError(f.error))}:h.on("error",p=>{s(this.emitError(p))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?fs(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const s=this.parseError(r),o=s.message||s.toString(),c=Yo(e,o);this.events.emit("payload",c)}parseError(e,r=this.url){return fd(e,Sf(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Af&&this.events.setMaxListeners(Af)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Sf(this.url)}`));return this.events.emit("register_error",r),r}};var Ho={exports:{}};Ho.exports;(function(n,e){var r=200,s="__lodash_hash_undefined__",o=1,c=2,h=9007199254740991,p="[object Arguments]",f="[object Array]",y="[object AsyncFunction]",v="[object Boolean]",b="[object Date]",S="[object Error]",O="[object Function]",F="[object GeneratorFunction]",N="[object Map]",G="[object Number]",H="[object Null]",Z="[object Object]",L="[object Promise]",M="[object Proxy]",Y="[object RegExp]",he="[object Set]",ie="[object String]",ue="[object Symbol]",de="[object Undefined]",yt="[object WeakMap]",vt="[object ArrayBuffer]",Ce="[object DataView]",tr="[object Float32Array]",Mt="[object Float64Array]",E="[object Int8Array]",A="[object Int16Array]",q="[object Int32Array]",j="[object Uint8Array]",W="[object Uint8ClampedArray]",U="[object Uint16Array]",ne="[object Uint32Array]",Ee=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,se=/^(?:0|[1-9]\d*)$/,Q={};Q[tr]=Q[Mt]=Q[E]=Q[A]=Q[q]=Q[j]=Q[W]=Q[U]=Q[ne]=!0,Q[p]=Q[f]=Q[vt]=Q[v]=Q[Ce]=Q[b]=Q[S]=Q[O]=Q[N]=Q[G]=Q[Z]=Q[Y]=Q[he]=Q[ie]=Q[yt]=!1;var qe=typeof At=="object"&&At&&At.Object===Object&&At,Ct=typeof self=="object"&&self&&self.Object===Object&&self,$e=qe||Ct||Function("return this")(),ze=e&&!e.nodeType&&e,$t=ze&&!0&&n&&!n.nodeType&&n,lt=$t&&$t.exports===ze,Tt=lt&&qe.process,Vr=function(){try{return Tt&&Tt.binding&&Tt.binding("util")}catch{}}(),tt=Vr&&Vr.isTypedArray;function Er(m,I){for(var D=-1,k=m==null?0:m.length,Fe=0,ae=[];++D<k;){var Te=m[D];I(Te,D,m)&&(ae[Fe++]=Te)}return ae}function _n(m,I){for(var D=-1,k=I.length,Fe=m.length;++D<k;)m[Fe+D]=I[D];return m}function Nt(m,I){for(var D=-1,k=m==null?0:m.length;++D<k;)if(I(m[D],D,m))return!0;return!1}function Ni(m,I){for(var D=-1,k=Array(m);++D<m;)k[D]=I(D);return k}function Di(m){return function(I){return m(I)}}function lr(m,I){return m.has(I)}function rt(m,I){return m==null?void 0:m[I]}function fr(m){var I=-1,D=Array(m.size);return m.forEach(function(k,Fe){D[++I]=[Fe,k]}),D}function Ir(m,I){return function(D){return m(I(D))}}function Li(m){var I=-1,D=Array(m.size);return m.forEach(function(k){D[++I]=k}),D}var pr=Array.prototype,Bi=Function.prototype,Ut=Object.prototype,Ht=$e["__core-js_shared__"],Kr=Bi.toString,ot=Ut.hasOwnProperty,qi=function(){var m=/[^.]+$/.exec(Ht&&Ht.keys&&Ht.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),ji=Ut.toString,En=RegExp("^"+Kr.call(ot).replace(Ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zi=lt?$e.Buffer:void 0,Gr=$e.Symbol,Mi=$e.Uint8Array,Ui=Ut.propertyIsEnumerable,ea=pr.splice,Pr=Gr?Gr.toStringTag:void 0,vs=Object.getOwnPropertySymbols,ms=zi?zi.isBuffer:void 0,ws=Ir(Object.keys,Object),In=Dt($e,"DataView"),fi=Dt($e,"Map"),Pn=Dt($e,"Promise"),xn=Dt($e,"Set"),Hi=Dt($e,"WeakMap"),pi=Dt(Object,"create"),ta=Ar(In),ra=Ar(fi),Sn=Ar(Pn),ia=Ar(xn),An=Ar(Hi),bs=Gr?Gr.prototype:void 0,Fn=bs?bs.valueOf:void 0;function xr(m){var I=-1,D=m==null?0:m.length;for(this.clear();++I<D;){var k=m[I];this.set(k[0],k[1])}}function na(){this.__data__=pi?pi(null):{},this.size=0}function sa(m){var I=this.has(m)&&delete this.__data__[m];return this.size-=I?1:0,I}function oa(m){var I=this.__data__;if(pi){var D=I[m];return D===s?void 0:D}return ot.call(I,m)?I[m]:void 0}function aa(m){var I=this.__data__;return pi?I[m]!==void 0:ot.call(I,m)}function ca(m,I){var D=this.__data__;return this.size+=this.has(m)?0:1,D[m]=pi&&I===void 0?s:I,this}xr.prototype.clear=na,xr.prototype.delete=sa,xr.prototype.get=oa,xr.prototype.has=aa,xr.prototype.set=ca;function kt(m){var I=-1,D=m==null?0:m.length;for(this.clear();++I<D;){var k=m[I];this.set(k[0],k[1])}}function ua(){this.__data__=[],this.size=0}function ha(m){var I=this.__data__,D=di(I,m);if(D<0)return!1;var k=I.length-1;return D==k?I.pop():ea.call(I,D,1),--this.size,!0}function la(m){var I=this.__data__,D=di(I,m);return D<0?void 0:I[D][1]}function fa(m){return di(this.__data__,m)>-1}function pa(m,I){var D=this.__data__,k=di(D,m);return k<0?(++this.size,D.push([m,I])):D[k][1]=I,this}kt.prototype.clear=ua,kt.prototype.delete=ha,kt.prototype.get=la,kt.prototype.has=fa,kt.prototype.set=pa;function Sr(m){var I=-1,D=m==null?0:m.length;for(this.clear();++I<D;){var k=m[I];this.set(k[0],k[1])}}function ki(){this.size=0,this.__data__={hash:new xr,map:new(fi||kt),string:new xr}}function da(m){var I=Wr(this,m).delete(m);return this.size-=I?1:0,I}function Vi(m){return Wr(this,m).get(m)}function ga(m){return Wr(this,m).has(m)}function ya(m,I){var D=Wr(this,m),k=D.size;return D.set(m,I),this.size+=D.size==k?0:1,this}Sr.prototype.clear=ki,Sr.prototype.delete=da,Sr.prototype.get=Vi,Sr.prototype.has=ga,Sr.prototype.set=ya;function Ki(m){var I=-1,D=m==null?0:m.length;for(this.__data__=new Sr;++I<D;)this.add(m[I])}function _s(m){return this.__data__.set(m,s),this}function Es(m){return this.__data__.has(m)}Ki.prototype.add=Ki.prototype.push=_s,Ki.prototype.has=Es;function rr(m){var I=this.__data__=new kt(m);this.size=I.size}function va(){this.__data__=new kt,this.size=0}function ma(m){var I=this.__data__,D=I.delete(m);return this.size=I.size,D}function wa(m){return this.__data__.get(m)}function ba(m){return this.__data__.has(m)}function Is(m,I){var D=this.__data__;if(D instanceof kt){var k=D.__data__;if(!fi||k.length<r-1)return k.push([m,I]),this.size=++D.size,this;D=this.__data__=new Sr(k)}return D.set(m,I),this.size=D.size,this}rr.prototype.clear=va,rr.prototype.delete=ma,rr.prototype.get=wa,rr.prototype.has=ba,rr.prototype.set=Is;function Ps(m,I){var D=Ji(m),k=!D&&Ls(m),Fe=!D&&!k&&Cn(m),ae=!D&&!k&&!Fe&&js(m),Te=D||k||Fe||ae,Ve=Te?Ni(m.length,String):[],me=Ve.length;for(var Oe in m)(I||ot.call(m,Oe))&&!(Te&&(Oe=="length"||Fe&&(Oe=="offset"||Oe=="parent")||ae&&(Oe=="buffer"||Oe=="byteLength"||Oe=="byteOffset")||Cs(Oe,me)))&&Ve.push(Oe);return Ve}function di(m,I){for(var D=m.length;D--;)if(Ds(m[D][0],I))return D;return-1}function On(m,I,D){var k=I(m);return Ji(m)?k:_n(k,D(m))}function gi(m){return m==null?m===void 0?de:H:Pr&&Pr in Object(m)?Os(m):Ia(m)}function Rn(m){return vi(m)&&gi(m)==p}function yi(m,I,D,k,Fe){return m===I?!0:m==null||I==null||!vi(m)&&!vi(I)?m!==m&&I!==I:xs(m,I,D,k,yi,Fe)}function xs(m,I,D,k,Fe,ae){var Te=Ji(m),Ve=Ji(I),me=Te?f:dr(m),Oe=Ve?f:dr(I);me=me==p?Z:me,Oe=Oe==p?Z:Oe;var Me=me==Z,mt=Oe==Z,Ke=me==Oe;if(Ke&&Cn(m)){if(!Cn(I))return!1;Te=!0,Me=!1}if(Ke&&!Me)return ae||(ae=new rr),Te||js(m)?Gi(m,I,D,k,Fe,ae):Ea(m,I,me,D,k,Fe,ae);if(!(D&o)){var Ne=Me&&ot.call(m,"__wrapped__"),ft=mt&&ot.call(I,"__wrapped__");if(Ne||ft){var ir=Ne?m.value():m,Vt=ft?I.value():I;return ae||(ae=new rr),Fe(ir,Vt,D,k,ae)}}return Ke?(ae||(ae=new rr),Fs(m,I,D,k,Fe,ae)):!1}function _a(m){if(!qs(m)||Ts(m))return!1;var I=Qi(m)?En:be;return I.test(Ar(m))}function Ss(m){return vi(m)&&Bs(m.length)&&!!Q[gi(m)]}function As(m){if(!Ns(m))return ws(m);var I=[];for(var D in Object(m))ot.call(m,D)&&D!="constructor"&&I.push(D);return I}function Gi(m,I,D,k,Fe,ae){var Te=D&o,Ve=m.length,me=I.length;if(Ve!=me&&!(Te&&me>Ve))return!1;var Oe=ae.get(m);if(Oe&&ae.get(I))return Oe==I;var Me=-1,mt=!0,Ke=D&c?new Ki:void 0;for(ae.set(m,I),ae.set(I,m);++Me<Ve;){var Ne=m[Me],ft=I[Me];if(k)var ir=Te?k(ft,Ne,Me,I,m,ae):k(Ne,ft,Me,m,I,ae);if(ir!==void 0){if(ir)continue;mt=!1;break}if(Ke){if(!Nt(I,function(Vt,gr){if(!lr(Ke,gr)&&(Ne===Vt||Fe(Ne,Vt,D,k,ae)))return Ke.push(gr)})){mt=!1;break}}else if(!(Ne===ft||Fe(Ne,ft,D,k,ae))){mt=!1;break}}return ae.delete(m),ae.delete(I),mt}function Ea(m,I,D,k,Fe,ae,Te){switch(D){case Ce:if(m.byteLength!=I.byteLength||m.byteOffset!=I.byteOffset)return!1;m=m.buffer,I=I.buffer;case vt:return!(m.byteLength!=I.byteLength||!ae(new Mi(m),new Mi(I)));case v:case b:case G:return Ds(+m,+I);case S:return m.name==I.name&&m.message==I.message;case Y:case ie:return m==I+"";case N:var Ve=fr;case he:var me=k&o;if(Ve||(Ve=Li),m.size!=I.size&&!me)return!1;var Oe=Te.get(m);if(Oe)return Oe==I;k|=c,Te.set(m,I);var Me=Gi(Ve(m),Ve(I),k,Fe,ae,Te);return Te.delete(m),Me;case ue:if(Fn)return Fn.call(m)==Fn.call(I)}return!1}function Fs(m,I,D,k,Fe,ae){var Te=D&o,Ve=Wi(m),me=Ve.length,Oe=Wi(I),Me=Oe.length;if(me!=Me&&!Te)return!1;for(var mt=me;mt--;){var Ke=Ve[mt];if(!(Te?Ke in I:ot.call(I,Ke)))return!1}var Ne=ae.get(m);if(Ne&&ae.get(I))return Ne==I;var ft=!0;ae.set(m,I),ae.set(I,m);for(var ir=Te;++mt<me;){Ke=Ve[mt];var Vt=m[Ke],gr=I[Ke];if(k)var $n=Te?k(gr,Vt,Ke,I,m,ae):k(Vt,gr,Ke,m,I,ae);if(!($n===void 0?Vt===gr||Fe(Vt,gr,D,k,ae):$n)){ft=!1;break}ir||(ir=Ke=="constructor")}if(ft&&!ir){var mi=m.constructor,Ye=I.constructor;mi!=Ye&&"constructor"in m&&"constructor"in I&&!(typeof mi=="function"&&mi instanceof mi&&typeof Ye=="function"&&Ye instanceof Ye)&&(ft=!1)}return ae.delete(m),ae.delete(I),ft}function Wi(m){return On(m,Sa,Rs)}function Wr(m,I){var D=m.__data__;return $s(I)?D[typeof I=="string"?"string":"hash"]:D.map}function Dt(m,I){var D=rt(m,I);return _a(D)?D:void 0}function Os(m){var I=ot.call(m,Pr),D=m[Pr];try{m[Pr]=void 0;var k=!0}catch{}var Fe=ji.call(m);return k&&(I?m[Pr]=D:delete m[Pr]),Fe}var Rs=vs?function(m){return m==null?[]:(m=Object(m),Er(vs(m),function(I){return Ui.call(m,I)}))}:Ae,dr=gi;(In&&dr(new In(new ArrayBuffer(1)))!=Ce||fi&&dr(new fi)!=N||Pn&&dr(Pn.resolve())!=L||xn&&dr(new xn)!=he||Hi&&dr(new Hi)!=yt)&&(dr=function(m){var I=gi(m),D=I==Z?m.constructor:void 0,k=D?Ar(D):"";if(k)switch(k){case ta:return Ce;case ra:return N;case Sn:return L;case ia:return he;case An:return yt}return I});function Cs(m,I){return I=I??h,!!I&&(typeof m=="number"||se.test(m))&&m>-1&&m%1==0&&m<I}function $s(m){var I=typeof m;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?m!=="__proto__":m===null}function Ts(m){return!!qi&&qi in m}function Ns(m){var I=m&&m.constructor,D=typeof I=="function"&&I.prototype||Ut;return m===D}function Ia(m){return ji.call(m)}function Ar(m){if(m!=null){try{return Kr.call(m)}catch{}try{return m+""}catch{}}return""}function Ds(m,I){return m===I||m!==m&&I!==I}var Ls=Rn(function(){return arguments}())?Rn:function(m){return vi(m)&&ot.call(m,"callee")&&!Ui.call(m,"callee")},Ji=Array.isArray;function Pa(m){return m!=null&&Bs(m.length)&&!Qi(m)}var Cn=ms||xe;function xa(m,I){return yi(m,I)}function Qi(m){if(!qs(m))return!1;var I=gi(m);return I==O||I==F||I==y||I==M}function Bs(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=h}function qs(m){var I=typeof m;return m!=null&&(I=="object"||I=="function")}function vi(m){return m!=null&&typeof m=="object"}var js=tt?Di(tt):Ss;function Sa(m){return Pa(m)?Ps(m):As(m)}function Ae(){return[]}function xe(){return!1}n.exports=xa})(Ho,Ho.exports);var K2=Ho.exports;const G2=us(K2);function W2(n,e){return e=e||{},new Promise(function(r,s){var o=new XMLHttpRequest,c=[],h=[],p={},f=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:f,headers:{keys:function(){return c},entries:function(){return h},get:function(v){return p[v.toLowerCase()]},has:function(v){return v.toLowerCase()in p}}}};for(var y in o.open(e.method||"get",n,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(v,b,S){c.push(b=b.toLowerCase()),h.push([b,S]),p[b]=p[b]?p[b]+","+S:S}),r(f())},o.onerror=s,o.withCredentials=e.credentials=="include",e.headers)o.setRequestHeader(y,e.headers[y]);o.send(e.body||null)})}const J2=Object.freeze(Object.defineProperty({__proto__:null,default:W2},Symbol.toStringTag,{value:"Module"})),Ff=pp(J2);var Q2=self.fetch||(self.fetch=Ff.default||Ff);const Y2=us(Q2);function Z2(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var o=0;o<n.length;o++){var c=n.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=n.length,f=n.charAt(0),y=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(F){if(F instanceof Uint8Array||(ArrayBuffer.isView(F)?F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength):Array.isArray(F)&&(F=Uint8Array.from(F))),!(F instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(F.length===0)return"";for(var N=0,G=0,H=0,Z=F.length;H!==Z&&F[H]===0;)H++,N++;for(var L=(Z-H)*v+1>>>0,M=new Uint8Array(L);H!==Z;){for(var Y=F[H],he=0,ie=L-1;(Y!==0||he<G)&&ie!==-1;ie--,he++)Y+=256*M[ie]>>>0,M[ie]=Y%p>>>0,Y=Y/p>>>0;if(Y!==0)throw new Error("Non-zero carry");G=he,H++}for(var ue=L-G;ue!==L&&M[ue]===0;)ue++;for(var de=f.repeat(N);ue<L;++ue)de+=n.charAt(M[ue]);return de}function S(F){if(typeof F!="string")throw new TypeError("Expected String");if(F.length===0)return new Uint8Array;var N=0;if(F[N]!==" "){for(var G=0,H=0;F[N]===f;)G++,N++;for(var Z=(F.length-N)*y+1>>>0,L=new Uint8Array(Z);F[N];){var M=r[F.charCodeAt(N)];if(M===255)return;for(var Y=0,he=Z-1;(M!==0||Y<H)&&he!==-1;he--,Y++)M+=p*L[he]>>>0,L[he]=M%256>>>0,M=M/256>>>0;if(M!==0)throw new Error("Non-zero carry");H=Y,N++}if(F[N]!==" "){for(var ie=Z-H;ie!==Z&&L[ie]===0;)ie++;for(var ue=new Uint8Array(G+(Z-ie)),de=G;ie!==Z;)ue[de++]=L[ie++];return ue}}}function O(F){var N=S(F);if(N)return N;throw new Error(`Non-${e} character`)}return{encode:b,decodeUnsafe:S,decode:O}}var X2=Z2,eP=X2;const vd=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},tP=n=>new TextEncoder().encode(n),rP=n=>new TextDecoder().decode(n);class iP{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class nP{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return md(this,e)}}class sP{constructor(e){this.decoders=e}or(e){return md(this,e)}decode(e){const r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const md=(n,e)=>new sP({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class oP{constructor(e,r,s,o){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=o,this.encoder=new iP(e,r,s),this.decoder=new nP(e,r,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Zo=({name:n,prefix:e,encode:r,decode:s})=>new oP(n,e,r,s),ys=({prefix:n,name:e,alphabet:r})=>{const{encode:s,decode:o}=eP(r,e);return Zo({prefix:n,name:e,encode:s,decode:c=>vd(o(c))})},aP=(n,e,r,s)=>{const o={};for(let v=0;v<e.length;++v)o[e[v]]=v;let c=n.length;for(;n[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,y=0;for(let v=0;v<c;++v){const b=o[n[v]];if(b===void 0)throw new SyntaxError(`Non-${s} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[y++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},cP=(n,e,r)=>{const s=e[e.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<n.length;++f)for(p=p<<8|n[f],h+=8;h>r;)h-=r,c+=e[o&p>>h];if(h&&(c+=e[o&p<<r-h]),s)for(;c.length*r&7;)c+="=";return c},st=({name:n,prefix:e,bitsPerChar:r,alphabet:s})=>Zo({prefix:e,name:n,encode(o){return cP(o,s,r)},decode(o){return aP(o,s,r,n)}}),uP=Zo({prefix:"\0",name:"identity",encode:n=>rP(n),decode:n=>tP(n)});var hP=Object.freeze({__proto__:null,identity:uP});const lP=st({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var fP=Object.freeze({__proto__:null,base2:lP});const pP=st({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var dP=Object.freeze({__proto__:null,base8:pP});const gP=ys({prefix:"9",name:"base10",alphabet:"0123456789"});var yP=Object.freeze({__proto__:null,base10:gP});const vP=st({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),mP=st({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var wP=Object.freeze({__proto__:null,base16:vP,base16upper:mP});const bP=st({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_P=st({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),EP=st({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),IP=st({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),PP=st({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xP=st({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),SP=st({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),AP=st({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),FP=st({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var OP=Object.freeze({__proto__:null,base32:bP,base32upper:_P,base32pad:EP,base32padupper:IP,base32hex:PP,base32hexupper:xP,base32hexpad:SP,base32hexpadupper:AP,base32z:FP});const RP=ys({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),CP=ys({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var $P=Object.freeze({__proto__:null,base36:RP,base36upper:CP});const TP=ys({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),NP=ys({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var DP=Object.freeze({__proto__:null,base58btc:TP,base58flickr:NP});const LP=st({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),BP=st({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),qP=st({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),jP=st({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var zP=Object.freeze({__proto__:null,base64:LP,base64pad:BP,base64url:qP,base64urlpad:jP});const wd=Array.from(""),MP=wd.reduce((n,e,r)=>(n[r]=e,n),[]),UP=wd.reduce((n,e,r)=>(n[e.codePointAt(0)]=r,n),[]);function HP(n){return n.reduce((e,r)=>(e+=MP[r],e),"")}function kP(n){const e=[];for(const r of n){const s=UP[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}const VP=Zo({prefix:"",name:"base256emoji",encode:HP,decode:kP});var KP=Object.freeze({__proto__:null,base256emoji:VP}),GP=bd,Of=128,WP=127,JP=~WP,QP=Math.pow(2,31);function bd(n,e,r){e=e||[],r=r||0;for(var s=r;n>=QP;)e[r++]=n&255|Of,n/=128;for(;n&JP;)e[r++]=n&255|Of,n>>>=7;return e[r]=n|0,bd.bytes=r-s+1,e}var YP=uu,ZP=128,Rf=127;function uu(n,s){var r=0,s=s||0,o=0,c=s,h,p=n.length;do{if(c>=p)throw uu.bytes=0,new RangeError("Could not decode varint");h=n[c++],r+=o<28?(h&Rf)<<o:(h&Rf)*Math.pow(2,o),o+=7}while(h>=ZP);return uu.bytes=c-s,r}var XP=Math.pow(2,7),ex=Math.pow(2,14),tx=Math.pow(2,21),rx=Math.pow(2,28),ix=Math.pow(2,35),nx=Math.pow(2,42),sx=Math.pow(2,49),ox=Math.pow(2,56),ax=Math.pow(2,63),cx=function(n){return n<XP?1:n<ex?2:n<tx?3:n<rx?4:n<ix?5:n<nx?6:n<sx?7:n<ox?8:n<ax?9:10},ux={encode:GP,decode:YP,encodingLength:cx},_d=ux;const Cf=(n,e,r=0)=>(_d.encode(n,e,r),e),$f=n=>_d.encodingLength(n),hu=(n,e)=>{const r=e.byteLength,s=$f(n),o=s+$f(r),c=new Uint8Array(o+r);return Cf(n,c,0),Cf(r,c,s),c.set(e,o),new hx(n,r,e,c)};class hx{constructor(e,r,s,o){this.code=e,this.size=r,this.digest=s,this.bytes=o}}const Ed=({name:n,code:e,encode:r})=>new lx(n,e,r);class lx{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?hu(this.code,r):r.then(s=>hu(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Id=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),fx=Ed({name:"sha2-256",code:18,encode:Id("SHA-256")}),px=Ed({name:"sha2-512",code:19,encode:Id("SHA-512")});var dx=Object.freeze({__proto__:null,sha256:fx,sha512:px});const Pd=0,gx="identity",xd=vd,yx=n=>hu(Pd,xd(n)),vx={code:Pd,name:gx,encode:xd,digest:yx};var mx=Object.freeze({__proto__:null,identity:vx});new TextEncoder,new TextDecoder;const Tf={...hP,...fP,...dP,...yP,...wP,...OP,...$P,...DP,...zP,...KP};({...dx,...mx});function Sd(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function wx(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Sd(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Ad(n,e,r,s){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:r},decoder:{decode:s}}}const Nf=Ad("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Vc=Ad("ascii","a",n=>{let e="a";for(let r=0;r<n.length;r++)e+=String.fromCharCode(n[r]);return e},n=>{n=n.substring(1);const e=wx(n.length);for(let r=0;r<n.length;r++)e[r]=n.charCodeAt(r);return e}),bx={utf8:Nf,"utf-8":Nf,hex:Tf.base16,latin1:Vc,ascii:Vc,binary:Vc,...Tf};function _x(n,e="utf8"){const r=bx[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Sd(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}const Fd="wc",Ex=2,Cu="core",ci=`${Fd}@2:${Cu}:`,Ix={name:Cu,logger:"error"},Px={database:":memory:"},xx="crypto",Df="client_ed25519_seed",Sx=X.ONE_DAY,Ax="keychain",Fx="0.3",Ox="messages",Rx="0.3",Cx=X.SIX_HOURS,$x="publisher",Od="irn",Tx="error",Rd="wss://relay.walletconnect.com",Lf="wss://relay.walletconnect.org",Nx="relayer",ht={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Dx="_subscription",Mr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Lx=X.ONE_SECOND,Bx="2.11.0",qx=1e4,jx="0.3",zx="WALLETCONNECT_CLIENT_ID",ur={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Mx="subscription",Ux="0.3",Hx=X.FIVE_SECONDS*1e3,kx="pairing",Vx="0.3",Yn={wc_pairingDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:X.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:X.ONE_DAY,prompt:!1,tag:0},res:{ttl:X.ONE_DAY,prompt:!1,tag:0}}},is={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},br={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Kx="history",Gx="0.3",Wx="expirer",Xt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Jx="0.3",Kc="verify-api",yn="https://verify.walletconnect.com",lu="https://verify.walletconnect.org",Qx=[yn,lu],Yx="echo",Zx="https://echo.walletconnect.com";class Xx{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=Ax,this.version=Fx,this.initialized=!1,this.storagePrefix=ci,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,o)=>{this.isInitialized(),this.keychain.set(s,o),await this.persist()},this.get=s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:c}=V("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(c)}return o},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=e,this.logger=Rt(r,this.name)}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,vp(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?mp(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class eS{constructor(e,r,s){this.core=e,this.logger=r,this.name=xx,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=bf(o);return ud(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=v0();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),h=bf(c),p=eu();return await P2(p,o,Sx,h)},this.generateSharedKey=(o,c,h)=>{this.isInitialized();const p=this.getPrivateKey(o),f=m0(p,c);return this.setSymKey(f,h)},this.setSymKey=async(o,c)=>{this.isInitialized();const h=c||w0(o);return await this.keychain.set(h,o),h},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,h)=>{this.isInitialized();const p=b0(h),f=Ri(c);if(Dl(p)){const S=p.senderPublicKey,O=p.receiverPublicKey;o=await this.generateSharedKey(S,O)}const y=this.getSymKey(o),{type:v,senderPublicKey:b}=p;return _0({type:v,symKey:y,message:f,senderPublicKey:b})},this.decode=async(o,c,h)=>{this.isInitialized();const p=E0(c,h);if(Dl(p)){const f=p.receiverPublicKey,y=p.senderPublicKey;o=await this.generateSharedKey(f,y)}try{const f=this.getSymKey(o),y=I0({symKey:f,encoded:c});return fs(y)}catch(f){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(f)}},this.getPayloadType=o=>{const c=Ll(o);return P0(c.type)},this.getPayloadSenderPublicKey=o=>{const c=Ll(o);return c.senderPublicKey?x0(c.senderPublicKey,S0):void 0},this.core=e,this.logger=Rt(r,this.name),this.keychain=s||new Xx(this.core,this.logger)}get context(){return Ot(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Df)}catch{e=eu(),await this.keychain.set(Df,e)}return _x(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class tS extends I_{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Ox,this.version=Rx,this.initialized=!1,this.storagePrefix=ci,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,o)=>{this.isInitialized();const c=vn(o);let h=this.messages.get(s);return typeof h>"u"&&(h={}),typeof h[c]<"u"||(h[c]=o,this.messages.set(s,h),await this.persist()),c},this.get=s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o},this.has=(s,o)=>{this.isInitialized();const c=this.get(s),h=vn(o);return typeof c[h]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Rt(e,this.name),this.core=r}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,vp(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?mp(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class rS extends P_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new Ft.EventEmitter,this.name=$x,this.queue=new Map,this.publishTimeout=X.toMiliseconds(X.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,o,c)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:c}});try{const p=(c==null?void 0:c.ttl)||Cx,f=tu(c),y=(c==null?void 0:c.prompt)||!1,v=(c==null?void 0:c.tag)||0,b=(c==null?void 0:c.id)||Ou().toString(),S={topic:s,message:o,opts:{ttl:p,relay:f,prompt:y,tag:v,id:b}},O=setTimeout(()=>this.queue.set(b,S),this.publishTimeout);try{await await os(this.rpcPublish(s,o,p,f,y,v,b),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(b),this.relayer.events.emit(ht.publish,S)}catch(F){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=c==null?void 0:c.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(b),F;return}finally{clearTimeout(O)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.relayer=e,this.logger=Rt(r,this.name),this.registerEventListeners()}get context(){return Ot(this.logger)}rpcPublish(e,r,s,o,c,h,p){var f,y,v,b;const S={method:Lo(o.protocol).publish,params:{topic:e,message:r,ttl:s,prompt:c,tag:h},id:p};return ai((f=S.params)==null?void 0:f.prompt)&&((y=S.params)==null||delete y.prompt),ai((v=S.params)==null?void 0:v.tag)&&((b=S.params)==null||delete b.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:S}),this.relayer.request(S)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:s,opts:o}=e;await this.publish(r,s,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ht.connection_stalled);return}this.checkQueue()}),this.relayer.on(ht.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class iS{constructor(){this.map=new Map,this.set=(e,r)=>{const s=this.get(e);this.exists(e,r)||this.map.set(e,[...s,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,r))return;const o=s.filter(c=>c!==r);if(!o.length){this.map.delete(e);return}this.map.set(e,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var nS=Object.defineProperty,sS=Object.defineProperties,oS=Object.getOwnPropertyDescriptors,Bf=Object.getOwnPropertySymbols,aS=Object.prototype.hasOwnProperty,cS=Object.prototype.propertyIsEnumerable,qf=(n,e,r)=>e in n?nS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Zn=(n,e)=>{for(var r in e||(e={}))aS.call(e,r)&&qf(n,r,e[r]);if(Bf)for(var r of Bf(e))cS.call(e,r)&&qf(n,r,e[r]);return n},Gc=(n,e)=>sS(n,oS(e));class uS extends A_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new iS,this.events=new Ft.EventEmitter,this.name=Mx,this.version=Ux,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ci,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const c=tu(o),h={topic:s,relay:c};this.pending.set(s,h);const p=await this.rpcSubscribe(s,c);return this.onSubscribe(p,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}}),p}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(s,o.id,o):await this.unsubscribeByTopic(s,o)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((o,c)=>{const h=new X.Watch;h.start(this.pendingSubscriptionWatchLabel);const p=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),o(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=Hx&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Rt(r,this.name),this.clientId=""}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let s=!1;try{s=this.getSubscription(e).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const s=this.topicMap.get(e);await Promise.all(s.map(async o=>await this.unsubscribeById(e,o,r)))}async unsubscribeById(e,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}});try{const o=tu(s);await this.rpcUnsubscribe(e,r,o);const c=ut("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(e,r){const s={method:Lo(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await os(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ht.connection_stalled)}return vn(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,s={method:Lo(r.protocol).batchSubscribe,params:{topics:e.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await os(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ht.connection_stalled)}}rpcUnsubscribe(e,r,s){const o={method:Lo(s.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(e,r){this.setSubscription(e,Gc(Zn({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Zn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,Zn({},r)),this.topicMap.set(r.topic,e),this.events.emit(ur.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(ur.deleted,Gc(Zn({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ur.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(ur.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);wn(r)&&this.onBatchSubscribe(r.map((s,o)=>Gc(Zn({},e[o]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ht.connect,async()=>{await this.onConnect()}),this.relayer.on(ht.disconnect,()=>{this.onDisconnect()}),this.events.on(ur.created,async e=>{const r=ur.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(ur.deleted,async e=>{const r=ur.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var hS=Object.defineProperty,jf=Object.getOwnPropertySymbols,lS=Object.prototype.hasOwnProperty,fS=Object.prototype.propertyIsEnumerable,zf=(n,e,r)=>e in n?hS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,pS=(n,e)=>{for(var r in e||(e={}))lS.call(e,r)&&zf(n,r,e[r]);if(jf)for(var r of jf(e))fS.call(e,r)&&zf(n,r,e[r]);return n};class dS extends x_{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Ft.EventEmitter,this.name=Nx,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(ht.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(ht.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Mr.payload,this.onPayloadHandler),this.provider.on(Mr.connect,this.onConnectHandler),this.provider.on(Mr.disconnect,this.onDisconnectHandler),this.provider.on(Mr.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Rt(e.logger,this.name):Wo(Go({level:e.logger||Tx})),this.messages=new tS(this.logger,e.core),this.subscriber=new uS(this,this.logger),this.publisher=new rS(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Rd,this.projectId=e.projectId,this.bundleId=A0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Lf}...`),await this.restartTransport(Lf)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},qx)}get context(){return Ot(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,s){this.isInitialized(),await this.publisher.publish(e,r,s),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var s;this.isInitialized();let o=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"";if(o)return o;let c;const h=p=>{p.topic===e&&(this.subscriber.off(ur.created,h),c())};return await Promise.all([new Promise(p=>{c=p,this.subscriber.on(ur.created,h)}),new Promise(async p=>{o=await this.subscriber.subscribe(e,r),p()})]),o}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await os(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(ur.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await os(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){s(o);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(Mr.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Bl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new M2(new V2(F0({sdkVersion:Bx,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:s}=e;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(e){const{topic:r,message:s}=e;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,s);return o&&this.logger.debug(`Ignoring duplicate message: ${s}`),o}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ru(e)){if(!e.method.endsWith(Dx))return;const r=e.params,{topic:s,message:o,publishedAt:c}=r.data,h={topic:s,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(pS({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(e),await this.onMessageEvent(h)}else gs(e)&&this.events.emit(ht.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(ht.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Qo(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Mr.payload,this.onPayloadHandler),this.provider.off(Mr.connect,this.onConnectHandler),this.provider.off(Mr.disconnect,this.onDisconnectHandler),this.provider.off(Mr.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(ht.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await Bl();O0(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(ht.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},X.toMiliseconds(Lx)))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var gS=Object.defineProperty,Mf=Object.getOwnPropertySymbols,yS=Object.prototype.hasOwnProperty,vS=Object.prototype.propertyIsEnumerable,Uf=(n,e,r)=>e in n?gS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Hf=(n,e)=>{for(var r in e||(e={}))yS.call(e,r)&&Uf(n,r,e[r]);if(Mf)for(var r of Mf(e))vS.call(e,r)&&Uf(n,r,e[r]);return n};class Xo extends S_{constructor(e,r,s,o=ci,c=void 0){super(e,r,s,o),this.core=e,this.logger=r,this.name=s,this.map=new Map,this.version=jx,this.cached=[],this.initialized=!1,this.storagePrefix=ci,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!ai(h)?this.map.set(this.getKey(h),h):g0(h)?this.map.set(h.id,h):y0(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,p)=>{this.isInitialized(),this.map.has(h)?await this.update(h,p):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:p}),this.map.set(h,p),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(p=>Object.keys(h).every(f=>G2(p[f],h[f]))):this.values),this.update=async(h,p)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:p});const f=Hf(Hf({},this.getData(h)),p);this.map.set(h,f),await this.persist()},this.delete=async(h,p)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:p}),this.map.delete(h),await this.persist())},this.logger=Rt(r,this.name),this.storagePrefix=o,this.getKey=c}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class mS{constructor(e,r){this.core=e,this.logger=r,this.name=kx,this.version=Vx,this.events=new vu,this.initialized=!1,this.storagePrefix=ci,this.ignoredPayloadTypes=[dp],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=eu(),o=await this.core.crypto.setSymKey(s),c=hr(X.FIVE_MINUTES),h={protocol:Od},p={topic:o,expiry:c,relay:h,active:!1},f=R0({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:h});return await this.pairings.set(o,p),await this.core.relayer.subscribe(o),this.core.expirer.set(o,c),{topic:o,uri:f}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:o,symKey:c,relay:h}=ql(s.uri);let p;if(this.pairings.keys.includes(o)&&(p=this.pairings.get(o),p.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const f=hr(X.FIVE_MINUTES),y={topic:o,relay:h,expiry:f,active:!1};return await this.pairings.set(o,y),this.core.expirer.set(o,f),s.activatePairing&&await this.activate({topic:o}),this.events.emit(is.create,y),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:h})),y},this.activate=async({topic:s})=>{this.isInitialized();const o=hr(X.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:o}),this.core.expirer.set(s,o)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:o}=s;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:h,resolve:p,reject:f}=dn();this.events.once(Ge("pairing_ping",c),({error:y})=>{y?f(y):p()}),await h()}},this.updateExpiry=async({topic:s,expiry:o})=>{this.isInitialized(),await this.pairings.update(s,{expiry:o})},this.updateMetadata=async({topic:s,metadata:o})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",ut("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(s,o,c)=>{const h=Oi(o,c),p=await this.core.crypto.encode(s,h),f=Yn[o].req;return this.core.history.set(s,h),this.core.relayer.publish(s,p,f),h.id},this.sendResult=async(s,o,c)=>{const h=Qo(s,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,s),y=Yn[f.request.method].res;await this.core.relayer.publish(o,p,y),await this.core.history.resolve(h)},this.sendError=async(s,o,c)=>{const h=Yo(s,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,s),y=Yn[f.request.method]?Yn[f.request.method].res:Yn.unregistered_method.res;await this.core.relayer.publish(o,p,y),await this.core.history.resolve(h)},this.deletePairing=async(s,o)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,ut("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),o?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(o=>oi(o.expiry));await Promise.all(s.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=s=>{const{topic:o,payload:c}=s;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:c}=s,h=(await this.core.history.get(o,c.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(s,o)=>{const{id:c}=o;try{this.isValidPing({topic:s}),await this.sendResult(c,s,!0),this.events.emit(is.ping,{id:c,topic:s})}catch(h){await this.sendError(c,s,h),this.logger.error(h)}},this.onPairingPingResponse=(s,o)=>{const{id:c}=o;setTimeout(()=>{Hr(o)?this.events.emit(Ge("pairing_ping",c),{}):er(o)&&this.events.emit(Ge("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(s,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(is.delete,{id:c,topic:s})}catch(h){await this.sendError(c,s,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(s,o)=>{const{id:c,method:h}=o;try{if(this.registeredMethods.includes(h))return;const p=ut("WC_METHOD_UNSUPPORTED",h);await this.sendError(c,s,p),this.logger.error(p)}catch(p){await this.sendError(c,s,p),this.logger.error(p)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(ut("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var o;if(!St(s)){const{message:h}=V("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(h)}if(!C0(s.uri)){const{message:h}=V("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(h)}const c=ql(s.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:h}=V("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(c!=null&&c.symKey)){const{message:h}=V("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async s=>{if(!St(s)){const{message:c}=V("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(c)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidDisconnect=async s=>{if(!St(s)){const{message:c}=V("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(c)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async s=>{if(!gn(s,!1)){const{message:o}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!this.pairings.keys.includes(s)){const{message:o}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(oi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:o}=V("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}},this.core=e,this.logger=Rt(r,this.name),this.pairings=new Xo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ot(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ht.message,async e=>{const{topic:r,message:s}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const o=await this.core.crypto.decode(r,s);try{Ru(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):gs(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Xt.expired,async e=>{const{topic:r}=gp(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(is.expire,{topic:r}))})}}class wS extends E_{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new Ft.EventEmitter,this.name=Kx,this.version=Gx,this.cached=[],this.initialized=!1,this.storagePrefix=ci,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:c}),this.records.has(o.id))return;const h={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:c,expiry:hr(X.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(br.created,h)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const o=await this.getRecord(s.id);typeof o.response>"u"&&(o.response=er(s)?{error:s.error}:{result:s.result},this.records.set(o.id,o),this.events.emit(br.updated,o))},this.get=async(s,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:o}),await this.getRecord(o)),this.delete=(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===s){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(br.deleted,c)}})},this.exists=async(s,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===s:!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Rt(r,this.name)}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Oi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(br.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(br.created,e=>{const r=br.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(br.updated,e=>{const r=br.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(br.deleted,e=>{const r=br.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{X.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class bS extends F_{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new Ft.EventEmitter,this.name=Wx,this.version=Jx,this.cached=[],this.initialized=!1,this.storagePrefix=ci,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(s,o)=>{this.isInitialized();const c=this.formatTarget(s),h={target:c,expiry:o};this.expirations.set(c,h),this.checkExpiry(c,h),this.events.emit(Xt.created,{target:c,expiration:h})},this.get=s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)},this.del=s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Xt.deleted,{target:o,expiration:c})}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Rt(r,this.name)}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return $0(e);if(typeof e=="number")return T0(e);const{message:r}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Xt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(e,r){const{expiry:s}=r;X.toMiliseconds(s)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Xt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(bn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Xt.created,e=>{const r=Xt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Xt.expired,e=>{const r=Xt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Xt.deleted,e=>{const r=Xt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class _S extends O_{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=Kc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||N0()||!yp())return;const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=lu;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let c;try{c=await this.fetchAttestation(s.attestationId,o)}catch(h){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${o}`),this.logger.info(h),c=await this.fetchAttestation(s.attestationId,lu)}return c},this.fetchAttestation=async(s,o)=>{this.logger.info(`resolving attestation: ${s} from url: ${o}`);const c=this.startAbortTimer(X.ONE_SECOND*2),h=await fetch(`${o}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(c),h.status===200?await h.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const o=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),s())};await Promise.race([new Promise(c=>{if(document.getElementById(Kc))return c();window.addEventListener("message",o);const h=document.createElement("iframe");h.id=Kc,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,s=c}),new Promise((c,h)=>setTimeout(()=>{window.removeEventListener("message",o),h("verify iframe load timeout")},X.toMiliseconds(X.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let o=s||yn;return Qx.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${yn}`),o=yn),o},this.logger=Rt(r,this.name),this.verifyUrl=yn,this.abortController=new AbortController,this.isDevEnv=D0()&&{}.IS_VITEST}get context(){return Ot(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),X.toMiliseconds(e))}}class ES extends R_{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=Yx,this.registerDeviceToken=async s=>{const{clientId:o,token:c,notificationType:h,enableEncrypted:p=!1}=s,f=`${Zx}/${this.projectId}/clients`;await Y2(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:h,token:c,always_raw:p})})},this.logger=Rt(r,this.context)}}var IS=Object.defineProperty,kf=Object.getOwnPropertySymbols,PS=Object.prototype.hasOwnProperty,xS=Object.prototype.propertyIsEnumerable,Vf=(n,e,r)=>e in n?IS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Kf=(n,e)=>{for(var r in e||(e={}))PS.call(e,r)&&Vf(n,r,e[r]);if(kf)for(var r of kf(e))xS.call(e,r)&&Vf(n,r,e[r]);return n};class $u extends __{constructor(e){super(e),this.protocol=Fd,this.version=Ex,this.name=Cu,this.events=new Ft.EventEmitter,this.initialized=!1,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Rd,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Wo(Go({level:(e==null?void 0:e.logger)||Ix.logger}));this.logger=Rt(r,this.name),this.heartbeat=new bn.HeartBeat,this.crypto=new eS(this,this.logger,e==null?void 0:e.keychain),this.history=new wS(this,this.logger),this.expirer=new bS(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new kb(Kf(Kf({},Px),e==null?void 0:e.storageOptions)),this.relayer=new dS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new mS(this,this.logger),this.verify=new _S(this.projectId||"",this.logger),this.echoClient=new ES(this.projectId||"",this.logger)}static async init(e){const r=new $u(e);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(zx,s),r}get context(){return Ot(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const SS=$u,Cd="wc",$d=2,Td="client",Tu=`${Cd}@${$d}:${Td}:`,Wc={name:Td,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Gf="WALLETCONNECT_DEEPLINK_CHOICE",AS="proposal",Nd="Proposal expired",FS="session",To=X.SEVEN_DAYS,OS="engine",Xn={wc_sessionPropose:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1104},res:{ttl:X.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1106},res:{ttl:X.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1112},res:{ttl:X.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1115}}},Jc={min:X.FIVE_MINUTES,max:X.SEVEN_DAYS},Ur={idle:"IDLE",active:"ACTIVE"},RS="request",CS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var $S=Object.defineProperty,TS=Object.defineProperties,NS=Object.getOwnPropertyDescriptors,Wf=Object.getOwnPropertySymbols,DS=Object.prototype.hasOwnProperty,LS=Object.prototype.propertyIsEnumerable,Jf=(n,e,r)=>e in n?$S(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Pt=(n,e)=>{for(var r in e||(e={}))DS.call(e,r)&&Jf(n,r,e[r]);if(Wf)for(var r of Wf(e))LS.call(e,r)&&Jf(n,r,e[r]);return n},es=(n,e)=>TS(n,NS(e));class BS extends $_{constructor(e){super(e),this.name=OS,this.events=new vu,this.initialized=!1,this.ignoredPayloadTypes=[dp],this.requestQueue={state:Ur.idle,queue:[]},this.sessionRequestQueue={state:Ur.idle,queue:[]},this.requestQueueDelay=X.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Xn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=es(Pt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:h,sessionProperties:p,relays:f}=s;let y=o,v,b=!1;if(y&&(b=this.client.core.pairing.pairings.get(y).active),!y||!b){const{topic:L,uri:M}=await this.client.core.pairing.create();y=L,v=M}const S=await this.client.core.crypto.generateKeyPair(),O=Pt({requiredNamespaces:c,optionalNamespaces:h,relays:f??[{protocol:Od}],proposer:{publicKey:S,metadata:this.client.metadata}},p&&{sessionProperties:p}),{reject:F,resolve:N,done:G}=dn(X.FIVE_MINUTES,Nd);if(this.events.once(Ge("session_connect"),async({error:L,session:M})=>{if(L)F(L);else if(M){M.self.publicKey=S;const Y=es(Pt({},M),{requiredNamespaces:M.requiredNamespaces,optionalNamespaces:M.optionalNamespaces});await this.client.session.set(M.topic,Y),await this.setExpiry(M.topic,M.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:M.peer.metadata}),N(Y)}}),!y){const{message:L}=V("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(L)}const H=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:O}),Z=hr(X.FIVE_MINUTES);return await this.setProposal(H,Pt({id:H,expiry:Z},O)),{uri:v,approval:G}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:o,namespaces:c,sessionProperties:h}=r,p=this.client.proposal.get(s);let{pairingTopic:f,proposer:y,requiredNamespaces:v,optionalNamespaces:b}=p;f=f||"",Bo(v)||(v=B0(c,"approve()"));const S=await this.client.core.crypto.generateKeyPair(),O=y.publicKey,F=await this.client.core.crypto.generateSharedKey(S,O);f&&s&&(await this.client.core.pairing.updateMetadata({topic:f,metadata:y.metadata}),await this.sendResult({id:s,topic:f,result:{relay:{protocol:o??"irn"},responderPublicKey:S}}),await this.client.proposal.delete(s,ut("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:f}));const N=Pt({relay:{protocol:o??"irn"},namespaces:c,requiredNamespaces:v,optionalNamespaces:b,pairingTopic:f,controller:{publicKey:S,metadata:this.client.metadata},expiry:hr(To)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(F),await this.sendRequest({topic:F,method:"wc_sessionSettle",params:N,throwOnFailedPublish:!0});const G=es(Pt({},N),{topic:F,pairingTopic:f,acknowledged:!1,self:N.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:S});return await this.client.session.set(F,G),await this.setExpiry(F,hr(To)),{topic:F,acknowledged:()=>new Promise(H=>setTimeout(()=>H(this.client.session.get(F)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:o}=r,{pairingTopic:c}=this.client.proposal.get(s);c&&(await this.sendError(s,c,o),await this.client.proposal.delete(s,ut("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:o}=r,c=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:h,resolve:p,reject:f}=dn();return this.events.once(Ge("session_update",c),({error:y})=>{y?f(y):p()}),await this.client.session.update(s,{namespaces:o}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,o=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:c,resolve:h,reject:p}=dn();return this.events.once(Ge("session_extend",o),({error:f})=>{f?p(f):h()}),await this.setExpiry(s,hr(To)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:o,topic:c,expiry:h}=r,p=Fu(),{done:f,resolve:y,reject:v}=dn(h,"Request expired. Please try again.");return this.events.once(Ge("session_request",p),({error:b,result:S})=>{b?v(b):y(S)}),await Promise.all([new Promise(async b=>{await this.sendRequest({clientRpcId:p,topic:c,method:"wc_sessionRequest",params:{request:o,chainId:s},expiry:h,throwOnFailedPublish:!0}).catch(S=>v(S)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:s,id:p}),b()}),new Promise(async b=>{const S=await q0(this.client.core.storage,Gf);j0({id:p,topic:c,wcDeepLink:S}),b()}),f()]).then(b=>b[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:o}=r,{id:c}=o;Hr(o)?await this.sendResult({id:c,topic:s,result:o.result,throwOnFailedPublish:!0}):er(o)&&await this.sendError(c,s,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const o=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:c,resolve:h,reject:p}=dn();this.events.once(Ge("session_ping",o),({error:f})=>{f?p(f):h()}),await c()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:o,chainId:c}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:o,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:ut("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>z0(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var h,p;return((h=c.peerMetadata)==null?void 0:h.url)&&((p=c.peerMetadata)==null?void 0:p.url)===r.peer.metadata.url&&c.topic&&c.topic!==s.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,ut("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Gf).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===r&&this.deletePendingSessionRequest(c.id,ut("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,ut("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),o&&(this.sessionRequestQueue.state=Ur.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Xn.wc_sessionRequest.req.ttl,{id:o,topic:c,params:h,verifyContext:p}=r;await this.client.pendingRequest.set(o,{id:o,topic:c,params:h,verifyContext:p}),s&&this.client.core.expirer.set(o,hr(s))},this.sendRequest=async r=>{const{topic:s,method:o,params:c,expiry:h,relayRpcId:p,clientRpcId:f,throwOnFailedPublish:y}=r,v=Oi(o,c,f);if(yp()&&CS.includes(o)){const O=vn(JSON.stringify(v));this.client.core.verify.register({attestationId:O})}const b=await this.client.core.crypto.encode(s,v),S=Xn[o].req;return h&&(S.ttl=h),p&&(S.id=p),this.client.core.history.set(s,v),y?(S.internal=es(Pt({},S.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,b,S)):this.client.core.relayer.publish(s,b,S).catch(O=>this.client.logger.error(O)),v.id},this.sendResult=async r=>{const{id:s,topic:o,result:c,throwOnFailedPublish:h}=r,p=Qo(s,c),f=await this.client.core.crypto.encode(o,p),y=await this.client.core.history.get(o,s),v=Xn[y.request.method].res;h?(v.internal=es(Pt({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,f,v)):this.client.core.relayer.publish(o,f,v).catch(b=>this.client.logger.error(b)),await this.client.core.history.resolve(p)},this.sendError=async(r,s,o)=>{const c=Yo(r,o),h=await this.client.core.crypto.encode(s,c),p=await this.client.core.history.get(s,r),f=Xn[p.request.method].res;this.client.core.relayer.publish(s,h,f),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(o=>{oi(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{oi(o.expiry)&&s.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...s.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Ur.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ur.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=Ur.idle},this.processRequest=r=>{const{topic:s,payload:o}=r,c=o.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(s,o);case"wc_sessionSettle":return this.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return this.onSessionExtendRequest(s,o);case"wc_sessionPing":return this.onSessionPingRequest(s,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return this.onSessionRequest(s,o);case"wc_sessionEvent":return this.onSessionEventRequest(s,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,c=(await this.client.core.history.get(s,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(s,o);case"wc_sessionSettle":return this.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return this.onSessionExtendResponse(s,o);case"wc_sessionPing":return this.onSessionPingResponse(s,o);case"wc_sessionRequest":return this.onSessionRequestResponse(s,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:o}=V("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,s)=>{const{params:o,id:c}=s;try{this.isValidConnect(Pt({},s.params));const h=hr(X.FIVE_MINUTES),p=Pt({id:c,pairingTopic:r,expiry:h},o);await this.setProposal(c,p);const f=vn(JSON.stringify(s)),y=await this.getVerifyContext(f,p.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:p,verifyContext:y})}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,s)=>{const{id:o}=s;if(Hr(s)){const{result:c}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const h=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const p=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:p});const f=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const y=await this.client.core.crypto.generateSharedKey(p,f);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const v=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:v}),await this.client.core.pairing.activate({topic:r})}else er(s)&&(await this.client.proposal.delete(o,ut("USER_DISCONNECTED")),this.events.emit(Ge("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:o,params:c}=s;try{this.isValidSessionSettleRequest(c);const{relay:h,controller:p,expiry:f,namespaces:y,requiredNamespaces:v,optionalNamespaces:b,sessionProperties:S,pairingTopic:O}=s.params,F=Pt({topic:r,relay:h,expiry:f,namespaces:y,acknowledged:!0,pairingTopic:O,requiredNamespaces:v,optionalNamespaces:b,controller:p.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:p.publicKey,metadata:p.metadata}},S&&{sessionProperties:S});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Ge("session_connect"),{session:F}),this.cleanupDuplicatePairings(F)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,s)=>{const{id:o}=s;Hr(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ge("session_approve",o),{})):er(s)&&(await this.client.session.delete(r,ut("USER_DISCONNECTED")),this.events.emit(Ge("session_approve",o),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:o,id:c}=s;try{const h=`${r}_session_update`,p=So.get(h);if(p&&this.isRequestOutOfSync(p,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(Pt({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:o}),So.set(h,c)}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:o}=s;Hr(s)?this.events.emit(Ge("session_update",o),{}):er(s)&&this.events.emit(Ge("session_update",o),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:o}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,hr(To)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,s)=>{const{id:o}=s;Hr(s)?this.events.emit(Ge("session_extend",o),{}):er(s)&&this.events.emit(Ge("session_extend",o),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{Hr(s)?this.events.emit(Ge("session_ping",o),{}):er(s)&&this.events.emit(Ge("session_ping",o),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(ht.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,s)=>{const{id:o,params:c}=s;try{this.isValidRequest(Pt({topic:r},c));const h=vn(JSON.stringify(Oi("wc_sessionRequest",c,o))),p=this.client.session.get(r),f=await this.getVerifyContext(h,p.peer.metadata),y={id:o,topic:r,params:c,verifyContext:f};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,s)=>{const{id:o}=s;Hr(s)?this.events.emit(Ge("session_request",o),{result:s.result}):er(s)&&this.events.emit(Ge("session_request",o),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:o,params:c}=s;try{const h=`${r}_session_event_${c.event.name}`,p=So.get(h);if(p&&this.isRequestOutOfSync(p,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(Pt({topic:r},c)),this.client.events.emit("session_event",{id:o,topic:r,params:c}),So.set(h,o)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ur.idle,this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Ur.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ur.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Oi("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!St(r)){const{message:f}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(f)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:h,relays:p}=r;if(ai(s)||await this.isValidPairingTopic(s),!M0(p,!0)){const{message:f}=V("MISSING_OR_INVALID",`connect() relays: ${p}`);throw new Error(f)}!ai(o)&&Bo(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!ai(c)&&Bo(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),ai(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,s)=>{const o=U0(r,"connect()",s);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!St(r))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:o,relayProtocol:c,sessionProperties:h}=r;await this.isValidProposalId(s);const p=this.client.proposal.get(s),f=Rc(o,"approve()");if(f)throw new Error(f.message);const y=jl(p.requiredNamespaces,o,"approve()");if(y)throw new Error(y.message);if(!gn(c,!0)){const{message:v}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(v)}ai(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!St(r)){const{message:c}=V("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:s,reason:o}=r;if(await this.isValidProposalId(s),!H0(o)){const{message:c}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!St(r)){const{message:y}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(y)}const{relay:s,controller:o,namespaces:c,expiry:h}=r;if(!k0(s)){const{message:y}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const p=V0(o,"onSessionSettleRequest()");if(p)throw new Error(p.message);const f=Rc(c,"onSessionSettleRequest()");if(f)throw new Error(f.message);if(oi(h)){const{message:y}=V("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async r=>{if(!St(r)){const{message:f}=V("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(f)}const{topic:s,namespaces:o}=r;await this.isValidSessionTopic(s);const c=this.client.session.get(s),h=Rc(o,"update()");if(h)throw new Error(h.message);const p=jl(c.requiredNamespaces,o,"update()");if(p)throw new Error(p.message)},this.isValidExtend=async r=>{if(!St(r)){const{message:o}=V("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!St(r)){const{message:f}=V("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(f)}const{topic:s,request:o,chainId:c,expiry:h}=r;await this.isValidSessionTopic(s);const{namespaces:p}=this.client.session.get(s);if(!zl(p,c)){const{message:f}=V("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(f)}if(!K0(o)){const{message:f}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(f)}if(!G0(p,c,o.method)){const{message:f}=V("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(f)}if(h&&!W0(h,Jc)){const{message:f}=V("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${Jc.min} and ${Jc.max}`);throw new Error(f)}},this.isValidRespond=async r=>{var s;if(!St(r)){const{message:h}=V("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:o,response:c}=r;try{await this.isValidSessionTopic(o)}catch(h){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),h}if(!J0(c)){const{message:h}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!St(r)){const{message:o}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!St(r)){const{message:p}=V("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(p)}const{topic:s,event:o,chainId:c}=r;await this.isValidSessionTopic(s);const{namespaces:h}=this.client.session.get(s);if(!zl(h,c)){const{message:p}=V("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(p)}if(!Q0(o)){const{message:p}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}if(!Y0(h,c,o.name)){const{message:p}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}},this.isValidDisconnect=async r=>{if(!St(r)){const{message:o}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const o={verified:{verifyUrl:s.verifyUrl||yn,validation:"UNKNOWN",origin:s.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(o=>{if(!gn(o,!1)){const{message:c}=V("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ht.message,async e=>{const{topic:r,message:s}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const o=await this.client.core.crypto.decode(r,s);try{Ru(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):gs(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Xt.expired,async e=>{const{topic:r,id:s}=gp(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,V("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(is.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!gn(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(oi(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!gn(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(oi(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=V("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(gn(e,!1)){const{message:r}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Z0(e)){const{message:r}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(oi(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=V("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class qS extends Xo{constructor(e,r){super(e,r,AS,Tu),this.core=e,this.logger=r}}class jS extends Xo{constructor(e,r){super(e,r,FS,Tu),this.core=e,this.logger=r}}class zS extends Xo{constructor(e,r){super(e,r,RS,Tu,s=>s.id),this.core=e,this.logger=r}}let MS=class Dd extends C_{constructor(e){super(e),this.protocol=Cd,this.version=$d,this.name=Wc.name,this.events=new Ft.EventEmitter,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(o){throw this.logger.error(o.message),o}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(o){throw this.logger.error(o.message),o}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(o){throw this.logger.error(o.message),o}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(o){throw this.logger.error(o.message),o}},this.update=async s=>{try{return await this.engine.update(s)}catch(o){throw this.logger.error(o.message),o}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(o){throw this.logger.error(o.message),o}},this.request=async s=>{try{return await this.engine.request(s)}catch(o){throw this.logger.error(o.message),o}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(o){throw this.logger.error(o.message),o}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(o){throw this.logger.error(o.message),o}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(o){throw this.logger.error(o.message),o}},this.find=s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(e==null?void 0:e.name)||Wc.name,this.metadata=(e==null?void 0:e.metadata)||L0();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Wo(Go({level:(e==null?void 0:e.logger)||Wc.logger}));this.core=(e==null?void 0:e.core)||new SS(e),this.logger=Rt(r,this.name),this.session=new jS(this.core,this.logger),this.proposal=new qS(this.core,this.logger),this.pendingRequest=new zS(this.core,this.logger),this.engine=new BS(this)}static async init(e){const r=new Dd(e);return await r.initialize(),r}get context(){return Ot(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var fu={exports:{}};(function(n,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof At<"u"&&At,s=function(){function c(){this.fetch=!1,this.DOMException=r.DOMException}return c.prototype=r,new c}();(function(c){(function(h){var p=typeof c<"u"&&c||typeof self<"u"&&self||typeof At<"u"&&At||{},f={searchParams:"URLSearchParams"in p,iterable:"Symbol"in p&&"iterator"in Symbol,blob:"FileReader"in p&&"Blob"in p&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in p,arrayBuffer:"ArrayBuffer"in p};function y(E){return E&&DataView.prototype.isPrototypeOf(E)}if(f.arrayBuffer)var v=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=ArrayBuffer.isView||function(E){return E&&v.indexOf(Object.prototype.toString.call(E))>-1};function S(E){if(typeof E!="string"&&(E=String(E)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(E)||E==="")throw new TypeError('Invalid character in header field name: "'+E+'"');return E.toLowerCase()}function O(E){return typeof E!="string"&&(E=String(E)),E}function F(E){var A={next:function(){var q=E.shift();return{done:q===void 0,value:q}}};return f.iterable&&(A[Symbol.iterator]=function(){return A}),A}function N(E){this.map={},E instanceof N?E.forEach(function(A,q){this.append(q,A)},this):Array.isArray(E)?E.forEach(function(A){if(A.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+A.length);this.append(A[0],A[1])},this):E&&Object.getOwnPropertyNames(E).forEach(function(A){this.append(A,E[A])},this)}N.prototype.append=function(E,A){E=S(E),A=O(A);var q=this.map[E];this.map[E]=q?q+", "+A:A},N.prototype.delete=function(E){delete this.map[S(E)]},N.prototype.get=function(E){return E=S(E),this.has(E)?this.map[E]:null},N.prototype.has=function(E){return this.map.hasOwnProperty(S(E))},N.prototype.set=function(E,A){this.map[S(E)]=O(A)},N.prototype.forEach=function(E,A){for(var q in this.map)this.map.hasOwnProperty(q)&&E.call(A,this.map[q],q,this)},N.prototype.keys=function(){var E=[];return this.forEach(function(A,q){E.push(q)}),F(E)},N.prototype.values=function(){var E=[];return this.forEach(function(A){E.push(A)}),F(E)},N.prototype.entries=function(){var E=[];return this.forEach(function(A,q){E.push([q,A])}),F(E)},f.iterable&&(N.prototype[Symbol.iterator]=N.prototype.entries);function G(E){if(!E._noBody){if(E.bodyUsed)return Promise.reject(new TypeError("Already read"));E.bodyUsed=!0}}function H(E){return new Promise(function(A,q){E.onload=function(){A(E.result)},E.onerror=function(){q(E.error)}})}function Z(E){var A=new FileReader,q=H(A);return A.readAsArrayBuffer(E),q}function L(E){var A=new FileReader,q=H(A),j=/charset=([A-Za-z0-9_-]+)/.exec(E.type),W=j?j[1]:"utf-8";return A.readAsText(E,W),q}function M(E){for(var A=new Uint8Array(E),q=new Array(A.length),j=0;j<A.length;j++)q[j]=String.fromCharCode(A[j]);return q.join("")}function Y(E){if(E.slice)return E.slice(0);var A=new Uint8Array(E.byteLength);return A.set(new Uint8Array(E)),A.buffer}function he(){return this.bodyUsed=!1,this._initBody=function(E){this.bodyUsed=this.bodyUsed,this._bodyInit=E,E?typeof E=="string"?this._bodyText=E:f.blob&&Blob.prototype.isPrototypeOf(E)?this._bodyBlob=E:f.formData&&FormData.prototype.isPrototypeOf(E)?this._bodyFormData=E:f.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)?this._bodyText=E.toString():f.arrayBuffer&&f.blob&&y(E)?(this._bodyArrayBuffer=Y(E.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):f.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(E)||b(E))?this._bodyArrayBuffer=Y(E):this._bodyText=E=Object.prototype.toString.call(E):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof E=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):f.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},f.blob&&(this.blob=function(){var E=G(this);if(E)return E;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var E=G(this);return E||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(f.blob)return this.blob().then(Z);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var E=G(this);if(E)return E;if(this._bodyBlob)return L(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(M(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},f.formData&&(this.formData=function(){return this.text().then(yt)}),this.json=function(){return this.text().then(JSON.parse)},this}var ie=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ue(E){var A=E.toUpperCase();return ie.indexOf(A)>-1?A:E}function de(E,A){if(!(this instanceof de))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');A=A||{};var q=A.body;if(E instanceof de){if(E.bodyUsed)throw new TypeError("Already read");this.url=E.url,this.credentials=E.credentials,A.headers||(this.headers=new N(E.headers)),this.method=E.method,this.mode=E.mode,this.signal=E.signal,!q&&E._bodyInit!=null&&(q=E._bodyInit,E.bodyUsed=!0)}else this.url=String(E);if(this.credentials=A.credentials||this.credentials||"same-origin",(A.headers||!this.headers)&&(this.headers=new N(A.headers)),this.method=ue(A.method||this.method||"GET"),this.mode=A.mode||this.mode||null,this.signal=A.signal||this.signal||function(){if("AbortController"in p){var U=new AbortController;return U.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&q)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(q),(this.method==="GET"||this.method==="HEAD")&&(A.cache==="no-store"||A.cache==="no-cache")){var j=/([?&])_=[^&]*/;if(j.test(this.url))this.url=this.url.replace(j,"$1_="+new Date().getTime());else{var W=/\?/;this.url+=(W.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}de.prototype.clone=function(){return new de(this,{body:this._bodyInit})};function yt(E){var A=new FormData;return E.trim().split("&").forEach(function(q){if(q){var j=q.split("="),W=j.shift().replace(/\+/g," "),U=j.join("=").replace(/\+/g," ");A.append(decodeURIComponent(W),decodeURIComponent(U))}}),A}function vt(E){var A=new N,q=E.replace(/\r?\n[\t ]+/g," ");return q.split("\r").map(function(j){return j.indexOf(`
`)===0?j.substr(1,j.length):j}).forEach(function(j){var W=j.split(":"),U=W.shift().trim();if(U){var ne=W.join(":").trim();try{A.append(U,ne)}catch(Ee){console.warn("Response "+Ee.message)}}}),A}he.call(de.prototype);function Ce(E,A){if(!(this instanceof Ce))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(A||(A={}),this.type="default",this.status=A.status===void 0?200:A.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=A.statusText===void 0?"":""+A.statusText,this.headers=new N(A.headers),this.url=A.url||"",this._initBody(E)}he.call(Ce.prototype),Ce.prototype.clone=function(){return new Ce(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new N(this.headers),url:this.url})},Ce.error=function(){var E=new Ce(null,{status:200,statusText:""});return E.ok=!1,E.status=0,E.type="error",E};var tr=[301,302,303,307,308];Ce.redirect=function(E,A){if(tr.indexOf(A)===-1)throw new RangeError("Invalid status code");return new Ce(null,{status:A,headers:{location:E}})},h.DOMException=p.DOMException;try{new h.DOMException}catch{h.DOMException=function(A,q){this.message=A,this.name=q;var j=Error(A);this.stack=j.stack},h.DOMException.prototype=Object.create(Error.prototype),h.DOMException.prototype.constructor=h.DOMException}function Mt(E,A){return new Promise(function(q,j){var W=new de(E,A);if(W.signal&&W.signal.aborted)return j(new h.DOMException("Aborted","AbortError"));var U=new XMLHttpRequest;function ne(){U.abort()}U.onload=function(){var se={statusText:U.statusText,headers:vt(U.getAllResponseHeaders()||"")};W.url.indexOf("file://")===0&&(U.status<200||U.status>599)?se.status=200:se.status=U.status,se.url="responseURL"in U?U.responseURL:se.headers.get("X-Request-URL");var Q="response"in U?U.response:U.responseText;setTimeout(function(){q(new Ce(Q,se))},0)},U.onerror=function(){setTimeout(function(){j(new TypeError("Network request failed"))},0)},U.ontimeout=function(){setTimeout(function(){j(new TypeError("Network request timed out"))},0)},U.onabort=function(){setTimeout(function(){j(new h.DOMException("Aborted","AbortError"))},0)};function Ee(se){try{return se===""&&p.location.href?p.location.href:se}catch{return se}}if(U.open(W.method,Ee(W.url),!0),W.credentials==="include"?U.withCredentials=!0:W.credentials==="omit"&&(U.withCredentials=!1),"responseType"in U&&(f.blob?U.responseType="blob":f.arrayBuffer&&(U.responseType="arraybuffer")),A&&typeof A.headers=="object"&&!(A.headers instanceof N||p.Headers&&A.headers instanceof p.Headers)){var be=[];Object.getOwnPropertyNames(A.headers).forEach(function(se){be.push(S(se)),U.setRequestHeader(se,O(A.headers[se]))}),W.headers.forEach(function(se,Q){be.indexOf(Q)===-1&&U.setRequestHeader(Q,se)})}else W.headers.forEach(function(se,Q){U.setRequestHeader(Q,se)});W.signal&&(W.signal.addEventListener("abort",ne),U.onreadystatechange=function(){U.readyState===4&&W.signal.removeEventListener("abort",ne)}),U.send(typeof W._bodyInit>"u"?null:W._bodyInit)})}return Mt.polyfill=!0,p.fetch||(p.fetch=Mt,p.Headers=N,p.Request=de,p.Response=Ce),h.Headers=N,h.Request=de,h.Response=Ce,h.fetch=Mt,Object.defineProperty(h,"__esModule",{value:!0}),h})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var o=r.fetch?r:s;e=o.fetch,e.default=o.fetch,e.fetch=o.fetch,e.Headers=o.Headers,e.Request=o.Request,e.Response=o.Response,n.exports=e})(fu,fu.exports);var US=fu.exports;const Qf=us(US);var HS=Object.defineProperty,kS=Object.defineProperties,VS=Object.getOwnPropertyDescriptors,Yf=Object.getOwnPropertySymbols,KS=Object.prototype.hasOwnProperty,GS=Object.prototype.propertyIsEnumerable,Zf=(n,e,r)=>e in n?HS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Xf=(n,e)=>{for(var r in e||(e={}))KS.call(e,r)&&Zf(n,r,e[r]);if(Yf)for(var r of Yf(e))GS.call(e,r)&&Zf(n,r,e[r]);return n},ep=(n,e)=>kS(n,VS(e));const WS={Accept:"application/json","Content-Type":"application/json"},JS="POST",tp={headers:WS,method:JS},rp=10;let hi=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new Ft.EventEmitter,this.isAvailable=!1,this.registering=!1,!Pf(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Ri(e),s=await(await Qf(this.url,ep(Xf({},tp),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!Pf(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));s()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Ri({id:1,jsonrpc:"2.0",method:"test",params:[]});await Qf(e,ep(Xf({},tp),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?fs(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const s=this.parseError(r),o=s.message||s.toString(),c=Yo(e,o);this.events.emit("payload",c)}parseError(e,r=this.url){return fd(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>rp&&this.events.setMaxListeners(rp)}};class li extends dd{constructor(e){super(e),this.events=new Ft.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Oi(e.method,e.params||[],e.id||Ou().toString()),r)}async requestStrict(e,r){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${e.id}`,c=>{er(c)?o(c.error):s(c.result)});try{await this.connection.send(e,r)}catch(c){o(c)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),gs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const ip="error",QS="wss://relay.walletconnect.com",YS="wc",ZS="universal_provider",np=`${YS}@2:${ZS}:`,XS="https://rpc.walletconnect.com/v1/",kr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var ts=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pu={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,e){(function(){var r,s="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",p="Invalid `variable` option passed into `_.template`",f="__lodash_hash_undefined__",y=500,v="__lodash_placeholder__",b=1,S=2,O=4,F=1,N=2,G=1,H=2,Z=4,L=8,M=16,Y=32,he=64,ie=128,ue=256,de=512,yt=30,vt="...",Ce=800,tr=16,Mt=1,E=2,A=3,q=1/0,j=9007199254740991,W=17976931348623157e292,U=0/0,ne=4294967295,Ee=ne-1,be=ne>>>1,se=[["ary",ie],["bind",G],["bindKey",H],["curry",L],["curryRight",M],["flip",de],["partial",Y],["partialRight",he],["rearg",ue]],Q="[object Arguments]",qe="[object Array]",Ct="[object AsyncFunction]",$e="[object Boolean]",ze="[object Date]",$t="[object DOMException]",lt="[object Error]",Tt="[object Function]",Vr="[object GeneratorFunction]",tt="[object Map]",Er="[object Number]",_n="[object Null]",Nt="[object Object]",Ni="[object Promise]",Di="[object Proxy]",lr="[object RegExp]",rt="[object Set]",fr="[object String]",Ir="[object Symbol]",Li="[object Undefined]",pr="[object WeakMap]",Bi="[object WeakSet]",Ut="[object ArrayBuffer]",Ht="[object DataView]",Kr="[object Float32Array]",ot="[object Float64Array]",qi="[object Int8Array]",ji="[object Int16Array]",En="[object Int32Array]",zi="[object Uint8Array]",Gr="[object Uint8ClampedArray]",Mi="[object Uint16Array]",Ui="[object Uint32Array]",ea=/\b__p \+= '';/g,Pr=/\b(__p \+=) '' \+/g,vs=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ms=/&(?:amp|lt|gt|quot|#39);/g,ws=/[&<>"']/g,In=RegExp(ms.source),fi=RegExp(ws.source),Pn=/<%-([\s\S]+?)%>/g,xn=/<%([\s\S]+?)%>/g,Hi=/<%=([\s\S]+?)%>/g,pi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ta=/^\w*$/,ra=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Sn=/[\\^$.*+?()[\]{}|]/g,ia=RegExp(Sn.source),An=/^\s+/,bs=/\s/,Fn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,xr=/\{\n\/\* \[wrapped with (.+)\] \*/,na=/,? & /,sa=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,oa=/[()=,{}\[\]\/\s]/,aa=/\\(\\)?/g,ca=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,kt=/\w*$/,ua=/^[-+]0x[0-9a-f]+$/i,ha=/^0b[01]+$/i,la=/^\[object .+?Constructor\]$/,fa=/^0o[0-7]+$/i,pa=/^(?:0|[1-9]\d*)$/,Sr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ki=/($^)/,da=/['\n\r\u2028\u2029\\]/g,Vi="\\ud800-\\udfff",ga="\\u0300-\\u036f",ya="\\ufe20-\\ufe2f",Ki="\\u20d0-\\u20ff",_s=ga+ya+Ki,Es="\\u2700-\\u27bf",rr="a-z\\xdf-\\xf6\\xf8-\\xff",va="\\xac\\xb1\\xd7\\xf7",ma="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",wa="\\u2000-\\u206f",ba=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Is="A-Z\\xc0-\\xd6\\xd8-\\xde",Ps="\\ufe0e\\ufe0f",di=va+ma+wa+ba,On="[']",gi="["+Vi+"]",Rn="["+di+"]",yi="["+_s+"]",xs="\\d+",_a="["+Es+"]",Ss="["+rr+"]",As="[^"+Vi+di+xs+Es+rr+Is+"]",Gi="\\ud83c[\\udffb-\\udfff]",Ea="(?:"+yi+"|"+Gi+")",Fs="[^"+Vi+"]",Wi="(?:\\ud83c[\\udde6-\\uddff]){2}",Wr="[\\ud800-\\udbff][\\udc00-\\udfff]",Dt="["+Is+"]",Os="\\u200d",Rs="(?:"+Ss+"|"+As+")",dr="(?:"+Dt+"|"+As+")",Cs="(?:"+On+"(?:d|ll|m|re|s|t|ve))?",$s="(?:"+On+"(?:D|LL|M|RE|S|T|VE))?",Ts=Ea+"?",Ns="["+Ps+"]?",Ia="(?:"+Os+"(?:"+[Fs,Wi,Wr].join("|")+")"+Ns+Ts+")*",Ar="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ds="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ls=Ns+Ts+Ia,Ji="(?:"+[_a,Wi,Wr].join("|")+")"+Ls,Pa="(?:"+[Fs+yi+"?",yi,Wi,Wr,gi].join("|")+")",Cn=RegExp(On,"g"),xa=RegExp(yi,"g"),Qi=RegExp(Gi+"(?="+Gi+")|"+Pa+Ls,"g"),Bs=RegExp([Dt+"?"+Ss+"+"+Cs+"(?="+[Rn,Dt,"$"].join("|")+")",dr+"+"+$s+"(?="+[Rn,Dt+Rs,"$"].join("|")+")",Dt+"?"+Rs+"+"+Cs,Dt+"+"+$s,Ds,Ar,xs,Ji].join("|"),"g"),qs=RegExp("["+Os+Vi+_s+Ps+"]"),vi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,js=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Sa=-1,Ae={};Ae[Kr]=Ae[ot]=Ae[qi]=Ae[ji]=Ae[En]=Ae[zi]=Ae[Gr]=Ae[Mi]=Ae[Ui]=!0,Ae[Q]=Ae[qe]=Ae[Ut]=Ae[$e]=Ae[Ht]=Ae[ze]=Ae[lt]=Ae[Tt]=Ae[tt]=Ae[Er]=Ae[Nt]=Ae[lr]=Ae[rt]=Ae[fr]=Ae[pr]=!1;var xe={};xe[Q]=xe[qe]=xe[Ut]=xe[Ht]=xe[$e]=xe[ze]=xe[Kr]=xe[ot]=xe[qi]=xe[ji]=xe[En]=xe[tt]=xe[Er]=xe[Nt]=xe[lr]=xe[rt]=xe[fr]=xe[Ir]=xe[zi]=xe[Gr]=xe[Mi]=xe[Ui]=!0,xe[lt]=xe[Tt]=xe[pr]=!1;var m={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},D={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},k={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Fe=parseFloat,ae=parseInt,Te=typeof ts=="object"&&ts&&ts.Object===Object&&ts,Ve=typeof self=="object"&&self&&self.Object===Object&&self,me=Te||Ve||Function("return this")(),Oe=e&&!e.nodeType&&e,Me=Oe&&!0&&n&&!n.nodeType&&n,mt=Me&&Me.exports===Oe,Ke=mt&&Te.process,Ne=function(){try{var P=Me&&Me.require&&Me.require("util").types;return P||Ke&&Ke.binding&&Ke.binding("util")}catch{}}(),ft=Ne&&Ne.isArrayBuffer,ir=Ne&&Ne.isDate,Vt=Ne&&Ne.isMap,gr=Ne&&Ne.isRegExp,$n=Ne&&Ne.isSet,mi=Ne&&Ne.isTypedArray;function Ye(P,C,R){switch(R.length){case 0:return P.call(C);case 1:return P.call(C,R[0]);case 2:return P.call(C,R[0],R[1]);case 3:return P.call(C,R[0],R[1],R[2])}return P.apply(C,R)}function qd(P,C,R,K){for(var oe=-1,_e=P==null?0:P.length;++oe<_e;){var We=P[oe];C(K,We,R(We),P)}return K}function Kt(P,C){for(var R=-1,K=P==null?0:P.length;++R<K&&C(P[R],R,P)!==!1;);return P}function jd(P,C){for(var R=P==null?0:P.length;R--&&C(P[R],R,P)!==!1;);return P}function Lu(P,C){for(var R=-1,K=P==null?0:P.length;++R<K;)if(!C(P[R],R,P))return!1;return!0}function Jr(P,C){for(var R=-1,K=P==null?0:P.length,oe=0,_e=[];++R<K;){var We=P[R];C(We,R,P)&&(_e[oe++]=We)}return _e}function zs(P,C){var R=P==null?0:P.length;return!!R&&Yi(P,C,0)>-1}function Aa(P,C,R){for(var K=-1,oe=P==null?0:P.length;++K<oe;)if(R(C,P[K]))return!0;return!1}function De(P,C){for(var R=-1,K=P==null?0:P.length,oe=Array(K);++R<K;)oe[R]=C(P[R],R,P);return oe}function Qr(P,C){for(var R=-1,K=C.length,oe=P.length;++R<K;)P[oe+R]=C[R];return P}function Fa(P,C,R,K){var oe=-1,_e=P==null?0:P.length;for(K&&_e&&(R=P[++oe]);++oe<_e;)R=C(R,P[oe],oe,P);return R}function zd(P,C,R,K){var oe=P==null?0:P.length;for(K&&oe&&(R=P[--oe]);oe--;)R=C(R,P[oe],oe,P);return R}function Oa(P,C){for(var R=-1,K=P==null?0:P.length;++R<K;)if(C(P[R],R,P))return!0;return!1}var Md=Ra("length");function Ud(P){return P.split("")}function Hd(P){return P.match(sa)||[]}function Bu(P,C,R){var K;return R(P,function(oe,_e,We){if(C(oe,_e,We))return K=_e,!1}),K}function Ms(P,C,R,K){for(var oe=P.length,_e=R+(K?1:-1);K?_e--:++_e<oe;)if(C(P[_e],_e,P))return _e;return-1}function Yi(P,C,R){return C===C?tg(P,C,R):Ms(P,qu,R)}function kd(P,C,R,K){for(var oe=R-1,_e=P.length;++oe<_e;)if(K(P[oe],C))return oe;return-1}function qu(P){return P!==P}function ju(P,C){var R=P==null?0:P.length;return R?$a(P,C)/R:U}function Ra(P){return function(C){return C==null?r:C[P]}}function Ca(P){return function(C){return P==null?r:P[C]}}function zu(P,C,R,K,oe){return oe(P,function(_e,We,Re){R=K?(K=!1,_e):C(R,_e,We,Re)}),R}function Vd(P,C){var R=P.length;for(P.sort(C);R--;)P[R]=P[R].value;return P}function $a(P,C){for(var R,K=-1,oe=P.length;++K<oe;){var _e=C(P[K]);_e!==r&&(R=R===r?_e:R+_e)}return R}function Ta(P,C){for(var R=-1,K=Array(P);++R<P;)K[R]=C(R);return K}function Kd(P,C){return De(C,function(R){return[R,P[R]]})}function Mu(P){return P&&P.slice(0,Vu(P)+1).replace(An,"")}function Lt(P){return function(C){return P(C)}}function Na(P,C){return De(C,function(R){return P[R]})}function Tn(P,C){return P.has(C)}function Uu(P,C){for(var R=-1,K=P.length;++R<K&&Yi(C,P[R],0)>-1;);return R}function Hu(P,C){for(var R=P.length;R--&&Yi(C,P[R],0)>-1;);return R}function Gd(P,C){for(var R=P.length,K=0;R--;)P[R]===C&&++K;return K}var Wd=Ca(m),Jd=Ca(I);function Qd(P){return"\\"+k[P]}function Yd(P,C){return P==null?r:P[C]}function Zi(P){return qs.test(P)}function Zd(P){return vi.test(P)}function Xd(P){for(var C,R=[];!(C=P.next()).done;)R.push(C.value);return R}function Da(P){var C=-1,R=Array(P.size);return P.forEach(function(K,oe){R[++C]=[oe,K]}),R}function ku(P,C){return function(R){return P(C(R))}}function Yr(P,C){for(var R=-1,K=P.length,oe=0,_e=[];++R<K;){var We=P[R];(We===C||We===v)&&(P[R]=v,_e[oe++]=R)}return _e}function Us(P){var C=-1,R=Array(P.size);return P.forEach(function(K){R[++C]=K}),R}function eg(P){var C=-1,R=Array(P.size);return P.forEach(function(K){R[++C]=[K,K]}),R}function tg(P,C,R){for(var K=R-1,oe=P.length;++K<oe;)if(P[K]===C)return K;return-1}function rg(P,C,R){for(var K=R+1;K--;)if(P[K]===C)return K;return K}function Xi(P){return Zi(P)?ng(P):Md(P)}function nr(P){return Zi(P)?sg(P):Ud(P)}function Vu(P){for(var C=P.length;C--&&bs.test(P.charAt(C)););return C}var ig=Ca(D);function ng(P){for(var C=Qi.lastIndex=0;Qi.test(P);)++C;return C}function sg(P){return P.match(Qi)||[]}function og(P){return P.match(Bs)||[]}var ag=function P(C){C=C==null?me:en.defaults(me.Object(),C,en.pick(me,js));var R=C.Array,K=C.Date,oe=C.Error,_e=C.Function,We=C.Math,Re=C.Object,La=C.RegExp,cg=C.String,Gt=C.TypeError,Hs=R.prototype,ug=_e.prototype,tn=Re.prototype,ks=C["__core-js_shared__"],Vs=ug.toString,Pe=tn.hasOwnProperty,hg=0,Ku=function(){var t=/[^.]+$/.exec(ks&&ks.keys&&ks.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ks=tn.toString,lg=Vs.call(Re),fg=me._,pg=La("^"+Vs.call(Pe).replace(Sn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gs=mt?C.Buffer:r,Zr=C.Symbol,Ws=C.Uint8Array,Gu=Gs?Gs.allocUnsafe:r,Js=ku(Re.getPrototypeOf,Re),Wu=Re.create,Ju=tn.propertyIsEnumerable,Qs=Hs.splice,Qu=Zr?Zr.isConcatSpreadable:r,Nn=Zr?Zr.iterator:r,wi=Zr?Zr.toStringTag:r,Ys=function(){try{var t=Pi(Re,"defineProperty");return t({},"",{}),t}catch{}}(),dg=C.clearTimeout!==me.clearTimeout&&C.clearTimeout,gg=K&&K.now!==me.Date.now&&K.now,yg=C.setTimeout!==me.setTimeout&&C.setTimeout,Zs=We.ceil,Xs=We.floor,Ba=Re.getOwnPropertySymbols,vg=Gs?Gs.isBuffer:r,Yu=C.isFinite,mg=Hs.join,wg=ku(Re.keys,Re),Je=We.max,at=We.min,bg=K.now,_g=C.parseInt,Zu=We.random,Eg=Hs.reverse,qa=Pi(C,"DataView"),Dn=Pi(C,"Map"),ja=Pi(C,"Promise"),rn=Pi(C,"Set"),Ln=Pi(C,"WeakMap"),Bn=Pi(Re,"create"),eo=Ln&&new Ln,nn={},Ig=xi(qa),Pg=xi(Dn),xg=xi(ja),Sg=xi(rn),Ag=xi(Ln),to=Zr?Zr.prototype:r,qn=to?to.valueOf:r,Xu=to?to.toString:r;function d(t){if(je(t)&&!ce(t)&&!(t instanceof ve)){if(t instanceof Wt)return t;if(Pe.call(t,"__wrapped__"))return el(t)}return new Wt(t)}var sn=function(){function t(){}return function(i){if(!Be(i))return{};if(Wu)return Wu(i);t.prototype=i;var a=new t;return t.prototype=r,a}}();function ro(){}function Wt(t,i){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:Pn,evaluate:xn,interpolate:Hi,variable:"",imports:{_:d}},d.prototype=ro.prototype,d.prototype.constructor=d,Wt.prototype=sn(ro.prototype),Wt.prototype.constructor=Wt;function ve(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ne,this.__views__=[]}function Fg(){var t=new ve(this.__wrapped__);return t.__actions__=wt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=wt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=wt(this.__views__),t}function Og(){if(this.__filtered__){var t=new ve(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Rg(){var t=this.__wrapped__.value(),i=this.__dir__,a=ce(t),u=i<0,l=a?t.length:0,g=Uy(0,l,this.__views__),w=g.start,_=g.end,x=_-w,$=u?_:w-1,T=this.__iteratees__,B=T.length,z=0,J=at(x,this.__takeCount__);if(!a||!u&&l==x&&J==x)return Ih(t,this.__actions__);var te=[];e:for(;x--&&z<J;){$+=i;for(var fe=-1,re=t[$];++fe<B;){var ye=T[fe],we=ye.iteratee,jt=ye.type,gt=we(re);if(jt==E)re=gt;else if(!gt){if(jt==Mt)continue e;break e}}te[z++]=re}return te}ve.prototype=sn(ro.prototype),ve.prototype.constructor=ve;function bi(t){var i=-1,a=t==null?0:t.length;for(this.clear();++i<a;){var u=t[i];this.set(u[0],u[1])}}function Cg(){this.__data__=Bn?Bn(null):{},this.size=0}function $g(t){var i=this.has(t)&&delete this.__data__[t];return this.size-=i?1:0,i}function Tg(t){var i=this.__data__;if(Bn){var a=i[t];return a===f?r:a}return Pe.call(i,t)?i[t]:r}function Ng(t){var i=this.__data__;return Bn?i[t]!==r:Pe.call(i,t)}function Dg(t,i){var a=this.__data__;return this.size+=this.has(t)?0:1,a[t]=Bn&&i===r?f:i,this}bi.prototype.clear=Cg,bi.prototype.delete=$g,bi.prototype.get=Tg,bi.prototype.has=Ng,bi.prototype.set=Dg;function Fr(t){var i=-1,a=t==null?0:t.length;for(this.clear();++i<a;){var u=t[i];this.set(u[0],u[1])}}function Lg(){this.__data__=[],this.size=0}function Bg(t){var i=this.__data__,a=io(i,t);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Qs.call(i,a,1),--this.size,!0}function qg(t){var i=this.__data__,a=io(i,t);return a<0?r:i[a][1]}function jg(t){return io(this.__data__,t)>-1}function zg(t,i){var a=this.__data__,u=io(a,t);return u<0?(++this.size,a.push([t,i])):a[u][1]=i,this}Fr.prototype.clear=Lg,Fr.prototype.delete=Bg,Fr.prototype.get=qg,Fr.prototype.has=jg,Fr.prototype.set=zg;function Or(t){var i=-1,a=t==null?0:t.length;for(this.clear();++i<a;){var u=t[i];this.set(u[0],u[1])}}function Mg(){this.size=0,this.__data__={hash:new bi,map:new(Dn||Fr),string:new bi}}function Ug(t){var i=yo(this,t).delete(t);return this.size-=i?1:0,i}function Hg(t){return yo(this,t).get(t)}function kg(t){return yo(this,t).has(t)}function Vg(t,i){var a=yo(this,t),u=a.size;return a.set(t,i),this.size+=a.size==u?0:1,this}Or.prototype.clear=Mg,Or.prototype.delete=Ug,Or.prototype.get=Hg,Or.prototype.has=kg,Or.prototype.set=Vg;function _i(t){var i=-1,a=t==null?0:t.length;for(this.__data__=new Or;++i<a;)this.add(t[i])}function Kg(t){return this.__data__.set(t,f),this}function Gg(t){return this.__data__.has(t)}_i.prototype.add=_i.prototype.push=Kg,_i.prototype.has=Gg;function sr(t){var i=this.__data__=new Fr(t);this.size=i.size}function Wg(){this.__data__=new Fr,this.size=0}function Jg(t){var i=this.__data__,a=i.delete(t);return this.size=i.size,a}function Qg(t){return this.__data__.get(t)}function Yg(t){return this.__data__.has(t)}function Zg(t,i){var a=this.__data__;if(a instanceof Fr){var u=a.__data__;if(!Dn||u.length<o-1)return u.push([t,i]),this.size=++a.size,this;a=this.__data__=new Or(u)}return a.set(t,i),this.size=a.size,this}sr.prototype.clear=Wg,sr.prototype.delete=Jg,sr.prototype.get=Qg,sr.prototype.has=Yg,sr.prototype.set=Zg;function eh(t,i){var a=ce(t),u=!a&&Si(t),l=!a&&!u&&ii(t),g=!a&&!u&&!l&&un(t),w=a||u||l||g,_=w?Ta(t.length,cg):[],x=_.length;for(var $ in t)(i||Pe.call(t,$))&&!(w&&($=="length"||l&&($=="offset"||$=="parent")||g&&($=="buffer"||$=="byteLength"||$=="byteOffset")||Tr($,x)))&&_.push($);return _}function th(t){var i=t.length;return i?t[Qa(0,i-1)]:r}function Xg(t,i){return vo(wt(t),Ei(i,0,t.length))}function ey(t){return vo(wt(t))}function za(t,i,a){(a!==r&&!or(t[i],a)||a===r&&!(i in t))&&Rr(t,i,a)}function jn(t,i,a){var u=t[i];(!(Pe.call(t,i)&&or(u,a))||a===r&&!(i in t))&&Rr(t,i,a)}function io(t,i){for(var a=t.length;a--;)if(or(t[a][0],i))return a;return-1}function ty(t,i,a,u){return Xr(t,function(l,g,w){i(u,l,a(l),w)}),u}function rh(t,i){return t&&vr(i,Ze(i),t)}function ry(t,i){return t&&vr(i,_t(i),t)}function Rr(t,i,a){i=="__proto__"&&Ys?Ys(t,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):t[i]=a}function Ma(t,i){for(var a=-1,u=i.length,l=R(u),g=t==null;++a<u;)l[a]=g?r:_c(t,i[a]);return l}function Ei(t,i,a){return t===t&&(a!==r&&(t=t<=a?t:a),i!==r&&(t=t>=i?t:i)),t}function Jt(t,i,a,u,l,g){var w,_=i&b,x=i&S,$=i&O;if(a&&(w=l?a(t,u,l,g):a(t)),w!==r)return w;if(!Be(t))return t;var T=ce(t);if(T){if(w=ky(t),!_)return wt(t,w)}else{var B=ct(t),z=B==Tt||B==Vr;if(ii(t))return Sh(t,_);if(B==Nt||B==Q||z&&!l){if(w=x||z?{}:Vh(t),!_)return x?Ty(t,ry(w,t)):$y(t,rh(w,t))}else{if(!xe[B])return l?t:{};w=Vy(t,B,_)}}g||(g=new sr);var J=g.get(t);if(J)return J;g.set(t,w),bl(t)?t.forEach(function(re){w.add(Jt(re,i,a,re,t,g))}):ml(t)&&t.forEach(function(re,ye){w.set(ye,Jt(re,i,a,ye,t,g))});var te=$?x?ac:oc:x?_t:Ze,fe=T?r:te(t);return Kt(fe||t,function(re,ye){fe&&(ye=re,re=t[ye]),jn(w,ye,Jt(re,i,a,ye,t,g))}),w}function iy(t){var i=Ze(t);return function(a){return ih(a,t,i)}}function ih(t,i,a){var u=a.length;if(t==null)return!u;for(t=Re(t);u--;){var l=a[u],g=i[l],w=t[l];if(w===r&&!(l in t)||!g(w))return!1}return!0}function nh(t,i,a){if(typeof t!="function")throw new Gt(h);return Kn(function(){t.apply(r,a)},i)}function zn(t,i,a,u){var l=-1,g=zs,w=!0,_=t.length,x=[],$=i.length;if(!_)return x;a&&(i=De(i,Lt(a))),u?(g=Aa,w=!1):i.length>=o&&(g=Tn,w=!1,i=new _i(i));e:for(;++l<_;){var T=t[l],B=a==null?T:a(T);if(T=u||T!==0?T:0,w&&B===B){for(var z=$;z--;)if(i[z]===B)continue e;x.push(T)}else g(i,B,u)||x.push(T)}return x}var Xr=Ch(yr),sh=Ch(Ha,!0);function ny(t,i){var a=!0;return Xr(t,function(u,l,g){return a=!!i(u,l,g),a}),a}function no(t,i,a){for(var u=-1,l=t.length;++u<l;){var g=t[u],w=i(g);if(w!=null&&(_===r?w===w&&!qt(w):a(w,_)))var _=w,x=g}return x}function sy(t,i,a,u){var l=t.length;for(a=le(a),a<0&&(a=-a>l?0:l+a),u=u===r||u>l?l:le(u),u<0&&(u+=l),u=a>u?0:El(u);a<u;)t[a++]=i;return t}function oh(t,i){var a=[];return Xr(t,function(u,l,g){i(u,l,g)&&a.push(u)}),a}function it(t,i,a,u,l){var g=-1,w=t.length;for(a||(a=Gy),l||(l=[]);++g<w;){var _=t[g];i>0&&a(_)?i>1?it(_,i-1,a,u,l):Qr(l,_):u||(l[l.length]=_)}return l}var Ua=$h(),ah=$h(!0);function yr(t,i){return t&&Ua(t,i,Ze)}function Ha(t,i){return t&&ah(t,i,Ze)}function so(t,i){return Jr(i,function(a){return Nr(t[a])})}function Ii(t,i){i=ti(i,t);for(var a=0,u=i.length;t!=null&&a<u;)t=t[mr(i[a++])];return a&&a==u?t:r}function ch(t,i,a){var u=i(t);return ce(t)?u:Qr(u,a(t))}function pt(t){return t==null?t===r?Li:_n:wi&&wi in Re(t)?My(t):ev(t)}function ka(t,i){return t>i}function oy(t,i){return t!=null&&Pe.call(t,i)}function ay(t,i){return t!=null&&i in Re(t)}function cy(t,i,a){return t>=at(i,a)&&t<Je(i,a)}function Va(t,i,a){for(var u=a?Aa:zs,l=t[0].length,g=t.length,w=g,_=R(g),x=1/0,$=[];w--;){var T=t[w];w&&i&&(T=De(T,Lt(i))),x=at(T.length,x),_[w]=!a&&(i||l>=120&&T.length>=120)?new _i(w&&T):r}T=t[0];var B=-1,z=_[0];e:for(;++B<l&&$.length<x;){var J=T[B],te=i?i(J):J;if(J=a||J!==0?J:0,!(z?Tn(z,te):u($,te,a))){for(w=g;--w;){var fe=_[w];if(!(fe?Tn(fe,te):u(t[w],te,a)))continue e}z&&z.push(te),$.push(J)}}return $}function uy(t,i,a,u){return yr(t,function(l,g,w){i(u,a(l),g,w)}),u}function Mn(t,i,a){i=ti(i,t),t=Jh(t,i);var u=t==null?t:t[mr(Yt(i))];return u==null?r:Ye(u,t,a)}function uh(t){return je(t)&&pt(t)==Q}function hy(t){return je(t)&&pt(t)==Ut}function ly(t){return je(t)&&pt(t)==ze}function Un(t,i,a,u,l){return t===i?!0:t==null||i==null||!je(t)&&!je(i)?t!==t&&i!==i:fy(t,i,a,u,Un,l)}function fy(t,i,a,u,l,g){var w=ce(t),_=ce(i),x=w?qe:ct(t),$=_?qe:ct(i);x=x==Q?Nt:x,$=$==Q?Nt:$;var T=x==Nt,B=$==Nt,z=x==$;if(z&&ii(t)){if(!ii(i))return!1;w=!0,T=!1}if(z&&!T)return g||(g=new sr),w||un(t)?Uh(t,i,a,u,l,g):jy(t,i,x,a,u,l,g);if(!(a&F)){var J=T&&Pe.call(t,"__wrapped__"),te=B&&Pe.call(i,"__wrapped__");if(J||te){var fe=J?t.value():t,re=te?i.value():i;return g||(g=new sr),l(fe,re,a,u,g)}}return z?(g||(g=new sr),zy(t,i,a,u,l,g)):!1}function py(t){return je(t)&&ct(t)==tt}function Ka(t,i,a,u){var l=a.length,g=l,w=!u;if(t==null)return!g;for(t=Re(t);l--;){var _=a[l];if(w&&_[2]?_[1]!==t[_[0]]:!(_[0]in t))return!1}for(;++l<g;){_=a[l];var x=_[0],$=t[x],T=_[1];if(w&&_[2]){if($===r&&!(x in t))return!1}else{var B=new sr;if(u)var z=u($,T,x,t,i,B);if(!(z===r?Un(T,$,F|N,u,B):z))return!1}}return!0}function hh(t){if(!Be(t)||Jy(t))return!1;var i=Nr(t)?pg:la;return i.test(xi(t))}function dy(t){return je(t)&&pt(t)==lr}function gy(t){return je(t)&&ct(t)==rt}function yy(t){return je(t)&&Io(t.length)&&!!Ae[pt(t)]}function lh(t){return typeof t=="function"?t:t==null?Et:typeof t=="object"?ce(t)?dh(t[0],t[1]):ph(t):Tl(t)}function Ga(t){if(!Vn(t))return wg(t);var i=[];for(var a in Re(t))Pe.call(t,a)&&a!="constructor"&&i.push(a);return i}function vy(t){if(!Be(t))return Xy(t);var i=Vn(t),a=[];for(var u in t)u=="constructor"&&(i||!Pe.call(t,u))||a.push(u);return a}function Wa(t,i){return t<i}function fh(t,i){var a=-1,u=bt(t)?R(t.length):[];return Xr(t,function(l,g,w){u[++a]=i(l,g,w)}),u}function ph(t){var i=uc(t);return i.length==1&&i[0][2]?Gh(i[0][0],i[0][1]):function(a){return a===t||Ka(a,t,i)}}function dh(t,i){return lc(t)&&Kh(i)?Gh(mr(t),i):function(a){var u=_c(a,t);return u===r&&u===i?Ec(a,t):Un(i,u,F|N)}}function oo(t,i,a,u,l){t!==i&&Ua(i,function(g,w){if(l||(l=new sr),Be(g))my(t,i,w,a,oo,u,l);else{var _=u?u(pc(t,w),g,w+"",t,i,l):r;_===r&&(_=g),za(t,w,_)}},_t)}function my(t,i,a,u,l,g,w){var _=pc(t,a),x=pc(i,a),$=w.get(x);if($){za(t,a,$);return}var T=g?g(_,x,a+"",t,i,w):r,B=T===r;if(B){var z=ce(x),J=!z&&ii(x),te=!z&&!J&&un(x);T=x,z||J||te?ce(_)?T=_:Ue(_)?T=wt(_):J?(B=!1,T=Sh(x,!0)):te?(B=!1,T=Ah(x,!0)):T=[]:Gn(x)||Si(x)?(T=_,Si(_)?T=Il(_):(!Be(_)||Nr(_))&&(T=Vh(x))):B=!1}B&&(w.set(x,T),l(T,x,u,g,w),w.delete(x)),za(t,a,T)}function gh(t,i){var a=t.length;if(a)return i+=i<0?a:0,Tr(i,a)?t[i]:r}function yh(t,i,a){i.length?i=De(i,function(g){return ce(g)?function(w){return Ii(w,g.length===1?g[0]:g)}:g}):i=[Et];var u=-1;i=De(i,Lt(ee()));var l=fh(t,function(g,w,_){var x=De(i,function($){return $(g)});return{criteria:x,index:++u,value:g}});return Vd(l,function(g,w){return Cy(g,w,a)})}function wy(t,i){return vh(t,i,function(a,u){return Ec(t,u)})}function vh(t,i,a){for(var u=-1,l=i.length,g={};++u<l;){var w=i[u],_=Ii(t,w);a(_,w)&&Hn(g,ti(w,t),_)}return g}function by(t){return function(i){return Ii(i,t)}}function Ja(t,i,a,u){var l=u?kd:Yi,g=-1,w=i.length,_=t;for(t===i&&(i=wt(i)),a&&(_=De(t,Lt(a)));++g<w;)for(var x=0,$=i[g],T=a?a($):$;(x=l(_,T,x,u))>-1;)_!==t&&Qs.call(_,x,1),Qs.call(t,x,1);return t}function mh(t,i){for(var a=t?i.length:0,u=a-1;a--;){var l=i[a];if(a==u||l!==g){var g=l;Tr(l)?Qs.call(t,l,1):Xa(t,l)}}return t}function Qa(t,i){return t+Xs(Zu()*(i-t+1))}function _y(t,i,a,u){for(var l=-1,g=Je(Zs((i-t)/(a||1)),0),w=R(g);g--;)w[u?g:++l]=t,t+=a;return w}function Ya(t,i){var a="";if(!t||i<1||i>j)return a;do i%2&&(a+=t),i=Xs(i/2),i&&(t+=t);while(i);return a}function ge(t,i){return dc(Wh(t,i,Et),t+"")}function Ey(t){return th(hn(t))}function Iy(t,i){var a=hn(t);return vo(a,Ei(i,0,a.length))}function Hn(t,i,a,u){if(!Be(t))return t;i=ti(i,t);for(var l=-1,g=i.length,w=g-1,_=t;_!=null&&++l<g;){var x=mr(i[l]),$=a;if(x==="__proto__"||x==="constructor"||x==="prototype")return t;if(l!=w){var T=_[x];$=u?u(T,x,_):r,$===r&&($=Be(T)?T:Tr(i[l+1])?[]:{})}jn(_,x,$),_=_[x]}return t}var wh=eo?function(t,i){return eo.set(t,i),t}:Et,Py=Ys?function(t,i){return Ys(t,"toString",{configurable:!0,enumerable:!1,value:Pc(i),writable:!0})}:Et;function xy(t){return vo(hn(t))}function Qt(t,i,a){var u=-1,l=t.length;i<0&&(i=-i>l?0:l+i),a=a>l?l:a,a<0&&(a+=l),l=i>a?0:a-i>>>0,i>>>=0;for(var g=R(l);++u<l;)g[u]=t[u+i];return g}function Sy(t,i){var a;return Xr(t,function(u,l,g){return a=i(u,l,g),!a}),!!a}function ao(t,i,a){var u=0,l=t==null?u:t.length;if(typeof i=="number"&&i===i&&l<=be){for(;u<l;){var g=u+l>>>1,w=t[g];w!==null&&!qt(w)&&(a?w<=i:w<i)?u=g+1:l=g}return l}return Za(t,i,Et,a)}function Za(t,i,a,u){var l=0,g=t==null?0:t.length;if(g===0)return 0;i=a(i);for(var w=i!==i,_=i===null,x=qt(i),$=i===r;l<g;){var T=Xs((l+g)/2),B=a(t[T]),z=B!==r,J=B===null,te=B===B,fe=qt(B);if(w)var re=u||te;else $?re=te&&(u||z):_?re=te&&z&&(u||!J):x?re=te&&z&&!J&&(u||!fe):J||fe?re=!1:re=u?B<=i:B<i;re?l=T+1:g=T}return at(g,Ee)}function bh(t,i){for(var a=-1,u=t.length,l=0,g=[];++a<u;){var w=t[a],_=i?i(w):w;if(!a||!or(_,x)){var x=_;g[l++]=w===0?0:w}}return g}function _h(t){return typeof t=="number"?t:qt(t)?U:+t}function Bt(t){if(typeof t=="string")return t;if(ce(t))return De(t,Bt)+"";if(qt(t))return Xu?Xu.call(t):"";var i=t+"";return i=="0"&&1/t==-q?"-0":i}function ei(t,i,a){var u=-1,l=zs,g=t.length,w=!0,_=[],x=_;if(a)w=!1,l=Aa;else if(g>=o){var $=i?null:By(t);if($)return Us($);w=!1,l=Tn,x=new _i}else x=i?[]:_;e:for(;++u<g;){var T=t[u],B=i?i(T):T;if(T=a||T!==0?T:0,w&&B===B){for(var z=x.length;z--;)if(x[z]===B)continue e;i&&x.push(B),_.push(T)}else l(x,B,a)||(x!==_&&x.push(B),_.push(T))}return _}function Xa(t,i){return i=ti(i,t),t=Jh(t,i),t==null||delete t[mr(Yt(i))]}function Eh(t,i,a,u){return Hn(t,i,a(Ii(t,i)),u)}function co(t,i,a,u){for(var l=t.length,g=u?l:-1;(u?g--:++g<l)&&i(t[g],g,t););return a?Qt(t,u?0:g,u?g+1:l):Qt(t,u?g+1:0,u?l:g)}function Ih(t,i){var a=t;return a instanceof ve&&(a=a.value()),Fa(i,function(u,l){return l.func.apply(l.thisArg,Qr([u],l.args))},a)}function ec(t,i,a){var u=t.length;if(u<2)return u?ei(t[0]):[];for(var l=-1,g=R(u);++l<u;)for(var w=t[l],_=-1;++_<u;)_!=l&&(g[l]=zn(g[l]||w,t[_],i,a));return ei(it(g,1),i,a)}function Ph(t,i,a){for(var u=-1,l=t.length,g=i.length,w={};++u<l;){var _=u<g?i[u]:r;a(w,t[u],_)}return w}function tc(t){return Ue(t)?t:[]}function rc(t){return typeof t=="function"?t:Et}function ti(t,i){return ce(t)?t:lc(t,i)?[t]:Xh(Ie(t))}var Ay=ge;function ri(t,i,a){var u=t.length;return a=a===r?u:a,!i&&a>=u?t:Qt(t,i,a)}var xh=dg||function(t){return me.clearTimeout(t)};function Sh(t,i){if(i)return t.slice();var a=t.length,u=Gu?Gu(a):new t.constructor(a);return t.copy(u),u}function ic(t){var i=new t.constructor(t.byteLength);return new Ws(i).set(new Ws(t)),i}function Fy(t,i){var a=i?ic(t.buffer):t.buffer;return new t.constructor(a,t.byteOffset,t.byteLength)}function Oy(t){var i=new t.constructor(t.source,kt.exec(t));return i.lastIndex=t.lastIndex,i}function Ry(t){return qn?Re(qn.call(t)):{}}function Ah(t,i){var a=i?ic(t.buffer):t.buffer;return new t.constructor(a,t.byteOffset,t.length)}function Fh(t,i){if(t!==i){var a=t!==r,u=t===null,l=t===t,g=qt(t),w=i!==r,_=i===null,x=i===i,$=qt(i);if(!_&&!$&&!g&&t>i||g&&w&&x&&!_&&!$||u&&w&&x||!a&&x||!l)return 1;if(!u&&!g&&!$&&t<i||$&&a&&l&&!u&&!g||_&&a&&l||!w&&l||!x)return-1}return 0}function Cy(t,i,a){for(var u=-1,l=t.criteria,g=i.criteria,w=l.length,_=a.length;++u<w;){var x=Fh(l[u],g[u]);if(x){if(u>=_)return x;var $=a[u];return x*($=="desc"?-1:1)}}return t.index-i.index}function Oh(t,i,a,u){for(var l=-1,g=t.length,w=a.length,_=-1,x=i.length,$=Je(g-w,0),T=R(x+$),B=!u;++_<x;)T[_]=i[_];for(;++l<w;)(B||l<g)&&(T[a[l]]=t[l]);for(;$--;)T[_++]=t[l++];return T}function Rh(t,i,a,u){for(var l=-1,g=t.length,w=-1,_=a.length,x=-1,$=i.length,T=Je(g-_,0),B=R(T+$),z=!u;++l<T;)B[l]=t[l];for(var J=l;++x<$;)B[J+x]=i[x];for(;++w<_;)(z||l<g)&&(B[J+a[w]]=t[l++]);return B}function wt(t,i){var a=-1,u=t.length;for(i||(i=R(u));++a<u;)i[a]=t[a];return i}function vr(t,i,a,u){var l=!a;a||(a={});for(var g=-1,w=i.length;++g<w;){var _=i[g],x=u?u(a[_],t[_],_,a,t):r;x===r&&(x=t[_]),l?Rr(a,_,x):jn(a,_,x)}return a}function $y(t,i){return vr(t,hc(t),i)}function Ty(t,i){return vr(t,Hh(t),i)}function uo(t,i){return function(a,u){var l=ce(a)?qd:ty,g=i?i():{};return l(a,t,ee(u,2),g)}}function on(t){return ge(function(i,a){var u=-1,l=a.length,g=l>1?a[l-1]:r,w=l>2?a[2]:r;for(g=t.length>3&&typeof g=="function"?(l--,g):r,w&&dt(a[0],a[1],w)&&(g=l<3?r:g,l=1),i=Re(i);++u<l;){var _=a[u];_&&t(i,_,u,g)}return i})}function Ch(t,i){return function(a,u){if(a==null)return a;if(!bt(a))return t(a,u);for(var l=a.length,g=i?l:-1,w=Re(a);(i?g--:++g<l)&&u(w[g],g,w)!==!1;);return a}}function $h(t){return function(i,a,u){for(var l=-1,g=Re(i),w=u(i),_=w.length;_--;){var x=w[t?_:++l];if(a(g[x],x,g)===!1)break}return i}}function Ny(t,i,a){var u=i&G,l=kn(t);function g(){var w=this&&this!==me&&this instanceof g?l:t;return w.apply(u?a:this,arguments)}return g}function Th(t){return function(i){i=Ie(i);var a=Zi(i)?nr(i):r,u=a?a[0]:i.charAt(0),l=a?ri(a,1).join(""):i.slice(1);return u[t]()+l}}function an(t){return function(i){return Fa(Cl(Rl(i).replace(Cn,"")),t,"")}}function kn(t){return function(){var i=arguments;switch(i.length){case 0:return new t;case 1:return new t(i[0]);case 2:return new t(i[0],i[1]);case 3:return new t(i[0],i[1],i[2]);case 4:return new t(i[0],i[1],i[2],i[3]);case 5:return new t(i[0],i[1],i[2],i[3],i[4]);case 6:return new t(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=sn(t.prototype),u=t.apply(a,i);return Be(u)?u:a}}function Dy(t,i,a){var u=kn(t);function l(){for(var g=arguments.length,w=R(g),_=g,x=cn(l);_--;)w[_]=arguments[_];var $=g<3&&w[0]!==x&&w[g-1]!==x?[]:Yr(w,x);if(g-=$.length,g<a)return qh(t,i,ho,l.placeholder,r,w,$,r,r,a-g);var T=this&&this!==me&&this instanceof l?u:t;return Ye(T,this,w)}return l}function Nh(t){return function(i,a,u){var l=Re(i);if(!bt(i)){var g=ee(a,3);i=Ze(i),a=function(_){return g(l[_],_,l)}}var w=t(i,a,u);return w>-1?l[g?i[w]:w]:r}}function Dh(t){return $r(function(i){var a=i.length,u=a,l=Wt.prototype.thru;for(t&&i.reverse();u--;){var g=i[u];if(typeof g!="function")throw new Gt(h);if(l&&!w&&go(g)=="wrapper")var w=new Wt([],!0)}for(u=w?u:a;++u<a;){g=i[u];var _=go(g),x=_=="wrapper"?cc(g):r;x&&fc(x[0])&&x[1]==(ie|L|Y|ue)&&!x[4].length&&x[9]==1?w=w[go(x[0])].apply(w,x[3]):w=g.length==1&&fc(g)?w[_]():w.thru(g)}return function(){var $=arguments,T=$[0];if(w&&$.length==1&&ce(T))return w.plant(T).value();for(var B=0,z=a?i[B].apply(this,$):T;++B<a;)z=i[B].call(this,z);return z}})}function ho(t,i,a,u,l,g,w,_,x,$){var T=i&ie,B=i&G,z=i&H,J=i&(L|M),te=i&de,fe=z?r:kn(t);function re(){for(var ye=arguments.length,we=R(ye),jt=ye;jt--;)we[jt]=arguments[jt];if(J)var gt=cn(re),zt=Gd(we,gt);if(u&&(we=Oh(we,u,l,J)),g&&(we=Rh(we,g,w,J)),ye-=zt,J&&ye<$){var He=Yr(we,gt);return qh(t,i,ho,re.placeholder,a,we,He,_,x,$-ye)}var ar=B?a:this,Lr=z?ar[t]:t;return ye=we.length,_?we=tv(we,_):te&&ye>1&&we.reverse(),T&&x<ye&&(we.length=x),this&&this!==me&&this instanceof re&&(Lr=fe||kn(Lr)),Lr.apply(ar,we)}return re}function Lh(t,i){return function(a,u){return uy(a,t,i(u),{})}}function lo(t,i){return function(a,u){var l;if(a===r&&u===r)return i;if(a!==r&&(l=a),u!==r){if(l===r)return u;typeof a=="string"||typeof u=="string"?(a=Bt(a),u=Bt(u)):(a=_h(a),u=_h(u)),l=t(a,u)}return l}}function nc(t){return $r(function(i){return i=De(i,Lt(ee())),ge(function(a){var u=this;return t(i,function(l){return Ye(l,u,a)})})})}function fo(t,i){i=i===r?" ":Bt(i);var a=i.length;if(a<2)return a?Ya(i,t):i;var u=Ya(i,Zs(t/Xi(i)));return Zi(i)?ri(nr(u),0,t).join(""):u.slice(0,t)}function Ly(t,i,a,u){var l=i&G,g=kn(t);function w(){for(var _=-1,x=arguments.length,$=-1,T=u.length,B=R(T+x),z=this&&this!==me&&this instanceof w?g:t;++$<T;)B[$]=u[$];for(;x--;)B[$++]=arguments[++_];return Ye(z,l?a:this,B)}return w}function Bh(t){return function(i,a,u){return u&&typeof u!="number"&&dt(i,a,u)&&(a=u=r),i=Dr(i),a===r?(a=i,i=0):a=Dr(a),u=u===r?i<a?1:-1:Dr(u),_y(i,a,u,t)}}function po(t){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Zt(i),a=Zt(a)),t(i,a)}}function qh(t,i,a,u,l,g,w,_,x,$){var T=i&L,B=T?w:r,z=T?r:w,J=T?g:r,te=T?r:g;i|=T?Y:he,i&=~(T?he:Y),i&Z||(i&=~(G|H));var fe=[t,i,l,J,B,te,z,_,x,$],re=a.apply(r,fe);return fc(t)&&Qh(re,fe),re.placeholder=u,Yh(re,t,i)}function sc(t){var i=We[t];return function(a,u){if(a=Zt(a),u=u==null?0:at(le(u),292),u&&Yu(a)){var l=(Ie(a)+"e").split("e"),g=i(l[0]+"e"+(+l[1]+u));return l=(Ie(g)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return i(a)}}var By=rn&&1/Us(new rn([,-0]))[1]==q?function(t){return new rn(t)}:Ac;function jh(t){return function(i){var a=ct(i);return a==tt?Da(i):a==rt?eg(i):Kd(i,t(i))}}function Cr(t,i,a,u,l,g,w,_){var x=i&H;if(!x&&typeof t!="function")throw new Gt(h);var $=u?u.length:0;if($||(i&=~(Y|he),u=l=r),w=w===r?w:Je(le(w),0),_=_===r?_:le(_),$-=l?l.length:0,i&he){var T=u,B=l;u=l=r}var z=x?r:cc(t),J=[t,i,a,u,l,T,B,g,w,_];if(z&&Zy(J,z),t=J[0],i=J[1],a=J[2],u=J[3],l=J[4],_=J[9]=J[9]===r?x?0:t.length:Je(J[9]-$,0),!_&&i&(L|M)&&(i&=~(L|M)),!i||i==G)var te=Ny(t,i,a);else i==L||i==M?te=Dy(t,i,_):(i==Y||i==(G|Y))&&!l.length?te=Ly(t,i,a,u):te=ho.apply(r,J);var fe=z?wh:Qh;return Yh(fe(te,J),t,i)}function zh(t,i,a,u){return t===r||or(t,tn[a])&&!Pe.call(u,a)?i:t}function Mh(t,i,a,u,l,g){return Be(t)&&Be(i)&&(g.set(i,t),oo(t,i,r,Mh,g),g.delete(i)),t}function qy(t){return Gn(t)?r:t}function Uh(t,i,a,u,l,g){var w=a&F,_=t.length,x=i.length;if(_!=x&&!(w&&x>_))return!1;var $=g.get(t),T=g.get(i);if($&&T)return $==i&&T==t;var B=-1,z=!0,J=a&N?new _i:r;for(g.set(t,i),g.set(i,t);++B<_;){var te=t[B],fe=i[B];if(u)var re=w?u(fe,te,B,i,t,g):u(te,fe,B,t,i,g);if(re!==r){if(re)continue;z=!1;break}if(J){if(!Oa(i,function(ye,we){if(!Tn(J,we)&&(te===ye||l(te,ye,a,u,g)))return J.push(we)})){z=!1;break}}else if(!(te===fe||l(te,fe,a,u,g))){z=!1;break}}return g.delete(t),g.delete(i),z}function jy(t,i,a,u,l,g,w){switch(a){case Ht:if(t.byteLength!=i.byteLength||t.byteOffset!=i.byteOffset)return!1;t=t.buffer,i=i.buffer;case Ut:return!(t.byteLength!=i.byteLength||!g(new Ws(t),new Ws(i)));case $e:case ze:case Er:return or(+t,+i);case lt:return t.name==i.name&&t.message==i.message;case lr:case fr:return t==i+"";case tt:var _=Da;case rt:var x=u&F;if(_||(_=Us),t.size!=i.size&&!x)return!1;var $=w.get(t);if($)return $==i;u|=N,w.set(t,i);var T=Uh(_(t),_(i),u,l,g,w);return w.delete(t),T;case Ir:if(qn)return qn.call(t)==qn.call(i)}return!1}function zy(t,i,a,u,l,g){var w=a&F,_=oc(t),x=_.length,$=oc(i),T=$.length;if(x!=T&&!w)return!1;for(var B=x;B--;){var z=_[B];if(!(w?z in i:Pe.call(i,z)))return!1}var J=g.get(t),te=g.get(i);if(J&&te)return J==i&&te==t;var fe=!0;g.set(t,i),g.set(i,t);for(var re=w;++B<x;){z=_[B];var ye=t[z],we=i[z];if(u)var jt=w?u(we,ye,z,i,t,g):u(ye,we,z,t,i,g);if(!(jt===r?ye===we||l(ye,we,a,u,g):jt)){fe=!1;break}re||(re=z=="constructor")}if(fe&&!re){var gt=t.constructor,zt=i.constructor;gt!=zt&&"constructor"in t&&"constructor"in i&&!(typeof gt=="function"&&gt instanceof gt&&typeof zt=="function"&&zt instanceof zt)&&(fe=!1)}return g.delete(t),g.delete(i),fe}function $r(t){return dc(Wh(t,r,il),t+"")}function oc(t){return ch(t,Ze,hc)}function ac(t){return ch(t,_t,Hh)}var cc=eo?function(t){return eo.get(t)}:Ac;function go(t){for(var i=t.name+"",a=nn[i],u=Pe.call(nn,i)?a.length:0;u--;){var l=a[u],g=l.func;if(g==null||g==t)return l.name}return i}function cn(t){var i=Pe.call(d,"placeholder")?d:t;return i.placeholder}function ee(){var t=d.iteratee||xc;return t=t===xc?lh:t,arguments.length?t(arguments[0],arguments[1]):t}function yo(t,i){var a=t.__data__;return Wy(i)?a[typeof i=="string"?"string":"hash"]:a.map}function uc(t){for(var i=Ze(t),a=i.length;a--;){var u=i[a],l=t[u];i[a]=[u,l,Kh(l)]}return i}function Pi(t,i){var a=Yd(t,i);return hh(a)?a:r}function My(t){var i=Pe.call(t,wi),a=t[wi];try{t[wi]=r;var u=!0}catch{}var l=Ks.call(t);return u&&(i?t[wi]=a:delete t[wi]),l}var hc=Ba?function(t){return t==null?[]:(t=Re(t),Jr(Ba(t),function(i){return Ju.call(t,i)}))}:Fc,Hh=Ba?function(t){for(var i=[];t;)Qr(i,hc(t)),t=Js(t);return i}:Fc,ct=pt;(qa&&ct(new qa(new ArrayBuffer(1)))!=Ht||Dn&&ct(new Dn)!=tt||ja&&ct(ja.resolve())!=Ni||rn&&ct(new rn)!=rt||Ln&&ct(new Ln)!=pr)&&(ct=function(t){var i=pt(t),a=i==Nt?t.constructor:r,u=a?xi(a):"";if(u)switch(u){case Ig:return Ht;case Pg:return tt;case xg:return Ni;case Sg:return rt;case Ag:return pr}return i});function Uy(t,i,a){for(var u=-1,l=a.length;++u<l;){var g=a[u],w=g.size;switch(g.type){case"drop":t+=w;break;case"dropRight":i-=w;break;case"take":i=at(i,t+w);break;case"takeRight":t=Je(t,i-w);break}}return{start:t,end:i}}function Hy(t){var i=t.match(xr);return i?i[1].split(na):[]}function kh(t,i,a){i=ti(i,t);for(var u=-1,l=i.length,g=!1;++u<l;){var w=mr(i[u]);if(!(g=t!=null&&a(t,w)))break;t=t[w]}return g||++u!=l?g:(l=t==null?0:t.length,!!l&&Io(l)&&Tr(w,l)&&(ce(t)||Si(t)))}function ky(t){var i=t.length,a=new t.constructor(i);return i&&typeof t[0]=="string"&&Pe.call(t,"index")&&(a.index=t.index,a.input=t.input),a}function Vh(t){return typeof t.constructor=="function"&&!Vn(t)?sn(Js(t)):{}}function Vy(t,i,a){var u=t.constructor;switch(i){case Ut:return ic(t);case $e:case ze:return new u(+t);case Ht:return Fy(t,a);case Kr:case ot:case qi:case ji:case En:case zi:case Gr:case Mi:case Ui:return Ah(t,a);case tt:return new u;case Er:case fr:return new u(t);case lr:return Oy(t);case rt:return new u;case Ir:return Ry(t)}}function Ky(t,i){var a=i.length;if(!a)return t;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),t.replace(Fn,`{
/* [wrapped with `+i+`] */
`)}function Gy(t){return ce(t)||Si(t)||!!(Qu&&t&&t[Qu])}function Tr(t,i){var a=typeof t;return i=i??j,!!i&&(a=="number"||a!="symbol"&&pa.test(t))&&t>-1&&t%1==0&&t<i}function dt(t,i,a){if(!Be(a))return!1;var u=typeof i;return(u=="number"?bt(a)&&Tr(i,a.length):u=="string"&&i in a)?or(a[i],t):!1}function lc(t,i){if(ce(t))return!1;var a=typeof t;return a=="number"||a=="symbol"||a=="boolean"||t==null||qt(t)?!0:ta.test(t)||!pi.test(t)||i!=null&&t in Re(i)}function Wy(t){var i=typeof t;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?t!=="__proto__":t===null}function fc(t){var i=go(t),a=d[i];if(typeof a!="function"||!(i in ve.prototype))return!1;if(t===a)return!0;var u=cc(a);return!!u&&t===u[0]}function Jy(t){return!!Ku&&Ku in t}var Qy=ks?Nr:Oc;function Vn(t){var i=t&&t.constructor,a=typeof i=="function"&&i.prototype||tn;return t===a}function Kh(t){return t===t&&!Be(t)}function Gh(t,i){return function(a){return a==null?!1:a[t]===i&&(i!==r||t in Re(a))}}function Yy(t){var i=_o(t,function(u){return a.size===y&&a.clear(),u}),a=i.cache;return i}function Zy(t,i){var a=t[1],u=i[1],l=a|u,g=l<(G|H|ie),w=u==ie&&a==L||u==ie&&a==ue&&t[7].length<=i[8]||u==(ie|ue)&&i[7].length<=i[8]&&a==L;if(!(g||w))return t;u&G&&(t[2]=i[2],l|=a&G?0:Z);var _=i[3];if(_){var x=t[3];t[3]=x?Oh(x,_,i[4]):_,t[4]=x?Yr(t[3],v):i[4]}return _=i[5],_&&(x=t[5],t[5]=x?Rh(x,_,i[6]):_,t[6]=x?Yr(t[5],v):i[6]),_=i[7],_&&(t[7]=_),u&ie&&(t[8]=t[8]==null?i[8]:at(t[8],i[8])),t[9]==null&&(t[9]=i[9]),t[0]=i[0],t[1]=l,t}function Xy(t){var i=[];if(t!=null)for(var a in Re(t))i.push(a);return i}function ev(t){return Ks.call(t)}function Wh(t,i,a){return i=Je(i===r?t.length-1:i,0),function(){for(var u=arguments,l=-1,g=Je(u.length-i,0),w=R(g);++l<g;)w[l]=u[i+l];l=-1;for(var _=R(i+1);++l<i;)_[l]=u[l];return _[i]=a(w),Ye(t,this,_)}}function Jh(t,i){return i.length<2?t:Ii(t,Qt(i,0,-1))}function tv(t,i){for(var a=t.length,u=at(i.length,a),l=wt(t);u--;){var g=i[u];t[u]=Tr(g,a)?l[g]:r}return t}function pc(t,i){if(!(i==="constructor"&&typeof t[i]=="function")&&i!="__proto__")return t[i]}var Qh=Zh(wh),Kn=yg||function(t,i){return me.setTimeout(t,i)},dc=Zh(Py);function Yh(t,i,a){var u=i+"";return dc(t,Ky(u,rv(Hy(u),a)))}function Zh(t){var i=0,a=0;return function(){var u=bg(),l=tr-(u-a);if(a=u,l>0){if(++i>=Ce)return arguments[0]}else i=0;return t.apply(r,arguments)}}function vo(t,i){var a=-1,u=t.length,l=u-1;for(i=i===r?u:i;++a<i;){var g=Qa(a,l),w=t[g];t[g]=t[a],t[a]=w}return t.length=i,t}var Xh=Yy(function(t){var i=[];return t.charCodeAt(0)===46&&i.push(""),t.replace(ra,function(a,u,l,g){i.push(l?g.replace(aa,"$1"):u||a)}),i});function mr(t){if(typeof t=="string"||qt(t))return t;var i=t+"";return i=="0"&&1/t==-q?"-0":i}function xi(t){if(t!=null){try{return Vs.call(t)}catch{}try{return t+""}catch{}}return""}function rv(t,i){return Kt(se,function(a){var u="_."+a[0];i&a[1]&&!zs(t,u)&&t.push(u)}),t.sort()}function el(t){if(t instanceof ve)return t.clone();var i=new Wt(t.__wrapped__,t.__chain__);return i.__actions__=wt(t.__actions__),i.__index__=t.__index__,i.__values__=t.__values__,i}function iv(t,i,a){(a?dt(t,i,a):i===r)?i=1:i=Je(le(i),0);var u=t==null?0:t.length;if(!u||i<1)return[];for(var l=0,g=0,w=R(Zs(u/i));l<u;)w[g++]=Qt(t,l,l+=i);return w}function nv(t){for(var i=-1,a=t==null?0:t.length,u=0,l=[];++i<a;){var g=t[i];g&&(l[u++]=g)}return l}function sv(){var t=arguments.length;if(!t)return[];for(var i=R(t-1),a=arguments[0],u=t;u--;)i[u-1]=arguments[u];return Qr(ce(a)?wt(a):[a],it(i,1))}var ov=ge(function(t,i){return Ue(t)?zn(t,it(i,1,Ue,!0)):[]}),av=ge(function(t,i){var a=Yt(i);return Ue(a)&&(a=r),Ue(t)?zn(t,it(i,1,Ue,!0),ee(a,2)):[]}),cv=ge(function(t,i){var a=Yt(i);return Ue(a)&&(a=r),Ue(t)?zn(t,it(i,1,Ue,!0),r,a):[]});function uv(t,i,a){var u=t==null?0:t.length;return u?(i=a||i===r?1:le(i),Qt(t,i<0?0:i,u)):[]}function hv(t,i,a){var u=t==null?0:t.length;return u?(i=a||i===r?1:le(i),i=u-i,Qt(t,0,i<0?0:i)):[]}function lv(t,i){return t&&t.length?co(t,ee(i,3),!0,!0):[]}function fv(t,i){return t&&t.length?co(t,ee(i,3),!0):[]}function pv(t,i,a,u){var l=t==null?0:t.length;return l?(a&&typeof a!="number"&&dt(t,i,a)&&(a=0,u=l),sy(t,i,a,u)):[]}function tl(t,i,a){var u=t==null?0:t.length;if(!u)return-1;var l=a==null?0:le(a);return l<0&&(l=Je(u+l,0)),Ms(t,ee(i,3),l)}function rl(t,i,a){var u=t==null?0:t.length;if(!u)return-1;var l=u-1;return a!==r&&(l=le(a),l=a<0?Je(u+l,0):at(l,u-1)),Ms(t,ee(i,3),l,!0)}function il(t){var i=t==null?0:t.length;return i?it(t,1):[]}function dv(t){var i=t==null?0:t.length;return i?it(t,q):[]}function gv(t,i){var a=t==null?0:t.length;return a?(i=i===r?1:le(i),it(t,i)):[]}function yv(t){for(var i=-1,a=t==null?0:t.length,u={};++i<a;){var l=t[i];u[l[0]]=l[1]}return u}function nl(t){return t&&t.length?t[0]:r}function vv(t,i,a){var u=t==null?0:t.length;if(!u)return-1;var l=a==null?0:le(a);return l<0&&(l=Je(u+l,0)),Yi(t,i,l)}function mv(t){var i=t==null?0:t.length;return i?Qt(t,0,-1):[]}var wv=ge(function(t){var i=De(t,tc);return i.length&&i[0]===t[0]?Va(i):[]}),bv=ge(function(t){var i=Yt(t),a=De(t,tc);return i===Yt(a)?i=r:a.pop(),a.length&&a[0]===t[0]?Va(a,ee(i,2)):[]}),_v=ge(function(t){var i=Yt(t),a=De(t,tc);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===t[0]?Va(a,r,i):[]});function Ev(t,i){return t==null?"":mg.call(t,i)}function Yt(t){var i=t==null?0:t.length;return i?t[i-1]:r}function Iv(t,i,a){var u=t==null?0:t.length;if(!u)return-1;var l=u;return a!==r&&(l=le(a),l=l<0?Je(u+l,0):at(l,u-1)),i===i?rg(t,i,l):Ms(t,qu,l,!0)}function Pv(t,i){return t&&t.length?gh(t,le(i)):r}var xv=ge(sl);function sl(t,i){return t&&t.length&&i&&i.length?Ja(t,i):t}function Sv(t,i,a){return t&&t.length&&i&&i.length?Ja(t,i,ee(a,2)):t}function Av(t,i,a){return t&&t.length&&i&&i.length?Ja(t,i,r,a):t}var Fv=$r(function(t,i){var a=t==null?0:t.length,u=Ma(t,i);return mh(t,De(i,function(l){return Tr(l,a)?+l:l}).sort(Fh)),u});function Ov(t,i){var a=[];if(!(t&&t.length))return a;var u=-1,l=[],g=t.length;for(i=ee(i,3);++u<g;){var w=t[u];i(w,u,t)&&(a.push(w),l.push(u))}return mh(t,l),a}function gc(t){return t==null?t:Eg.call(t)}function Rv(t,i,a){var u=t==null?0:t.length;return u?(a&&typeof a!="number"&&dt(t,i,a)?(i=0,a=u):(i=i==null?0:le(i),a=a===r?u:le(a)),Qt(t,i,a)):[]}function Cv(t,i){return ao(t,i)}function $v(t,i,a){return Za(t,i,ee(a,2))}function Tv(t,i){var a=t==null?0:t.length;if(a){var u=ao(t,i);if(u<a&&or(t[u],i))return u}return-1}function Nv(t,i){return ao(t,i,!0)}function Dv(t,i,a){return Za(t,i,ee(a,2),!0)}function Lv(t,i){var a=t==null?0:t.length;if(a){var u=ao(t,i,!0)-1;if(or(t[u],i))return u}return-1}function Bv(t){return t&&t.length?bh(t):[]}function qv(t,i){return t&&t.length?bh(t,ee(i,2)):[]}function jv(t){var i=t==null?0:t.length;return i?Qt(t,1,i):[]}function zv(t,i,a){return t&&t.length?(i=a||i===r?1:le(i),Qt(t,0,i<0?0:i)):[]}function Mv(t,i,a){var u=t==null?0:t.length;return u?(i=a||i===r?1:le(i),i=u-i,Qt(t,i<0?0:i,u)):[]}function Uv(t,i){return t&&t.length?co(t,ee(i,3),!1,!0):[]}function Hv(t,i){return t&&t.length?co(t,ee(i,3)):[]}var kv=ge(function(t){return ei(it(t,1,Ue,!0))}),Vv=ge(function(t){var i=Yt(t);return Ue(i)&&(i=r),ei(it(t,1,Ue,!0),ee(i,2))}),Kv=ge(function(t){var i=Yt(t);return i=typeof i=="function"?i:r,ei(it(t,1,Ue,!0),r,i)});function Gv(t){return t&&t.length?ei(t):[]}function Wv(t,i){return t&&t.length?ei(t,ee(i,2)):[]}function Jv(t,i){return i=typeof i=="function"?i:r,t&&t.length?ei(t,r,i):[]}function yc(t){if(!(t&&t.length))return[];var i=0;return t=Jr(t,function(a){if(Ue(a))return i=Je(a.length,i),!0}),Ta(i,function(a){return De(t,Ra(a))})}function ol(t,i){if(!(t&&t.length))return[];var a=yc(t);return i==null?a:De(a,function(u){return Ye(i,r,u)})}var Qv=ge(function(t,i){return Ue(t)?zn(t,i):[]}),Yv=ge(function(t){return ec(Jr(t,Ue))}),Zv=ge(function(t){var i=Yt(t);return Ue(i)&&(i=r),ec(Jr(t,Ue),ee(i,2))}),Xv=ge(function(t){var i=Yt(t);return i=typeof i=="function"?i:r,ec(Jr(t,Ue),r,i)}),em=ge(yc);function tm(t,i){return Ph(t||[],i||[],jn)}function rm(t,i){return Ph(t||[],i||[],Hn)}var im=ge(function(t){var i=t.length,a=i>1?t[i-1]:r;return a=typeof a=="function"?(t.pop(),a):r,ol(t,a)});function al(t){var i=d(t);return i.__chain__=!0,i}function nm(t,i){return i(t),t}function mo(t,i){return i(t)}var sm=$r(function(t){var i=t.length,a=i?t[0]:0,u=this.__wrapped__,l=function(g){return Ma(g,t)};return i>1||this.__actions__.length||!(u instanceof ve)||!Tr(a)?this.thru(l):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:mo,args:[l],thisArg:r}),new Wt(u,this.__chain__).thru(function(g){return i&&!g.length&&g.push(r),g}))});function om(){return al(this)}function am(){return new Wt(this.value(),this.__chain__)}function cm(){this.__values__===r&&(this.__values__=_l(this.value()));var t=this.__index__>=this.__values__.length,i=t?r:this.__values__[this.__index__++];return{done:t,value:i}}function um(){return this}function hm(t){for(var i,a=this;a instanceof ro;){var u=el(a);u.__index__=0,u.__values__=r,i?l.__wrapped__=u:i=u;var l=u;a=a.__wrapped__}return l.__wrapped__=t,i}function lm(){var t=this.__wrapped__;if(t instanceof ve){var i=t;return this.__actions__.length&&(i=new ve(this)),i=i.reverse(),i.__actions__.push({func:mo,args:[gc],thisArg:r}),new Wt(i,this.__chain__)}return this.thru(gc)}function fm(){return Ih(this.__wrapped__,this.__actions__)}var pm=uo(function(t,i,a){Pe.call(t,a)?++t[a]:Rr(t,a,1)});function dm(t,i,a){var u=ce(t)?Lu:ny;return a&&dt(t,i,a)&&(i=r),u(t,ee(i,3))}function gm(t,i){var a=ce(t)?Jr:oh;return a(t,ee(i,3))}var ym=Nh(tl),vm=Nh(rl);function mm(t,i){return it(wo(t,i),1)}function wm(t,i){return it(wo(t,i),q)}function bm(t,i,a){return a=a===r?1:le(a),it(wo(t,i),a)}function cl(t,i){var a=ce(t)?Kt:Xr;return a(t,ee(i,3))}function ul(t,i){var a=ce(t)?jd:sh;return a(t,ee(i,3))}var _m=uo(function(t,i,a){Pe.call(t,a)?t[a].push(i):Rr(t,a,[i])});function Em(t,i,a,u){t=bt(t)?t:hn(t),a=a&&!u?le(a):0;var l=t.length;return a<0&&(a=Je(l+a,0)),Po(t)?a<=l&&t.indexOf(i,a)>-1:!!l&&Yi(t,i,a)>-1}var Im=ge(function(t,i,a){var u=-1,l=typeof i=="function",g=bt(t)?R(t.length):[];return Xr(t,function(w){g[++u]=l?Ye(i,w,a):Mn(w,i,a)}),g}),Pm=uo(function(t,i,a){Rr(t,a,i)});function wo(t,i){var a=ce(t)?De:fh;return a(t,ee(i,3))}function xm(t,i,a,u){return t==null?[]:(ce(i)||(i=i==null?[]:[i]),a=u?r:a,ce(a)||(a=a==null?[]:[a]),yh(t,i,a))}var Sm=uo(function(t,i,a){t[a?0:1].push(i)},function(){return[[],[]]});function Am(t,i,a){var u=ce(t)?Fa:zu,l=arguments.length<3;return u(t,ee(i,4),a,l,Xr)}function Fm(t,i,a){var u=ce(t)?zd:zu,l=arguments.length<3;return u(t,ee(i,4),a,l,sh)}function Om(t,i){var a=ce(t)?Jr:oh;return a(t,Eo(ee(i,3)))}function Rm(t){var i=ce(t)?th:Ey;return i(t)}function Cm(t,i,a){(a?dt(t,i,a):i===r)?i=1:i=le(i);var u=ce(t)?Xg:Iy;return u(t,i)}function $m(t){var i=ce(t)?ey:xy;return i(t)}function Tm(t){if(t==null)return 0;if(bt(t))return Po(t)?Xi(t):t.length;var i=ct(t);return i==tt||i==rt?t.size:Ga(t).length}function Nm(t,i,a){var u=ce(t)?Oa:Sy;return a&&dt(t,i,a)&&(i=r),u(t,ee(i,3))}var Dm=ge(function(t,i){if(t==null)return[];var a=i.length;return a>1&&dt(t,i[0],i[1])?i=[]:a>2&&dt(i[0],i[1],i[2])&&(i=[i[0]]),yh(t,it(i,1),[])}),bo=gg||function(){return me.Date.now()};function Lm(t,i){if(typeof i!="function")throw new Gt(h);return t=le(t),function(){if(--t<1)return i.apply(this,arguments)}}function hl(t,i,a){return i=a?r:i,i=t&&i==null?t.length:i,Cr(t,ie,r,r,r,r,i)}function ll(t,i){var a;if(typeof i!="function")throw new Gt(h);return t=le(t),function(){return--t>0&&(a=i.apply(this,arguments)),t<=1&&(i=r),a}}var vc=ge(function(t,i,a){var u=G;if(a.length){var l=Yr(a,cn(vc));u|=Y}return Cr(t,u,i,a,l)}),fl=ge(function(t,i,a){var u=G|H;if(a.length){var l=Yr(a,cn(fl));u|=Y}return Cr(i,u,t,a,l)});function pl(t,i,a){i=a?r:i;var u=Cr(t,L,r,r,r,r,r,i);return u.placeholder=pl.placeholder,u}function dl(t,i,a){i=a?r:i;var u=Cr(t,M,r,r,r,r,r,i);return u.placeholder=dl.placeholder,u}function gl(t,i,a){var u,l,g,w,_,x,$=0,T=!1,B=!1,z=!0;if(typeof t!="function")throw new Gt(h);i=Zt(i)||0,Be(a)&&(T=!!a.leading,B="maxWait"in a,g=B?Je(Zt(a.maxWait)||0,i):g,z="trailing"in a?!!a.trailing:z);function J(He){var ar=u,Lr=l;return u=l=r,$=He,w=t.apply(Lr,ar),w}function te(He){return $=He,_=Kn(ye,i),T?J(He):w}function fe(He){var ar=He-x,Lr=He-$,Nl=i-ar;return B?at(Nl,g-Lr):Nl}function re(He){var ar=He-x,Lr=He-$;return x===r||ar>=i||ar<0||B&&Lr>=g}function ye(){var He=bo();if(re(He))return we(He);_=Kn(ye,fe(He))}function we(He){return _=r,z&&u?J(He):(u=l=r,w)}function jt(){_!==r&&xh(_),$=0,u=x=l=_=r}function gt(){return _===r?w:we(bo())}function zt(){var He=bo(),ar=re(He);if(u=arguments,l=this,x=He,ar){if(_===r)return te(x);if(B)return xh(_),_=Kn(ye,i),J(x)}return _===r&&(_=Kn(ye,i)),w}return zt.cancel=jt,zt.flush=gt,zt}var Bm=ge(function(t,i){return nh(t,1,i)}),qm=ge(function(t,i,a){return nh(t,Zt(i)||0,a)});function jm(t){return Cr(t,de)}function _o(t,i){if(typeof t!="function"||i!=null&&typeof i!="function")throw new Gt(h);var a=function(){var u=arguments,l=i?i.apply(this,u):u[0],g=a.cache;if(g.has(l))return g.get(l);var w=t.apply(this,u);return a.cache=g.set(l,w)||g,w};return a.cache=new(_o.Cache||Or),a}_o.Cache=Or;function Eo(t){if(typeof t!="function")throw new Gt(h);return function(){var i=arguments;switch(i.length){case 0:return!t.call(this);case 1:return!t.call(this,i[0]);case 2:return!t.call(this,i[0],i[1]);case 3:return!t.call(this,i[0],i[1],i[2])}return!t.apply(this,i)}}function zm(t){return ll(2,t)}var Mm=Ay(function(t,i){i=i.length==1&&ce(i[0])?De(i[0],Lt(ee())):De(it(i,1),Lt(ee()));var a=i.length;return ge(function(u){for(var l=-1,g=at(u.length,a);++l<g;)u[l]=i[l].call(this,u[l]);return Ye(t,this,u)})}),mc=ge(function(t,i){var a=Yr(i,cn(mc));return Cr(t,Y,r,i,a)}),yl=ge(function(t,i){var a=Yr(i,cn(yl));return Cr(t,he,r,i,a)}),Um=$r(function(t,i){return Cr(t,ue,r,r,r,i)});function Hm(t,i){if(typeof t!="function")throw new Gt(h);return i=i===r?i:le(i),ge(t,i)}function km(t,i){if(typeof t!="function")throw new Gt(h);return i=i==null?0:Je(le(i),0),ge(function(a){var u=a[i],l=ri(a,0,i);return u&&Qr(l,u),Ye(t,this,l)})}function Vm(t,i,a){var u=!0,l=!0;if(typeof t!="function")throw new Gt(h);return Be(a)&&(u="leading"in a?!!a.leading:u,l="trailing"in a?!!a.trailing:l),gl(t,i,{leading:u,maxWait:i,trailing:l})}function Km(t){return hl(t,1)}function Gm(t,i){return mc(rc(i),t)}function Wm(){if(!arguments.length)return[];var t=arguments[0];return ce(t)?t:[t]}function Jm(t){return Jt(t,O)}function Qm(t,i){return i=typeof i=="function"?i:r,Jt(t,O,i)}function Ym(t){return Jt(t,b|O)}function Zm(t,i){return i=typeof i=="function"?i:r,Jt(t,b|O,i)}function Xm(t,i){return i==null||ih(t,i,Ze(i))}function or(t,i){return t===i||t!==t&&i!==i}var e1=po(ka),t1=po(function(t,i){return t>=i}),Si=uh(function(){return arguments}())?uh:function(t){return je(t)&&Pe.call(t,"callee")&&!Ju.call(t,"callee")},ce=R.isArray,r1=ft?Lt(ft):hy;function bt(t){return t!=null&&Io(t.length)&&!Nr(t)}function Ue(t){return je(t)&&bt(t)}function i1(t){return t===!0||t===!1||je(t)&&pt(t)==$e}var ii=vg||Oc,n1=ir?Lt(ir):ly;function s1(t){return je(t)&&t.nodeType===1&&!Gn(t)}function o1(t){if(t==null)return!0;if(bt(t)&&(ce(t)||typeof t=="string"||typeof t.splice=="function"||ii(t)||un(t)||Si(t)))return!t.length;var i=ct(t);if(i==tt||i==rt)return!t.size;if(Vn(t))return!Ga(t).length;for(var a in t)if(Pe.call(t,a))return!1;return!0}function a1(t,i){return Un(t,i)}function c1(t,i,a){a=typeof a=="function"?a:r;var u=a?a(t,i):r;return u===r?Un(t,i,r,a):!!u}function wc(t){if(!je(t))return!1;var i=pt(t);return i==lt||i==$t||typeof t.message=="string"&&typeof t.name=="string"&&!Gn(t)}function u1(t){return typeof t=="number"&&Yu(t)}function Nr(t){if(!Be(t))return!1;var i=pt(t);return i==Tt||i==Vr||i==Ct||i==Di}function vl(t){return typeof t=="number"&&t==le(t)}function Io(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=j}function Be(t){var i=typeof t;return t!=null&&(i=="object"||i=="function")}function je(t){return t!=null&&typeof t=="object"}var ml=Vt?Lt(Vt):py;function h1(t,i){return t===i||Ka(t,i,uc(i))}function l1(t,i,a){return a=typeof a=="function"?a:r,Ka(t,i,uc(i),a)}function f1(t){return wl(t)&&t!=+t}function p1(t){if(Qy(t))throw new oe(c);return hh(t)}function d1(t){return t===null}function g1(t){return t==null}function wl(t){return typeof t=="number"||je(t)&&pt(t)==Er}function Gn(t){if(!je(t)||pt(t)!=Nt)return!1;var i=Js(t);if(i===null)return!0;var a=Pe.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&Vs.call(a)==lg}var bc=gr?Lt(gr):dy;function y1(t){return vl(t)&&t>=-j&&t<=j}var bl=$n?Lt($n):gy;function Po(t){return typeof t=="string"||!ce(t)&&je(t)&&pt(t)==fr}function qt(t){return typeof t=="symbol"||je(t)&&pt(t)==Ir}var un=mi?Lt(mi):yy;function v1(t){return t===r}function m1(t){return je(t)&&ct(t)==pr}function w1(t){return je(t)&&pt(t)==Bi}var b1=po(Wa),_1=po(function(t,i){return t<=i});function _l(t){if(!t)return[];if(bt(t))return Po(t)?nr(t):wt(t);if(Nn&&t[Nn])return Xd(t[Nn]());var i=ct(t),a=i==tt?Da:i==rt?Us:hn;return a(t)}function Dr(t){if(!t)return t===0?t:0;if(t=Zt(t),t===q||t===-q){var i=t<0?-1:1;return i*W}return t===t?t:0}function le(t){var i=Dr(t),a=i%1;return i===i?a?i-a:i:0}function El(t){return t?Ei(le(t),0,ne):0}function Zt(t){if(typeof t=="number")return t;if(qt(t))return U;if(Be(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=Be(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=Mu(t);var a=ha.test(t);return a||fa.test(t)?ae(t.slice(2),a?2:8):ua.test(t)?U:+t}function Il(t){return vr(t,_t(t))}function E1(t){return t?Ei(le(t),-j,j):t===0?t:0}function Ie(t){return t==null?"":Bt(t)}var I1=on(function(t,i){if(Vn(i)||bt(i)){vr(i,Ze(i),t);return}for(var a in i)Pe.call(i,a)&&jn(t,a,i[a])}),Pl=on(function(t,i){vr(i,_t(i),t)}),xo=on(function(t,i,a,u){vr(i,_t(i),t,u)}),P1=on(function(t,i,a,u){vr(i,Ze(i),t,u)}),x1=$r(Ma);function S1(t,i){var a=sn(t);return i==null?a:rh(a,i)}var A1=ge(function(t,i){t=Re(t);var a=-1,u=i.length,l=u>2?i[2]:r;for(l&&dt(i[0],i[1],l)&&(u=1);++a<u;)for(var g=i[a],w=_t(g),_=-1,x=w.length;++_<x;){var $=w[_],T=t[$];(T===r||or(T,tn[$])&&!Pe.call(t,$))&&(t[$]=g[$])}return t}),F1=ge(function(t){return t.push(r,Mh),Ye(xl,r,t)});function O1(t,i){return Bu(t,ee(i,3),yr)}function R1(t,i){return Bu(t,ee(i,3),Ha)}function C1(t,i){return t==null?t:Ua(t,ee(i,3),_t)}function $1(t,i){return t==null?t:ah(t,ee(i,3),_t)}function T1(t,i){return t&&yr(t,ee(i,3))}function N1(t,i){return t&&Ha(t,ee(i,3))}function D1(t){return t==null?[]:so(t,Ze(t))}function L1(t){return t==null?[]:so(t,_t(t))}function _c(t,i,a){var u=t==null?r:Ii(t,i);return u===r?a:u}function B1(t,i){return t!=null&&kh(t,i,oy)}function Ec(t,i){return t!=null&&kh(t,i,ay)}var q1=Lh(function(t,i,a){i!=null&&typeof i.toString!="function"&&(i=Ks.call(i)),t[i]=a},Pc(Et)),j1=Lh(function(t,i,a){i!=null&&typeof i.toString!="function"&&(i=Ks.call(i)),Pe.call(t,i)?t[i].push(a):t[i]=[a]},ee),z1=ge(Mn);function Ze(t){return bt(t)?eh(t):Ga(t)}function _t(t){return bt(t)?eh(t,!0):vy(t)}function M1(t,i){var a={};return i=ee(i,3),yr(t,function(u,l,g){Rr(a,i(u,l,g),u)}),a}function U1(t,i){var a={};return i=ee(i,3),yr(t,function(u,l,g){Rr(a,l,i(u,l,g))}),a}var H1=on(function(t,i,a){oo(t,i,a)}),xl=on(function(t,i,a,u){oo(t,i,a,u)}),k1=$r(function(t,i){var a={};if(t==null)return a;var u=!1;i=De(i,function(g){return g=ti(g,t),u||(u=g.length>1),g}),vr(t,ac(t),a),u&&(a=Jt(a,b|S|O,qy));for(var l=i.length;l--;)Xa(a,i[l]);return a});function V1(t,i){return Sl(t,Eo(ee(i)))}var K1=$r(function(t,i){return t==null?{}:wy(t,i)});function Sl(t,i){if(t==null)return{};var a=De(ac(t),function(u){return[u]});return i=ee(i),vh(t,a,function(u,l){return i(u,l[0])})}function G1(t,i,a){i=ti(i,t);var u=-1,l=i.length;for(l||(l=1,t=r);++u<l;){var g=t==null?r:t[mr(i[u])];g===r&&(u=l,g=a),t=Nr(g)?g.call(t):g}return t}function W1(t,i,a){return t==null?t:Hn(t,i,a)}function J1(t,i,a,u){return u=typeof u=="function"?u:r,t==null?t:Hn(t,i,a,u)}var Al=jh(Ze),Fl=jh(_t);function Q1(t,i,a){var u=ce(t),l=u||ii(t)||un(t);if(i=ee(i,4),a==null){var g=t&&t.constructor;l?a=u?new g:[]:Be(t)?a=Nr(g)?sn(Js(t)):{}:a={}}return(l?Kt:yr)(t,function(w,_,x){return i(a,w,_,x)}),a}function Y1(t,i){return t==null?!0:Xa(t,i)}function Z1(t,i,a){return t==null?t:Eh(t,i,rc(a))}function X1(t,i,a,u){return u=typeof u=="function"?u:r,t==null?t:Eh(t,i,rc(a),u)}function hn(t){return t==null?[]:Na(t,Ze(t))}function ew(t){return t==null?[]:Na(t,_t(t))}function tw(t,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Zt(a),a=a===a?a:0),i!==r&&(i=Zt(i),i=i===i?i:0),Ei(Zt(t),i,a)}function rw(t,i,a){return i=Dr(i),a===r?(a=i,i=0):a=Dr(a),t=Zt(t),cy(t,i,a)}function iw(t,i,a){if(a&&typeof a!="boolean"&&dt(t,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof t=="boolean"&&(a=t,t=r)),t===r&&i===r?(t=0,i=1):(t=Dr(t),i===r?(i=t,t=0):i=Dr(i)),t>i){var u=t;t=i,i=u}if(a||t%1||i%1){var l=Zu();return at(t+l*(i-t+Fe("1e-"+((l+"").length-1))),i)}return Qa(t,i)}var nw=an(function(t,i,a){return i=i.toLowerCase(),t+(a?Ol(i):i)});function Ol(t){return Ic(Ie(t).toLowerCase())}function Rl(t){return t=Ie(t),t&&t.replace(Sr,Wd).replace(xa,"")}function sw(t,i,a){t=Ie(t),i=Bt(i);var u=t.length;a=a===r?u:Ei(le(a),0,u);var l=a;return a-=i.length,a>=0&&t.slice(a,l)==i}function ow(t){return t=Ie(t),t&&fi.test(t)?t.replace(ws,Jd):t}function aw(t){return t=Ie(t),t&&ia.test(t)?t.replace(Sn,"\\$&"):t}var cw=an(function(t,i,a){return t+(a?"-":"")+i.toLowerCase()}),uw=an(function(t,i,a){return t+(a?" ":"")+i.toLowerCase()}),hw=Th("toLowerCase");function lw(t,i,a){t=Ie(t),i=le(i);var u=i?Xi(t):0;if(!i||u>=i)return t;var l=(i-u)/2;return fo(Xs(l),a)+t+fo(Zs(l),a)}function fw(t,i,a){t=Ie(t),i=le(i);var u=i?Xi(t):0;return i&&u<i?t+fo(i-u,a):t}function pw(t,i,a){t=Ie(t),i=le(i);var u=i?Xi(t):0;return i&&u<i?fo(i-u,a)+t:t}function dw(t,i,a){return a||i==null?i=0:i&&(i=+i),_g(Ie(t).replace(An,""),i||0)}function gw(t,i,a){return(a?dt(t,i,a):i===r)?i=1:i=le(i),Ya(Ie(t),i)}function yw(){var t=arguments,i=Ie(t[0]);return t.length<3?i:i.replace(t[1],t[2])}var vw=an(function(t,i,a){return t+(a?"_":"")+i.toLowerCase()});function mw(t,i,a){return a&&typeof a!="number"&&dt(t,i,a)&&(i=a=r),a=a===r?ne:a>>>0,a?(t=Ie(t),t&&(typeof i=="string"||i!=null&&!bc(i))&&(i=Bt(i),!i&&Zi(t))?ri(nr(t),0,a):t.split(i,a)):[]}var ww=an(function(t,i,a){return t+(a?" ":"")+Ic(i)});function bw(t,i,a){return t=Ie(t),a=a==null?0:Ei(le(a),0,t.length),i=Bt(i),t.slice(a,a+i.length)==i}function _w(t,i,a){var u=d.templateSettings;a&&dt(t,i,a)&&(i=r),t=Ie(t),i=xo({},i,u,zh);var l=xo({},i.imports,u.imports,zh),g=Ze(l),w=Na(l,g),_,x,$=0,T=i.interpolate||ki,B="__p += '",z=La((i.escape||ki).source+"|"+T.source+"|"+(T===Hi?ca:ki).source+"|"+(i.evaluate||ki).source+"|$","g"),J="//# sourceURL="+(Pe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Sa+"]")+`
`;t.replace(z,function(re,ye,we,jt,gt,zt){return we||(we=jt),B+=t.slice($,zt).replace(da,Qd),ye&&(_=!0,B+=`' +
__e(`+ye+`) +
'`),gt&&(x=!0,B+=`';
`+gt+`;
__p += '`),we&&(B+=`' +
((__t = (`+we+`)) == null ? '' : __t) +
'`),$=zt+re.length,re}),B+=`';
`;var te=Pe.call(i,"variable")&&i.variable;if(!te)B=`with (obj) {
`+B+`
}
`;else if(oa.test(te))throw new oe(p);B=(x?B.replace(ea,""):B).replace(Pr,"$1").replace(vs,"$1;"),B="function("+(te||"obj")+`) {
`+(te?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+B+`return __p
}`;var fe=$l(function(){return _e(g,J+"return "+B).apply(r,w)});if(fe.source=B,wc(fe))throw fe;return fe}function Ew(t){return Ie(t).toLowerCase()}function Iw(t){return Ie(t).toUpperCase()}function Pw(t,i,a){if(t=Ie(t),t&&(a||i===r))return Mu(t);if(!t||!(i=Bt(i)))return t;var u=nr(t),l=nr(i),g=Uu(u,l),w=Hu(u,l)+1;return ri(u,g,w).join("")}function xw(t,i,a){if(t=Ie(t),t&&(a||i===r))return t.slice(0,Vu(t)+1);if(!t||!(i=Bt(i)))return t;var u=nr(t),l=Hu(u,nr(i))+1;return ri(u,0,l).join("")}function Sw(t,i,a){if(t=Ie(t),t&&(a||i===r))return t.replace(An,"");if(!t||!(i=Bt(i)))return t;var u=nr(t),l=Uu(u,nr(i));return ri(u,l).join("")}function Aw(t,i){var a=yt,u=vt;if(Be(i)){var l="separator"in i?i.separator:l;a="length"in i?le(i.length):a,u="omission"in i?Bt(i.omission):u}t=Ie(t);var g=t.length;if(Zi(t)){var w=nr(t);g=w.length}if(a>=g)return t;var _=a-Xi(u);if(_<1)return u;var x=w?ri(w,0,_).join(""):t.slice(0,_);if(l===r)return x+u;if(w&&(_+=x.length-_),bc(l)){if(t.slice(_).search(l)){var $,T=x;for(l.global||(l=La(l.source,Ie(kt.exec(l))+"g")),l.lastIndex=0;$=l.exec(T);)var B=$.index;x=x.slice(0,B===r?_:B)}}else if(t.indexOf(Bt(l),_)!=_){var z=x.lastIndexOf(l);z>-1&&(x=x.slice(0,z))}return x+u}function Fw(t){return t=Ie(t),t&&In.test(t)?t.replace(ms,ig):t}var Ow=an(function(t,i,a){return t+(a?" ":"")+i.toUpperCase()}),Ic=Th("toUpperCase");function Cl(t,i,a){return t=Ie(t),i=a?r:i,i===r?Zd(t)?og(t):Hd(t):t.match(i)||[]}var $l=ge(function(t,i){try{return Ye(t,r,i)}catch(a){return wc(a)?a:new oe(a)}}),Rw=$r(function(t,i){return Kt(i,function(a){a=mr(a),Rr(t,a,vc(t[a],t))}),t});function Cw(t){var i=t==null?0:t.length,a=ee();return t=i?De(t,function(u){if(typeof u[1]!="function")throw new Gt(h);return[a(u[0]),u[1]]}):[],ge(function(u){for(var l=-1;++l<i;){var g=t[l];if(Ye(g[0],this,u))return Ye(g[1],this,u)}})}function $w(t){return iy(Jt(t,b))}function Pc(t){return function(){return t}}function Tw(t,i){return t==null||t!==t?i:t}var Nw=Dh(),Dw=Dh(!0);function Et(t){return t}function xc(t){return lh(typeof t=="function"?t:Jt(t,b))}function Lw(t){return ph(Jt(t,b))}function Bw(t,i){return dh(t,Jt(i,b))}var qw=ge(function(t,i){return function(a){return Mn(a,t,i)}}),jw=ge(function(t,i){return function(a){return Mn(t,a,i)}});function Sc(t,i,a){var u=Ze(i),l=so(i,u);a==null&&!(Be(i)&&(l.length||!u.length))&&(a=i,i=t,t=this,l=so(i,Ze(i)));var g=!(Be(a)&&"chain"in a)||!!a.chain,w=Nr(t);return Kt(l,function(_){var x=i[_];t[_]=x,w&&(t.prototype[_]=function(){var $=this.__chain__;if(g||$){var T=t(this.__wrapped__),B=T.__actions__=wt(this.__actions__);return B.push({func:x,args:arguments,thisArg:t}),T.__chain__=$,T}return x.apply(t,Qr([this.value()],arguments))})}),t}function zw(){return me._===this&&(me._=fg),this}function Ac(){}function Mw(t){return t=le(t),ge(function(i){return gh(i,t)})}var Uw=nc(De),Hw=nc(Lu),kw=nc(Oa);function Tl(t){return lc(t)?Ra(mr(t)):by(t)}function Vw(t){return function(i){return t==null?r:Ii(t,i)}}var Kw=Bh(),Gw=Bh(!0);function Fc(){return[]}function Oc(){return!1}function Ww(){return{}}function Jw(){return""}function Qw(){return!0}function Yw(t,i){if(t=le(t),t<1||t>j)return[];var a=ne,u=at(t,ne);i=ee(i),t-=ne;for(var l=Ta(u,i);++a<t;)i(a);return l}function Zw(t){return ce(t)?De(t,mr):qt(t)?[t]:wt(Xh(Ie(t)))}function Xw(t){var i=++hg;return Ie(t)+i}var e0=lo(function(t,i){return t+i},0),t0=sc("ceil"),r0=lo(function(t,i){return t/i},1),i0=sc("floor");function n0(t){return t&&t.length?no(t,Et,ka):r}function s0(t,i){return t&&t.length?no(t,ee(i,2),ka):r}function o0(t){return ju(t,Et)}function a0(t,i){return ju(t,ee(i,2))}function c0(t){return t&&t.length?no(t,Et,Wa):r}function u0(t,i){return t&&t.length?no(t,ee(i,2),Wa):r}var h0=lo(function(t,i){return t*i},1),l0=sc("round"),f0=lo(function(t,i){return t-i},0);function p0(t){return t&&t.length?$a(t,Et):0}function d0(t,i){return t&&t.length?$a(t,ee(i,2)):0}return d.after=Lm,d.ary=hl,d.assign=I1,d.assignIn=Pl,d.assignInWith=xo,d.assignWith=P1,d.at=x1,d.before=ll,d.bind=vc,d.bindAll=Rw,d.bindKey=fl,d.castArray=Wm,d.chain=al,d.chunk=iv,d.compact=nv,d.concat=sv,d.cond=Cw,d.conforms=$w,d.constant=Pc,d.countBy=pm,d.create=S1,d.curry=pl,d.curryRight=dl,d.debounce=gl,d.defaults=A1,d.defaultsDeep=F1,d.defer=Bm,d.delay=qm,d.difference=ov,d.differenceBy=av,d.differenceWith=cv,d.drop=uv,d.dropRight=hv,d.dropRightWhile=lv,d.dropWhile=fv,d.fill=pv,d.filter=gm,d.flatMap=mm,d.flatMapDeep=wm,d.flatMapDepth=bm,d.flatten=il,d.flattenDeep=dv,d.flattenDepth=gv,d.flip=jm,d.flow=Nw,d.flowRight=Dw,d.fromPairs=yv,d.functions=D1,d.functionsIn=L1,d.groupBy=_m,d.initial=mv,d.intersection=wv,d.intersectionBy=bv,d.intersectionWith=_v,d.invert=q1,d.invertBy=j1,d.invokeMap=Im,d.iteratee=xc,d.keyBy=Pm,d.keys=Ze,d.keysIn=_t,d.map=wo,d.mapKeys=M1,d.mapValues=U1,d.matches=Lw,d.matchesProperty=Bw,d.memoize=_o,d.merge=H1,d.mergeWith=xl,d.method=qw,d.methodOf=jw,d.mixin=Sc,d.negate=Eo,d.nthArg=Mw,d.omit=k1,d.omitBy=V1,d.once=zm,d.orderBy=xm,d.over=Uw,d.overArgs=Mm,d.overEvery=Hw,d.overSome=kw,d.partial=mc,d.partialRight=yl,d.partition=Sm,d.pick=K1,d.pickBy=Sl,d.property=Tl,d.propertyOf=Vw,d.pull=xv,d.pullAll=sl,d.pullAllBy=Sv,d.pullAllWith=Av,d.pullAt=Fv,d.range=Kw,d.rangeRight=Gw,d.rearg=Um,d.reject=Om,d.remove=Ov,d.rest=Hm,d.reverse=gc,d.sampleSize=Cm,d.set=W1,d.setWith=J1,d.shuffle=$m,d.slice=Rv,d.sortBy=Dm,d.sortedUniq=Bv,d.sortedUniqBy=qv,d.split=mw,d.spread=km,d.tail=jv,d.take=zv,d.takeRight=Mv,d.takeRightWhile=Uv,d.takeWhile=Hv,d.tap=nm,d.throttle=Vm,d.thru=mo,d.toArray=_l,d.toPairs=Al,d.toPairsIn=Fl,d.toPath=Zw,d.toPlainObject=Il,d.transform=Q1,d.unary=Km,d.union=kv,d.unionBy=Vv,d.unionWith=Kv,d.uniq=Gv,d.uniqBy=Wv,d.uniqWith=Jv,d.unset=Y1,d.unzip=yc,d.unzipWith=ol,d.update=Z1,d.updateWith=X1,d.values=hn,d.valuesIn=ew,d.without=Qv,d.words=Cl,d.wrap=Gm,d.xor=Yv,d.xorBy=Zv,d.xorWith=Xv,d.zip=em,d.zipObject=tm,d.zipObjectDeep=rm,d.zipWith=im,d.entries=Al,d.entriesIn=Fl,d.extend=Pl,d.extendWith=xo,Sc(d,d),d.add=e0,d.attempt=$l,d.camelCase=nw,d.capitalize=Ol,d.ceil=t0,d.clamp=tw,d.clone=Jm,d.cloneDeep=Ym,d.cloneDeepWith=Zm,d.cloneWith=Qm,d.conformsTo=Xm,d.deburr=Rl,d.defaultTo=Tw,d.divide=r0,d.endsWith=sw,d.eq=or,d.escape=ow,d.escapeRegExp=aw,d.every=dm,d.find=ym,d.findIndex=tl,d.findKey=O1,d.findLast=vm,d.findLastIndex=rl,d.findLastKey=R1,d.floor=i0,d.forEach=cl,d.forEachRight=ul,d.forIn=C1,d.forInRight=$1,d.forOwn=T1,d.forOwnRight=N1,d.get=_c,d.gt=e1,d.gte=t1,d.has=B1,d.hasIn=Ec,d.head=nl,d.identity=Et,d.includes=Em,d.indexOf=vv,d.inRange=rw,d.invoke=z1,d.isArguments=Si,d.isArray=ce,d.isArrayBuffer=r1,d.isArrayLike=bt,d.isArrayLikeObject=Ue,d.isBoolean=i1,d.isBuffer=ii,d.isDate=n1,d.isElement=s1,d.isEmpty=o1,d.isEqual=a1,d.isEqualWith=c1,d.isError=wc,d.isFinite=u1,d.isFunction=Nr,d.isInteger=vl,d.isLength=Io,d.isMap=ml,d.isMatch=h1,d.isMatchWith=l1,d.isNaN=f1,d.isNative=p1,d.isNil=g1,d.isNull=d1,d.isNumber=wl,d.isObject=Be,d.isObjectLike=je,d.isPlainObject=Gn,d.isRegExp=bc,d.isSafeInteger=y1,d.isSet=bl,d.isString=Po,d.isSymbol=qt,d.isTypedArray=un,d.isUndefined=v1,d.isWeakMap=m1,d.isWeakSet=w1,d.join=Ev,d.kebabCase=cw,d.last=Yt,d.lastIndexOf=Iv,d.lowerCase=uw,d.lowerFirst=hw,d.lt=b1,d.lte=_1,d.max=n0,d.maxBy=s0,d.mean=o0,d.meanBy=a0,d.min=c0,d.minBy=u0,d.stubArray=Fc,d.stubFalse=Oc,d.stubObject=Ww,d.stubString=Jw,d.stubTrue=Qw,d.multiply=h0,d.nth=Pv,d.noConflict=zw,d.noop=Ac,d.now=bo,d.pad=lw,d.padEnd=fw,d.padStart=pw,d.parseInt=dw,d.random=iw,d.reduce=Am,d.reduceRight=Fm,d.repeat=gw,d.replace=yw,d.result=G1,d.round=l0,d.runInContext=P,d.sample=Rm,d.size=Tm,d.snakeCase=vw,d.some=Nm,d.sortedIndex=Cv,d.sortedIndexBy=$v,d.sortedIndexOf=Tv,d.sortedLastIndex=Nv,d.sortedLastIndexBy=Dv,d.sortedLastIndexOf=Lv,d.startCase=ww,d.startsWith=bw,d.subtract=f0,d.sum=p0,d.sumBy=d0,d.template=_w,d.times=Yw,d.toFinite=Dr,d.toInteger=le,d.toLength=El,d.toLower=Ew,d.toNumber=Zt,d.toSafeInteger=E1,d.toString=Ie,d.toUpper=Iw,d.trim=Pw,d.trimEnd=xw,d.trimStart=Sw,d.truncate=Aw,d.unescape=Fw,d.uniqueId=Xw,d.upperCase=Ow,d.upperFirst=Ic,d.each=cl,d.eachRight=ul,d.first=nl,Sc(d,function(){var t={};return yr(d,function(i,a){Pe.call(d.prototype,a)||(t[a]=i)}),t}(),{chain:!1}),d.VERSION=s,Kt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){d[t].placeholder=d}),Kt(["drop","take"],function(t,i){ve.prototype[t]=function(a){a=a===r?1:Je(le(a),0);var u=this.__filtered__&&!i?new ve(this):this.clone();return u.__filtered__?u.__takeCount__=at(a,u.__takeCount__):u.__views__.push({size:at(a,ne),type:t+(u.__dir__<0?"Right":"")}),u},ve.prototype[t+"Right"]=function(a){return this.reverse()[t](a).reverse()}}),Kt(["filter","map","takeWhile"],function(t,i){var a=i+1,u=a==Mt||a==A;ve.prototype[t]=function(l){var g=this.clone();return g.__iteratees__.push({iteratee:ee(l,3),type:a}),g.__filtered__=g.__filtered__||u,g}}),Kt(["head","last"],function(t,i){var a="take"+(i?"Right":"");ve.prototype[t]=function(){return this[a](1).value()[0]}}),Kt(["initial","tail"],function(t,i){var a="drop"+(i?"":"Right");ve.prototype[t]=function(){return this.__filtered__?new ve(this):this[a](1)}}),ve.prototype.compact=function(){return this.filter(Et)},ve.prototype.find=function(t){return this.filter(t).head()},ve.prototype.findLast=function(t){return this.reverse().find(t)},ve.prototype.invokeMap=ge(function(t,i){return typeof t=="function"?new ve(this):this.map(function(a){return Mn(a,t,i)})}),ve.prototype.reject=function(t){return this.filter(Eo(ee(t)))},ve.prototype.slice=function(t,i){t=le(t);var a=this;return a.__filtered__&&(t>0||i<0)?new ve(a):(t<0?a=a.takeRight(-t):t&&(a=a.drop(t)),i!==r&&(i=le(i),a=i<0?a.dropRight(-i):a.take(i-t)),a)},ve.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},ve.prototype.toArray=function(){return this.take(ne)},yr(ve.prototype,function(t,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),l=d[u?"take"+(i=="last"?"Right":""):i],g=u||/^find/.test(i);l&&(d.prototype[i]=function(){var w=this.__wrapped__,_=u?[1]:arguments,x=w instanceof ve,$=_[0],T=x||ce(w),B=function(ye){var we=l.apply(d,Qr([ye],_));return u&&z?we[0]:we};T&&a&&typeof $=="function"&&$.length!=1&&(x=T=!1);var z=this.__chain__,J=!!this.__actions__.length,te=g&&!z,fe=x&&!J;if(!g&&T){w=fe?w:new ve(this);var re=t.apply(w,_);return re.__actions__.push({func:mo,args:[B],thisArg:r}),new Wt(re,z)}return te&&fe?t.apply(this,_):(re=this.thru(B),te?u?re.value()[0]:re.value():re)})}),Kt(["pop","push","shift","sort","splice","unshift"],function(t){var i=Hs[t],a=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",u=/^(?:pop|shift)$/.test(t);d.prototype[t]=function(){var l=arguments;if(u&&!this.__chain__){var g=this.value();return i.apply(ce(g)?g:[],l)}return this[a](function(w){return i.apply(ce(w)?w:[],l)})}}),yr(ve.prototype,function(t,i){var a=d[i];if(a){var u=a.name+"";Pe.call(nn,u)||(nn[u]=[]),nn[u].push({name:i,func:a})}}),nn[ho(r,H).name]=[{name:"wrapper",func:r}],ve.prototype.clone=Fg,ve.prototype.reverse=Og,ve.prototype.value=Rg,d.prototype.at=sm,d.prototype.chain=om,d.prototype.commit=am,d.prototype.next=cm,d.prototype.plant=hm,d.prototype.reverse=lm,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=fm,d.prototype.first=d.prototype.head,Nn&&(d.prototype[Nn]=um),d},en=ag();Me?((Me.exports=en)._=en,Oe._=en):me._=en}).call(ts)})(pu,pu.exports);var eA=Object.defineProperty,tA=Object.defineProperties,rA=Object.getOwnPropertyDescriptors,sp=Object.getOwnPropertySymbols,iA=Object.prototype.hasOwnProperty,nA=Object.prototype.propertyIsEnumerable,op=(n,e,r)=>e in n?eA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,No=(n,e)=>{for(var r in e||(e={}))iA.call(e,r)&&op(n,r,e[r]);if(sp)for(var r of sp(e))nA.call(e,r)&&op(n,r,e[r]);return n},sA=(n,e)=>tA(n,rA(e));function ui(n,e,r){var s;const o=X0(n);return((s=e.rpcMap)==null?void 0:s[o.reference])||`${XS}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Ti(n){return n.includes(":")?n.split(":")[1]:n}function Ld(n){return n.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function oA(n,e){const r=Object.keys(e.namespaces).filter(o=>o.includes(n));if(!r.length)return[];const s=[];return r.forEach(o=>{const c=e.namespaces[o].accounts;s.push(...c)}),s}function aA(n={},e={}){const r=ap(n),s=ap(e);return pu.exports.merge(r,s)}function ap(n){var e,r,s,o;const c={};if(!Bo(n))return c;for(const[h,p]of Object.entries(n)){const f=wp(h)?[h]:p.chains,y=p.methods||[],v=p.events||[],b=p.rpcMap||{},S=rs(h);c[S]=sA(No(No({},c[S]),p),{chains:Cc(f,(e=c[S])==null?void 0:e.chains),methods:Cc(y,(r=c[S])==null?void 0:r.methods),events:Cc(v,(s=c[S])==null?void 0:s.events),rpcMap:No(No({},b),(o=c[S])==null?void 0:o.rpcMap)})}return c}function cA(n){return n.includes(":")?n.split(":")[2]:n}function uA(n){const e={};for(const[r,s]of Object.entries(n)){const o=s.methods||[],c=s.events||[],h=s.accounts||[],p=wp(r)?[r]:s.chains?s.chains:Ld(s.accounts);e[r]={chains:p,methods:o,events:c,accounts:h}}return e}function Qc(n){return typeof n=="number"?n:n.includes("0x")?parseInt(n,16):n.includes(":")?Number(n.split(":")[1]):Number(n)}const Bd={},Le=n=>Bd[n],Yc=(n,e)=>{Bd[n]=e};class hA{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const o=Ti(r);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||ui(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new li(new hi(s,Le("disableProviderPing")))}}class lA{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const s=r||ui(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new li(new hi(s,Le("disableProviderPing")))}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const o=parseInt(Ti(r));e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,s;let o=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:o}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}}class fA{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const o=Ti(r);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||ui(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new li(new hi(s,Le("disableProviderPing")))}}class pA{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const o=Ti(r);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||ui(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new li(new hi(s,Le("disableProviderPing")))}}class dA{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),o=Ti(r);e[o]=this.createHttpProvider(o,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new li(new hi(s,Le("disableProviderPing")))}}class gA{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const o=Ti(r);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||ui(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new li(new hi(s,Le("disableProviderPing")))}}class yA{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const o=Ti(r);e[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||ui(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new li(new hi(s,Le("disableProviderPing")))}}class vA{constructor(e){this.name="near",this.namespace=e.namespace,this.events=Le("events"),this.client=Le("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const s=r||ui(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(kr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||ui(e,this.namespace);return typeof s>"u"?void 0:new li(new hi(s,Le("disableProviderPing")))}}var mA=Object.defineProperty,wA=Object.defineProperties,bA=Object.getOwnPropertyDescriptors,cp=Object.getOwnPropertySymbols,_A=Object.prototype.hasOwnProperty,EA=Object.prototype.propertyIsEnumerable,up=(n,e,r)=>e in n?mA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,Do=(n,e)=>{for(var r in e||(e={}))_A.call(e,r)&&up(n,r,e[r]);if(cp)for(var r of cp(e))EA.call(e,r)&&up(n,r,e[r]);return n},Zc=(n,e)=>wA(n,bA(e));class Nu{constructor(e){this.events=new vu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Wo(Go({level:(e==null?void 0:e.logger)||ip})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new Nu(e);return await r.initialize(),r}async request(e,r){const[s,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Do({},e),chainId:`${s}:${o}`,topic:this.session.topic})}sendAsync(e,r,s){const o=new Date().getTime();this.request(e,s).then(c=>r(null,Qo(o,c))).catch(c=>r(c,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ut("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:o}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await o().then(c=>{this.session=c,this.namespaces||(this.namespaces=uA(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==Nd)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[s,o]=this.validateChain(e);this.getProvider(s).setDefaultChain(o,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(wn(r)){for(const s of r)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await MS.init({logger:this.providerOpts.logger||ip,relayUrl:this.providerOpts.relayUrl||QS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>rs(r)))];Yc("client",this.client),Yc("events",this.events),Yc("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const s=oA(r,this.session),o=Ld(s),c=aA(this.namespaces,this.optionalNamespaces),h=Zc(Do({},c[r]),{accounts:s,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new lA({namespace:h});break;case"solana":this.rpcProviders[r]=new fA({namespace:h});break;case"cosmos":this.rpcProviders[r]=new pA({namespace:h});break;case"polkadot":this.rpcProviders[r]=new hA({namespace:h});break;case"cip34":this.rpcProviders[r]=new dA({namespace:h});break;case"elrond":this.rpcProviders[r]=new gA({namespace:h});break;case"multiversx":this.rpcProviders[r]=new yA({namespace:h});break;case"near":this.rpcProviders[r]=new vA({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:s}=r;if(s.name==="accountsChanged"){const o=s.data;o&&wn(o)&&this.events.emit("accountsChanged",o.map(cA))}else if(s.name==="chainChanged"){const o=r.chainId,c=r.event.data,h=rs(o),p=Qc(o)!==Qc(c)?`${h}:${Qc(c)}`:o;this.onChainChanged(p)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var s;const{namespaces:o}=r,c=(s=this.client)==null?void 0:s.session.get(e);this.session=Zc(Do({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Zc(Do({},ut("USER_DISCONNECTED")),{data:e.topic}))}),this.on(kr.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r,optionalNamespaces:s,sessionProperties:o}=e;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(e){const[r,s]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(h=>rs(h)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const o=rs(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r=!1){var s;if(!this.namespaces)return;const[o,c]=this.validateChain(e);r||this.getProvider(o).setDefaultChain(c),((s=this.namespaces[o])!=null?s:this.namespaces[`${o}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,r){this.client.core.storage.setItem(`${np}/${e}`,r)}async getFromStore(e){return await this.client.core.storage.getItem(`${np}/${e}`)}}const IA=Nu,PA="wc",xA="ethereum_provider",SA=`${PA}@2:${xA}:`,AA="https://rpc.walletconnect.com/v1/",du=["eth_sendTransaction","personal_sign"],FA=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],gu=["chainChanged","accountsChanged"],OA=["chainChanged","accountsChanged","message","disconnect","connect"];var RA=Object.defineProperty,CA=Object.defineProperties,$A=Object.getOwnPropertyDescriptors,hp=Object.getOwnPropertySymbols,TA=Object.prototype.hasOwnProperty,NA=Object.prototype.propertyIsEnumerable,lp=(n,e,r)=>e in n?RA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,ns=(n,e)=>{for(var r in e||(e={}))TA.call(e,r)&&lp(n,r,e[r]);if(hp)for(var r of hp(e))NA.call(e,r)&&lp(n,r,e[r]);return n},fp=(n,e)=>CA(n,$A(e));function ko(n){return Number(n[0].split(":")[1])}function Xc(n){return`0x${n.toString(16)}`}function DA(n){const{chains:e,optionalChains:r,methods:s,optionalMethods:o,events:c,optionalEvents:h,rpcMap:p}=n;if(!wn(e))throw new Error("Invalid chains");const f={chains:e,methods:s||du,events:c||gu,rpcMap:ns({},e.length?{[ko(e)]:p[ko(e)]}:{})},y=c==null?void 0:c.filter(O=>!gu.includes(O)),v=s==null?void 0:s.filter(O=>!du.includes(O));if(!r&&!h&&!o&&!(y!=null&&y.length)&&!(v!=null&&v.length))return{required:e.length?f:void 0};const b=(y==null?void 0:y.length)&&(v==null?void 0:v.length)||!r,S={chains:[...new Set(b?f.chains.concat(r||[]):r)],methods:[...new Set(f.methods.concat(o!=null&&o.length?o:FA))],events:[...new Set(f.events.concat(h!=null&&h.length?h:OA))],rpcMap:p};return{required:e.length?f:void 0,optional:r.length?S:void 0}}class Du{constructor(){this.events=new Ft.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=SA,this.on=(e,r)=>(this.events.on(e,r),this),this.once=(e,r)=>(this.events.once(e,r),this),this.removeListener=(e,r)=>(this.events.removeListener(e,r),this),this.off=(e,r)=>(this.events.off(e,r),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const r=new Du;return await r.initialize(e),r}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,r){this.signer.sendAsync(e,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:r,optional:s}=DA(this.rpc);try{const o=await new Promise(async(h,p)=>{var f;this.rpc.showQrModal&&((f=this.modal)==null||f.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),p(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(fp(ns({namespaces:ns({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(y=>{h(y)}).catch(y=>{p(new Error(y.message))})});if(!o)return;const c=eb(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:Xc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",Xc(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",fp(ns({},ut("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Xc(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,s,o]=e.split(":");return{chainId:`${r}:${s}`,address:o}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,s;const o=(r=e==null?void 0:e.chains)!=null?r:[],c=(s=e==null?void 0:e.optionalChains)!=null?s:[],h=o.concat(c);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const p=o.length?(e==null?void 0:e.methods)||du:[],f=o.length?(e==null?void 0:e.events)||gu:[],y=(e==null?void 0:e.optionalMethods)||[],v=(e==null?void 0:e.optionalEvents)||[],b=(e==null?void 0:e.rpcMap)||this.buildRpcMap(h,e.projectId),S=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(O=>this.formatChainId(O)),optionalChains:c.map(O=>this.formatChainId(O)),methods:p,events:f,optionalMethods:y,optionalEvents:v,rpcMap:b,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:S,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const s={};return e.forEach(o=>{s[o]=this.getRpcUrl(o,r)}),s}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?ko(this.rpc.chains):ko(this.rpc.optionalChains),this.signer=await IA.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storageOptions:e.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await tb(()=>import("./index-1d935833.js").then(o=>o.i),["./index-1d935833.js","./index-6d74a1b2.js","./index-dfcc00a6.css"],import.meta.url);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(ns({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:s,rpcMap:o}=e;r&&wn(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),s&&wn(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(c=>this.formatChainId(c)),s.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(e,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[e])||`${AA}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const nF=Du;export{nF as EthereumProvider,OA as OPTIONAL_EVENTS,FA as OPTIONAL_METHODS,gu as REQUIRED_EVENTS,du as REQUIRED_METHODS,Du as default};
